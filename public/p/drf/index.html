<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="djangoÁî®‰∫éÂø´ÈÄüÁºñÂÜôAPIÁöÑapp">
<title>DRF</title>

<link rel='canonical' href='https://yn0t1me.github.io/p/drf/'>

<link rel="stylesheet" href="/scss/style.min.b9c8156d464c343bdacaf14a871581fb94cbbdb9dd5cbce4ba017361187cc930.css"><meta property='og:title' content="DRF">
<meta property='og:description' content="djangoÁî®‰∫éÂø´ÈÄüÁºñÂÜôAPIÁöÑapp">
<meta property='og:url' content='https://yn0t1me.github.io/p/drf/'>
<meta property='og:site_name' content='yn0t1meÁöÑÂçöÂÆ¢'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='DRF' /><meta property='article:tag' content='python' /><meta property='article:published_time' content='2025-02-27T14:18:29&#43;08:00'/><meta property='article:modified_time' content='2025-02-27T14:18:29&#43;08:00'/>
<meta name="twitter:title" content="DRF">
<meta name="twitter:description" content="djangoÁî®‰∫éÂø´ÈÄüÁºñÂÜôAPIÁöÑapp">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_901763171188d896.png" width="300"
                            height="284" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üßê</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">yn0t1meÁöÑÂçöÂÆ¢</a></h1>
            <h2 class="site-description">‰∫∫ÁîüËå´Ëå´ÔºåÂîØÊ≠ª‰∫°‰∏éÁà±ËÄåÂ∑≤</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/yn0t1me'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>ÂΩíÊ°£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>ÊêúÁ¥¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>ÂèãÈìæ</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#1-ÂâçË®Ä">1. ÂâçË®Ä</a>
      <ol>
        <li><a href="#11-ÂâçÂêéÁ´ØÂàÜÁ¶ª">1.1 ÂâçÂêéÁ´ØÂàÜÁ¶ª</a></li>
        <li><a href="#12-djangoÁöÑfbvÂíåcbv">1.2 djangoÁöÑFBVÂíåCBV</a></li>
        <li><a href="#13-drf">1.3 drf</a></li>
      </ol>
    </li>
    <li><a href="#2-ÂàõÂª∫È°πÁõÆ">2. ÂàõÂª∫È°πÁõÆ</a>
      <ol>
        <li><a href="#21-djangoÈÖçÁΩÆ">2.1 djangoÈÖçÁΩÆ</a></li>
        <li><a href="#22-ÈÖçÁΩÆdrf">2.2 ÈÖçÁΩÆdrf</a></li>
      </ol>
    </li>
    <li><a href="#3-request">3. request</a>
      <ol>
        <li><a href="#31-oopÁü•ËØÜ">3.1 oopÁü•ËØÜ</a></li>
        <li><a href="#32-ÂèÇÊï∞">3.2 ÂèÇÊï∞</a></li>
        <li><a href="#33-Ê∫êÁ†ÅÂàÜÊûê">3.3 Ê∫êÁ†ÅÂàÜÊûê</a></li>
        <li><a href="#34-requestÂØπË±°">3.4 requestÂØπË±°</a></li>
      </ol>
    </li>
    <li><a href="#5-ËÆ§ËØÅ">5. ËÆ§ËØÅ</a>
      <ol>
        <li><a href="#51-Âø´ÈÄü‰ΩøÁî®">5.1 Âø´ÈÄü‰ΩøÁî®</a>
          <ol>
            <li><a href="#Ê°à‰æã1">Ê°à‰æã1</a></li>
            <li><a href="#Ê°à‰æã2">Ê°à‰æã2</a></li>
            <li><a href="#Ê°à‰æã3">Ê°à‰æã3</a></li>
            <li><a href="#Ê°à‰æã4">Ê°à‰æã4</a></li>
          </ol>
        </li>
        <li><a href="#52-Èù¢ÂêëÂØπË±°-ÁªßÊâø">5.2 Èù¢ÂêëÂØπË±°-ÁªßÊâø</a></li>
        <li><a href="#53-ÁªÑ‰ª∂Ê∫êÁ†Å">5.3 ÁªÑ‰ª∂Ê∫êÁ†Å</a></li>
        <li><a href="#54-ÊãìÂ±ï-Â≠êÁ±ªÁ∫¶Êùü">5.4 ÊãìÂ±ï-Â≠êÁ±ªÁ∫¶Êùü</a></li>
        <li><a href="#55-Ê°à‰æã-Áî®Êà∑ÁôªÂΩïÂíåËÆ§ËØÅ">5.5 Ê°à‰æã-Áî®Êà∑ÁôªÂΩïÂíåËÆ§ËØÅ</a>
          <ol>
            <li><a href="#551-ÂàõÂª∫Êï∞ÊçÆË°®">5.5.1 ÂàõÂª∫Êï∞ÊçÆË°®</a></li>
            <li><a href="#552-Ë∑ØÁî±Á≥ªÁªü">5.5.2 Ë∑ØÁî±Á≥ªÁªü</a></li>
            <li><a href="#553-ËÆ§ËØÅÁªÑ‰ª∂">5.5.3 ËÆ§ËØÅÁªÑ‰ª∂</a></li>
            <li><a href="#554-ËßÜÂõæÂáΩÊï∞">5.5.4 ËßÜÂõæÂáΩÊï∞</a></li>
            <li><a href="#555-ËÆøÈóÆÊïàÊûú">5.5.5 ËÆøÈóÆÊïàÊûú</a></li>
          </ol>
        </li>
        <li><a href="#56-ÊÄªÁªì">5.6 ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#6-ÊùÉÈôê">6. ÊùÉÈôê</a>
      <ol>
        <li><a href="#61-Âø´ÈÄü‰ΩøÁî®">6.1 Âø´ÈÄü‰ΩøÁî®</a></li>
        <li><a href="#62-ÈîôËØØ‰ø°ÊÅØÂíåÂ§ö‰∏™ÊùÉÈôêÁ±ª">6.2 ÈîôËØØ‰ø°ÊÅØÂíåÂ§ö‰∏™ÊùÉÈôêÁ±ª</a></li>
        <li><a href="#63-Ê∫êÁ†ÅÊµÅÁ®ã">6.3 Ê∫êÁ†ÅÊµÅÁ®ã</a></li>
        <li><a href="#64-ÁªÑ‰ª∂ÁöÑÊãìÂ±ï">6.4 ÁªÑ‰ª∂ÁöÑÊãìÂ±ï</a></li>
        <li><a href="#65-Ê°à‰æã-ÊùÉÈôêÂ§ÑÁêÜ">6.5 Ê°à‰æã-ÊùÉÈôêÂ§ÑÁêÜ</a>
          <ol>
            <li><a href="#651-ÂàõÂª∫Êï∞ÊçÆË°®">6.5.1 ÂàõÂª∫Êï∞ÊçÆË°®</a></li>
            <li><a href="#652-Ë∑ØÁî±Á≥ªÁªü">6.5.2 Ë∑ØÁî±Á≥ªÁªü</a></li>
            <li><a href="#653-ËÆ§ËØÅÁªÑ‰ª∂">6.5.3 ËÆ§ËØÅÁªÑ‰ª∂</a></li>
            <li><a href="#654-ÊùÉÈôêÁªÑ‰ª∂">6.5.4 ÊùÉÈôêÁªÑ‰ª∂</a></li>
            <li><a href="#655-ËßÜÂõæÂáΩÊï∞">6.5.5 ËßÜÂõæÂáΩÊï∞</a></li>
            <li><a href="#656-ËÆøÈóÆÊïàÊûú">6.5.6 ËÆøÈóÆÊïàÊûú</a></li>
          </ol>
        </li>
        <li><a href="#66-ÊÄùËÄÉ">6.6 ÊÄùËÄÉ</a></li>
        <li><a href="#67-ÊÄªÁªì">6.7 ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#7-ÈôêÊµÅ">7. ÈôêÊµÅ</a>
      <ol>
        <li><a href="#71-Âü∫Êú¨ÈÄªËæë">7.1 Âü∫Êú¨ÈÄªËæë</a></li>
        <li><a href="#72-Âø´ÈÄü‰ΩøÁî®">7.2 Âø´ÈÄü‰ΩøÁî®</a></li>
        <li><a href="#73-Ê∫êÁ†ÅÊµÅÁ®ã">7.3 Ê∫êÁ†ÅÊµÅÁ®ã</a></li>
        <li><a href="#74-Ê°à‰æã-ÈôêÊµÅÁöÑÂ∫îÁî®">7.4 Ê°à‰æã-ÈôêÊµÅÁöÑÂ∫îÁî®</a></li>
        <li><a href="#75-ÊÄªÁªì">7.5 ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#8-ÁâàÊú¨">8. ÁâàÊú¨</a>
      <ol>
        <li><a href="#81-getÂèÇÊï∞‰º†ÈÄí">8.1 GETÂèÇÊï∞‰º†ÈÄí</a></li>
        <li><a href="#82-ÂèçÂêëÁîüÊàêurl">8.2 ÂèçÂêëÁîüÊàêURL</a></li>
        <li><a href="#83-Ê∫êÁ†ÅËß£ËØª">8.3 Ê∫êÁ†ÅËß£ËØª</a></li>
        <li><a href="#84-urlË∑ØÂæÑ‰º†ÈÄí">8.4 URLË∑ØÂæÑ‰º†ÈÄí</a></li>
        <li><a href="#85-acceptËØ∑Ê±ÇÂ§¥‰º†ÈÄí">8.5 AcceptËØ∑Ê±ÇÂ§¥‰º†ÈÄí</a></li>
        <li><a href="#86-ÊÄªÁªì">8.6 ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#9-Ëß£ÊûêÂô®">9. Ëß£ÊûêÂô®</a>
      <ol>
        <li><a href="#91-ÊµÅÁ®ãÊ¶ÇËø∞">9.1 ÊµÅÁ®ãÊ¶ÇËø∞</a></li>
        <li><a href="#92-Â∏∏ËßÅÂ∫îÁî®">9.2 Â∏∏ËßÅÂ∫îÁî®</a>
          <ol>
            <li><a href="#921-jsonparser">9.2.1 JSONParser</a></li>
            <li><a href="#922-formparser">9.2.2 FormParser</a></li>
            <li><a href="#923-multipartparser">9.2.3 MultiPartParser</a></li>
            <li><a href="#924-fileuploadparser">9.2.4 FileUploadParser</a></li>
          </ol>
        </li>
        <li><a href="#93-Ê∫êÁ†ÅÊµÅÁ®ã">9.3 Ê∫êÁ†ÅÊµÅÁ®ã</a></li>
        <li><a href="#94-Ëß£ÊûêÂô®ÂÖ®Â±ÄÈÖçÁΩÆ">9.4 Ëß£ÊûêÂô®ÂÖ®Â±ÄÈÖçÁΩÆ</a></li>
        <li><a href="#95-ÊÄªÁªì">9.5 ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#10-ÂÖÉÁ±ª">10. ÂÖÉÁ±ª</a>
      <ol>
        <li><a href="#101-Á±ªÂíåÂØπË±°ÁöÑÂü∫Á°ÄÁü•ËØÜ">10.1 Á±ªÂíåÂØπË±°ÁöÑÂü∫Á°ÄÁü•ËØÜ</a></li>
        <li><a href="#102-ÂàõÂª∫Á±ªÁöÑ‰∏§ÁßçÊñπÂºè">10.2 ÂàõÂª∫Á±ªÁöÑ‰∏§ÁßçÊñπÂºè</a></li>
        <li><a href="#103-mytypeÂàõÂª∫Á±ª‰∏éÊãìÂ±ï">10.3 MyTypeÂàõÂª∫Á±ª‰∏éÊãìÂ±ï</a></li>
        <li><a href="#104-ÁªßÊâøÂÖ≥Á≥ª">10.4 ÁªßÊâøÂÖ≥Á≥ª</a></li>
        <li><a href="#105-drfÂ∫èÂàóÂåñÊ∫êÁ†ÅÊ°à‰æã">10.5 drfÂ∫èÂàóÂåñÊ∫êÁ†ÅÊ°à‰æã</a></li>
        <li><a href="#106-Êâ©Â±ï">10.6 Êâ©Â±ï</a></li>
      </ol>
    </li>
    <li><a href="#11-Â∫èÂàóÂåñÂô®">11. Â∫èÂàóÂåñÂô®</a>
      <ol>
        <li><a href="#111-Â∫èÂàóÂåñ">11.1 Â∫èÂàóÂåñ</a>
          <ol>
            <li><a href="#1111-serializer">11.1.1 Serializer</a></li>
            <li><a href="#1112-modelserializer">11.1.2 ModelSerializer</a></li>
            <li><a href="#1113-Â≠óÊÆµÂíåÂèÇÊï∞">11.1.3 Â≠óÊÆµÂíåÂèÇÊï∞</a></li>
            <li><a href="#1114-ÂµåÂ•ó‰∏éÁªßÊâø">11.1.4 ÂµåÂ•ó‰∏éÁªßÊâø</a></li>
          </ol>
        </li>
        <li><a href="#112-Ê∫êÁ†ÅÊµÅÁ®ã">11.2 Ê∫êÁ†ÅÊµÅÁ®ã</a>
          <ol>
            <li><a href="#1121-ÊµÅÁ®ãÊ¶ÇËø∞">11.2.1 ÊµÅÁ®ãÊ¶ÇËø∞</a></li>
            <li><a href="#1122-ÂàõÂª∫Â≠óÊÆµÂØπË±°">11.2.2 ÂàõÂª∫Â≠óÊÆµÂØπË±°</a></li>
            <li><a href="#1123-ÂàõÂª∫Á±ª">11.2.3 ÂàõÂª∫Á±ª</a></li>
            <li><a href="#1124-ÂÆû‰æãÂåñÁ±ª">11.2.4 ÂÆû‰æãÂåñÁ±ª</a></li>
            <li><a href="#1125-Â∫èÂàóÂåñËøáÁ®ã">11.2.5 Â∫èÂàóÂåñËøáÁ®ã</a></li>
          </ol>
        </li>
        <li><a href="#113-Êï∞ÊçÆÊ†°È™å">11.3 Êï∞ÊçÆÊ†°È™å</a>
          <ol>
            <li><a href="#1131-Âü∫Êú¨Ê†°È™å">11.3.1 Âü∫Êú¨Ê†°È™å</a></li>
            <li><a href="#1132-ÂÜÖÁΩÆÂíåÊ≠£ÂàôÊ†°È™å">11.3.2 ÂÜÖÁΩÆÂíåÊ≠£ÂàôÊ†°È™å</a></li>
            <li><a href="#1133-Èí©Â≠êÊ†°È™å">11.3.3 Èí©Â≠êÊ†°È™å</a></li>
            <li><a href="#1134-modelÊ†°È™å">11.3.4 ModelÊ†°È™å</a></li>
            <li><a href="#1135-‰øùÂ≠òÊï∞ÊçÆ‰πãÊôÆÈÄöÂ≠óÊÆµ">11.3.5 ‰øùÂ≠òÊï∞ÊçÆ‰πãÊôÆÈÄöÂ≠óÊÆµ</a></li>
            <li><a href="#1136-‰øùÂ≠òÊï∞ÊçÆ‰πãfkÂíåm2mÂ≠óÊÆµ">11.3.6 ‰øùÂ≠òÊï∞ÊçÆ‰πãFKÂíåM2MÂ≠óÊÆµ</a></li>
            <li><a href="#1137-Êï∞ÊçÆÊ†°È™åÊÄªÁªì">11.3.7 Êï∞ÊçÆÊ†°È™åÊÄªÁªì</a></li>
            <li><a href="#1138-Ê†°È™åÂíåÂ∫èÂàóÂåñ‰∫åÂêà‰∏Ä">11.3.8 Ê†°È™åÂíåÂ∫èÂàóÂåñ‰∫åÂêà‰∏Ä</a></li>
            <li><a href="#1139-ÊãìÂ±ï">11.3.9 ÊãìÂ±ï</a></li>
          </ol>
        </li>
        <li><a href="#114-ÂçöÂÆ¢Á≥ªÁªüÊ°à‰æã">11.4 ÂçöÂÆ¢Á≥ªÁªüÊ°à‰æã</a>
          <ol>
            <li><a href="#1141-Ë°®ÁªìÊûÑ">11.4.1 Ë°®ÁªìÊûÑ</a></li>
            <li><a href="#1142-ÂäüËÉΩÂÆûÁé∞">11.4.2 ÂäüËÉΩÂÆûÁé∞</a></li>
            <li><a href="#1243-ÊÄªÁªì">12.4.3 ÊÄªÁªì</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#12-ÂàÜÈ°µ">12. ÂàÜÈ°µ</a>
      <ol>
        <li><a href="#121-pagenumberpagination">12.1 PageNumberPagination</a>
          <ol>
            <li><a href="#1211-ÂàùÊ≠•‰ΩøÁî®">12.1.1 ÂàùÊ≠•‰ΩøÁî®</a></li>
            <li><a href="#1212-Ëá™ÂÆö‰πâpagenumberpaginationÁ±ª">12.1.2 Ëá™ÂÆö‰πâPageNumberPaginationÁ±ª</a></li>
            <li><a href="#1213-ÂàÜÈ°µÁöÑËøîÂõûÂÄºÂ§ÑÁêÜ">12.1.3 ÂàÜÈ°µÁöÑËøîÂõûÂÄºÂ§ÑÁêÜ</a></li>
            <li><a href="#1214-ÁªàÊûÅ‰ΩøÁî®">12.1.4 ÁªàÊûÅ‰ΩøÁî®</a></li>
          </ol>
        </li>
        <li><a href="#122-limitoffsetpagination">12.2 LimitOffsetPagination</a>
          <ol>
            <li><a href="#1221-Âü∫Êú¨‰ΩøÁî®ÂèäÊãìÂ±ï">12.2.1 Âü∫Êú¨‰ΩøÁî®ÂèäÊãìÂ±ï</a></li>
            <li><a href="#1222-ÂÆûÈôÖ‰ΩøÁî®">12.2.2 ÂÆûÈôÖ‰ΩøÁî®</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/python/" style="background-color: #2a9d8f; color: #fff;">
                Python
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/drf/">DRF</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            djangoÁî®‰∫éÂø´ÈÄüÁºñÂÜôAPIÁöÑapp
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 27, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 88 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="1-ÂâçË®Ä">1. ÂâçË®Ä
</h2><h3 id="11-ÂâçÂêéÁ´ØÂàÜÁ¶ª">1.1 ÂâçÂêéÁ´ØÂàÜÁ¶ª
</h3><p><img src="/post%5cpython%5cDRF%5c1733982054512-99900304-27f3-48bb-aa08-adf52759a427.png"
	
	
	
	loading="lazy"
	
	
></p>
<p><img src="/post%5cpython%5cDRF%5c1733982078114-e0b608b9-4f16-4e15-a508-747a37443a76.png"
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="12-djangoÁöÑfbvÂíåcbv">1.2 djangoÁöÑFBVÂíåCBV
</h3><ul>
<li><code>FBVÔºöfunction base views</code>ÔºåÂç≥ÁºñÂÜôÂáΩÊï∞Êù•Â§ÑÁêÜ‰∏öÂä°ËØ∑Ê±ÇÔºàÂáΩÊï∞Ôºâ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">app01</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;users/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">users</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">users</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&#34;GET&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s2">&#34;code&#34;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span><span class="s2">&#34;data&#34;</span><span class="p">:</span><span class="s2">&#34;xxx&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s2">&#34;code&#34;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span><span class="s2">&#34;data&#34;</span><span class="p">:</span><span class="s2">&#34;xxx&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>CBVÔºåclass base views</code>ÔºåÂç≥ÁºñÂÜôÁ±ªÊù•Â§ÑÁêÜ‰∏öÂä°ËØ∑Ê±ÇÔºàÁ±ªÂä†ÂèçÂ∞ÑÔºâ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">app01</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;users/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂ÂÆûÔºå<code>CBV</code>Âíå<code>FBV</code>ÁöÑÂ∫ïÂ±ÇÂÆûÁé∞Êú¨Ë¥®‰∏äÁõ∏ÂêåÁöÑ„ÄÇ</p>
<h3 id="13-drf">1.3 drf
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># django‰∏≠ÁöÑCBV</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">View</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># drfÊ°ÜÊû∂‰∏≠ÁöÑCBV</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">APIViews</span><span class="p">(</span><span class="n">View</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ëá™ÂÆö‰πâÁöÑÁ±ª</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserInfo</span><span class="p">(</span><span class="n">APIViews</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2-ÂàõÂª∫È°πÁõÆ">2. ÂàõÂª∫È°πÁõÆ
</h2><h3 id="21-djangoÈÖçÁΩÆ">2.1 djangoÈÖçÁΩÆ
</h3><ul>
<li>ÂàõÂª∫Á∫ØÂáÄpythonÈ°πÁõÆÂπ∂ÈÖçÁΩÆËôöÊãüÁéØÂ¢É</li>
</ul>
<p><img src="/post%5cpython%5cDRF%5c1733983824945-78126a3b-6ded-4f6c-aeb6-8cc02cb2da76.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>ÂÆâË£ÖdjangoÂ∫ìÂπ∂ÂÆåÊàêÂü∫Á°ÄÁöÑÈ°πÁõÆÈÖçÁΩÆ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># ÂÆâË£ÖdjangoÂ∫ì</span>
</span></span><span class="line"><span class="cl"><span class="n">pip</span> <span class="n">install</span> <span class="n">django</span><span class="o">==</span><span class="mf">3.2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫È°πÁõÆÁõÆÂΩï</span>
</span></span><span class="line"><span class="cl"><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">startproject</span> <span class="n">day13</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫‰∏Ä‰∏™app</span>
</span></span><span class="line"><span class="cl"><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">startapp</span> <span class="n">api</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Á∫ØÂáÄÁâàdjangoÈ°πÁõÆÔºàÂØπsettings.pyÊñá‰ª∂Êìç‰ΩúÔºâ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.admin&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.auth&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.contenttypes&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.sessions&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.messages&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># &#39;django.contrib.auth.context_processors.auth&#39;,</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># &#39;django.contrib.messages.context_processors.messages&#39;,</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÈÖçÁΩÆÈ°πÁõÆÂêØÂä®ÊåâÈíÆ</li>
</ul>
<p><img src="/post%5cpython%5cDRF%5c1733984751636-3187b259-2c2d-4914-965a-e45893bd79ed.png"
	
	
	
	loading="lazy"
	
	
></p>
<p><img src="/post%5cpython%5cDRF%5c1733984879376-354e1923-5d2a-46e1-bbc4-1f33db967ac0.png"
	
	
	
	loading="lazy"
	
	
></p>
<p><img src="/post%5cpython%5cDRF%5c1733984996746-4c8d1633-72c5-4cd2-8848-5adf2d7cdf34.png"
	
	
	
	loading="lazy"
	
	
></p>
<p><img src="/post%5cpython%5cDRF%5c1733985045978-a462498f-b2ba-4da9-803c-29176ef07abc.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>ÊµãËØïÁÆÄÂçïÂÆû‰æã</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># api/views.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">HttpResponse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&#34;ÊàêÂäü&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># day13/urls.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># from django.contrib import admin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># path(&#39;admin/&#39;, admin.site.urls),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;home/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-ÈÖçÁΩÆdrf">2.2 ÈÖçÁΩÆdrf
</h3><ul>
<li>ÂÆâË£ÖdrfÊ°ÜÊû∂</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pip</span> <span class="n">install</span> <span class="n">djangorestframework</span><span class="o">==</span><span class="mf">3.13.1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>settings.pyÈÖçÁΩÆ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.admin&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.auth&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.contenttypes&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.sessions&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.messages&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;api.apps.ApiConfig&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># &#39;django.contrib.auth.context_processors.auth&#39;,</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># &#39;django.contrib.messages.context_processors.messages&#39;,</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">################## drfÂåøÂêçÁî®Êà∑  ##################</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Âú®request‰∏≠Ê∫êÁ†ÅÂèØ‰ª•ÊâæÂà∞</span>
</span></span><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_USER&#34;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁÆÄÂçïÂÆû‰æã</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># from django.contrib import admin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># path(&#39;admin/&#39;, admin.site.urls),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;home/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;user/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">HttpResponse</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&#34;ÊàêÂäü&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;ËøîÂõûÊàêÂäü&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-request">3. request
</h2><h3 id="31-oopÁü•ËØÜ">3.1 oopÁü•ËØÜ
</h3><ul>
<li>
<p><code>getattr</code>Ôºö</p>
</li>
<li>
<p><code>__getattr__</code>Ôºö</p>
<ul>
<li>Âè™ÊúâÂú®Â±ûÊÄßÊü•ÊâæÂ§±Ë¥•Êó∂Êâç‰ºöË¢´Ë∞ÉÁî®ÔºàÂç≥Âú®ÂØπË±°ÁöÑ <code>__dict__</code> ÂíåÁ±ªÁöÑ <code>__dict__</code> ‰∏≠ÈÉΩÊâæ‰∏çÂà∞Â±ûÊÄßÊó∂Ôºâ„ÄÇ</li>
<li>ÂÆÉÊòØ‰∏Ä‰∏™‚ÄúÂêéÂ§á‚ÄùÊñπÊ≥ïÔºåÈÄöÂ∏∏Áî®‰∫éÂä®ÊÄÅÂú∞Êèê‰æõÂ±ûÊÄßÊàñÊñπÊ≥ï„ÄÇ</li>
</ul>
</li>
<li>
<p><code>__getattribute__</code>Ôºö</p>
<ul>
<li>ÊòØ‰∏Ä‰∏™Êõ¥Â∫ïÂ±ÇÁöÑÊñπÊ≥ïÔºå‰ºöÂú®ÊØèÊ¨°Â±ûÊÄßËÆøÈóÆÊó∂Ë¢´Ë∞ÉÁî®ÔºåÊó†ËÆ∫Â±ûÊÄßÊòØÂê¶Â≠òÂú®„ÄÇ</li>
<li>ÂÆÉÁöÑ‰ºòÂÖàÁ∫ßÈ´ò‰∫é <code>__getattr__</code>ÔºåÂπ∂‰∏îÂèØ‰ª•ÂÆåÂÖ®ÊéßÂà∂Â±ûÊÄßÁöÑËÆøÈóÆË°å‰∏∫„ÄÇ</li>
</ul>
</li>
</ul>
<ul>
<li>Áõ¥Êé•ËÆøÈóÆÊàñÂà©Áî®ÂèçÂ∞Ñ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="s2">&#34;Â∞è‰∏â&#34;</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># obj.name</span>
</span></span><span class="line"><span class="cl"><span class="c1"># obj.age</span>
</span></span><span class="line"><span class="cl"><span class="c1"># obj.show()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># v1=obj.show</span>
</span></span><span class="line"><span class="cl"><span class="n">v1</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">)</span>  <span class="c1"># &lt;bound method Foo.show of &lt;__main__.Foo object at 0x000001D9870DBFD0&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">v1</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>__getattr__</code>
<ul>
<li>ÂΩìÂØπË±°.‰∏Ä‰∏™‰∏çÂ≠òÂú®ÁöÑÊàêÂëòÊó∂Ëß¶Âèë</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-----&gt;&#34;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">999</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="s2">&#34;Â∞è‰∏â&#34;</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰∏çËß¶Âèë __getattr</span>
</span></span><span class="line"><span class="cl"><span class="c1"># obj.name</span>
</span></span><span class="line"><span class="cl"><span class="c1"># obj.age</span>
</span></span><span class="line"><span class="cl"><span class="c1"># obj.show()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ëß¶Âèë __getattr__ (‰∏çÂ≠òÂú®ÁöÑÊàêÂëò)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(obj.xxx)</span>
</span></span><span class="line"><span class="cl"><span class="n">v2</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&#34;xxxx&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -----&gt; xxxx</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 999</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>getattribute</strong>
<ul>
<li>Âè™Ë¶ÅÊâßË°å ÂØπË±°.xxxÈÉΩ‰ºöÊâßË°å__getattribute__</li>
<li>Áà∂Á±ªobject‰∏≠ÁöÑ__getattribute__ÁöÑÂ§ÑÁêÜÊú∫Âà∂
<ul>
<li>ÂØπË±°‰∏≠ÊúâÂÄºÔºåËøîÂõû</li>
<li>ÂØπË±°‰∏≠Êó†ÂÄºÔºåÊä•Èîô</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-----&gt;&#34;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">999</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="s2">&#34;Â∞è‰∏â&#34;</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">xxx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -----&gt; name</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 999</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -----&gt; age</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 999</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -----&gt; xxx</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 999</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Á±ªÂàÜÊûê</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HttpRequest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">v1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;v1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">v2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;v2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Request</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="o">=</span> <span class="n">req</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">req</span> <span class="o">=</span> <span class="n">HttpRequest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">req</span><span class="o">.</span><span class="n">v1</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">req</span><span class="o">.</span><span class="n">v2</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="mi">111</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">request</span><span class="o">.</span><span class="n">_request</span><span class="o">.</span><span class="n">v1</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">request</span><span class="o">.</span><span class="n">_request</span><span class="o">.</span><span class="n">v2</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HttpRequest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">v1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;v1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">v2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;v2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Request</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="o">=</span> <span class="n">req</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ÂØπË±°‰∏≠Êó†ÁöÑÊàêÂëòÔºå‰ºöËß¶Âèë</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># attr=&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">req</span> <span class="o">=</span> <span class="n">HttpRequest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="mi">111</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># request._request.v1()</span>
</span></span><span class="line"><span class="cl"><span class="n">request</span><span class="o">.</span><span class="n">v1</span><span class="p">()</span>  <span class="c1"># request.v1=request._request.v1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>requestÁöÑÁÆÄÂçïÂÆûÁé∞ÂéüÁêÜÔºàÂ±ûÊÄß‰ª£ÁêÜÔºâ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HttpRequest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;v1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">path_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;v2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DrfRequest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">xx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="o">=</span> <span class="n">req</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">request</span> <span class="o">=</span> <span class="n">HttpRequest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">request</span> <span class="o">=</span> <span class="n">DrfRequest</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="mi">123123</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊôÆÈÄöÂÜôÊ≥ï</span>
</span></span><span class="line"><span class="cl"><span class="n">request</span><span class="o">.</span><span class="n">_request</span><span class="o">.</span><span class="n">method</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Âà©Áî®__getattr__Âíå__getattribute__</span>
</span></span><span class="line"><span class="cl"><span class="n">request</span><span class="o">.</span><span class="n">method</span>
</span></span><span class="line"><span class="cl"><span class="n">request</span><span class="o">.</span><span class="n">path_info</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Êä•Èîô</span>
</span></span><span class="line"><span class="cl"><span class="n">request</span><span class="o">.</span><span class="n">uuuu</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="32-ÂèÇÊï∞">3.2 ÂèÇÊï∞
</h3><p>ÊôÆÈÄöÂåπÈÖçÔºö<code>&lt;Êï∞ÊçÆÁ±ªÂûã:ÂèÇÊï∞Âêç&gt;</code>ÔºåËßÜÂõæÁõ¥Êé•Áî®<code>ÂèÇÊï∞</code>Êé•Êî∂ÔºåÊàñËÄÖ<code>self.kwargs</code>‰∏≠Ëé∑Âèñ</p>
<p><img src="/post%5cpython%5cDRF%5c1734150636720-5cac42a1-7030-46db-950d-cda1559234b2.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>‰∏çÊåáÂÆöÂèÇÊï∞ÂêçÊ≠£ÂàôÂåπÈÖçÔºàÂØºÂÖ•re_pathÔºâÔºö<code>(Ê≠£ÂàôË°®ËææÂºè)</code>ÔºåËßÜÂõæÁõ¥Êé•Áî®<code>ÂèÇÊï∞</code>Êé•Êî∂ÔºåÊàñËÄÖ<code>self.args</code>‰∏≠Ëé∑Âèñ</p>
<p><img src="/post%5cpython%5cDRF%5c1734150642488-23de7af7-4501-423a-a4ce-35d03662d913.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ÊåáÂÆöÂèÇÊï∞ÂêçÊ≠£ÂàôÂåπÈÖçÔºö<code>(?P&lt;ÂèÇÊï∞Âêç&gt;Ê≠£ÂàôË°®ËææÂºè)</code>ÔºåËßÜÂõæÁõ¥Êé•Áî®<code>ÂèÇÊï∞</code>Êé•Êî∂ÔºåÊàñËÄÖ<code>self.kwargs</code>‰∏≠Ëé∑Âèñ</p>
<p>ÂëΩÂêçÊçïËé∑ÁªÑÔºàNamed Capture GroupÔºâÔºö<code>(?P&lt;ÂèÇÊï∞Âêç&gt;Ê≠£ÂàôË°®ËææÂºè)</code></p>
<p><img src="/post%5cpython%5cDRF%5c1734150651203-61c81235-6ac7-49d7-ae8d-32234589fdfe.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li><code>ÊµãËØï‰ª£Á†Å</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">re_path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># path(&#39;admin/&#39;, admin.site.urls),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># path(&#39;users/&lt;str:version&gt;/&lt;int:pid&gt;/&#39;, views.UserView.as_view()),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># re_path(&#39;users/(\w+)/(\d+)/&#39;, views.UserView.as_view()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">re_path</span><span class="p">(</span><span class="s1">&#39;users/(?P&lt;version&gt;\w+)/(?P&lt;pid&gt;\d+)/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="33-Ê∫êÁ†ÅÂàÜÊûê">3.3 Ê∫êÁ†ÅÂàÜÊûê
</h3><p><img src="/post%5cpython%5cDRF%5c1734153342930-18d2c2fe-47b0-4bdf-a768-d6145989fd3b.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li><code>ÊµÅÁ®ãÊ¢≥ÁêÜ-ÊñáÂ≠óÁâà</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Ê≥®ÊÑèÔºö‰∏ãÂàóË∞ÉÁî®ÊñπÊ≥ïÁöÑÊâæÂØªË∑ØÁ∫øÈÅµÂæ™ÂÖàUserViewÁ±ªÔºåÂêéAPIViewÁ±ªÔºåÊúÄÂêéÊòØViewÁ±ªÔºåÂ∞±‰∏çÂÜçËØ¶ÁªÜËµòËø∞ÊâæÂØªËøáÁ®ã
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">È¶ñÂÖàÂÖ•Âè£ÊòØË∑ØÁî±‰∏≠Ë∞ÉÁî®UserViewÁ±ªÁöÑas_View()ÊñπÊ≥ïÔºåÊâæÂà∞APIViewÁ±ªÁöÑas_view()ÊñπÊ≥ïÔºåÂèàË∞ÉÁî®ViewÁ±ªÁöÑas_view()ÊñπÊ≥ï
</span></span><span class="line"><span class="cl">ViewÁ±ªÁöÑas_view()ÊñπÊ≥ïË∞ÉÁî®APIViewÁ±ªÁöÑdispatchÊñπÊ≥ï
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dispatch()ÊñπÊ≥ïË∞ÉÁî®initialize_request()ÊñπÊ≥ïÔºåÂ∞ÜdjangoÁöÑrequest‰º†ÁªôdrfÁöÑRequestÁ±ªÔºåRequest ÁöÑÊûÑÈÄ†ÂáΩÊï∞Êé•Êî∂‰∏äËø∞ÂèÇÊï∞ÔºåÂπ∂Â∞ÜÂÆÉ‰ª¨Â≠òÂÇ®Âú®ÂÆû‰æã‰∏≠ÔºåÂπ∂‰∏îÂÆö‰πâ‰∫Ü__getattr__ÊñπÊ≥ïÔºåÁî®‰∫éÂú®drfÁöÑrequest‰∏≠Êó†ÁºùËÆøÈóÆÂéüÁîüdjangoÁöÑrequest
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Ê≠§Êó∂initialize_request()ÊñπÊ≥ïË∞ÉÁî®ÂÆåÊØïÔºåÂõûÂà∞dispatch()ÊñπÊ≥ï
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dispatch()ÈÄöËøágetattrÂèçÂ∞ÑËé∑ÂèñËØ∑Ê±ÇÊñπÊ≥ïÔºåÂπ∂Ë∞ÉÁî®ÔºåÂ∞ÜÁªìÊûú‰∏ÄÊ≠•Ê≠•ËøîÂõû
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Ê∫ê‰ª£Á†ÅÂàÜÊûê-Á≤æÁÆÄÁâà</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">APIView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">as_view</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">initkwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">view</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="o">**</span><span class="n">initkwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">csrf_exempt</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">initialize_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parser_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Request</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">parsers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parsers</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">authenticators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_authenticators</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">negotiator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_content_negotiator</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">parser_context</span><span class="o">=</span><span class="n">parser_context</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># requestËøòÊòØdjango‰∏≠ÁöÑrequest</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ê≠§Êó∂ÁöÑrequestÊó∂drfÁöÑrequestÔºårequest._requestÂ∞±ÊòØÂéüÁîüdjangoÁöÑrequest</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># request._request.method</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># request.method  # __getattr__</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_response_headers</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_method_names</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Ëé∑Âèñget/post/putÁ≠âÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">            <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">http_method_not_allowed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ë∞ÉÁî®get/postÁ≠âÊñπÊ≥ï(UserView‰∏≠)</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">View</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">as_view</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">initkwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">view</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Request</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">parsers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">authenticators</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="n">negotiator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parser_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="o">=</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="34-requestÂØπË±°">3.4 requestÂØπË±°
</h3><ul>
<li>
<p>Django ÂéüÁîü <code>HttpRequest</code></p>
<ul>
<li><code>django.core.handlers.wsgi.WSGIRequest</code></li>
<li>ÂåÖÂê´‰∫ÜËØ∑Ê±ÇÁöÑÊâÄÊúâÊï∞ÊçÆ
<ul>
<li><code>request.method</code>ÔºöËØ∑Ê±ÇÊñπÊ≥ïÔºàGET„ÄÅPOST Á≠âÔºâ</li>
<li><code>request.GET</code> Âíå <code>request.POST</code>ÔºöÊü•ËØ¢ÂèÇÊï∞ÂíåË°®ÂçïÊï∞ÊçÆ</li>
<li><code>request.body</code>ÔºöËØ∑Ê±Ç‰ΩìÁöÑÂéüÂßãÊï∞ÊçÆ</li>
</ul>
</li>
</ul>
</li>
<li>
<p>DRF ÁöÑ <code>Request</code> ÂØπË±°</p>
<ul>
<li><code>rest_framework.request.Request</code></li>
<li>Êèê‰æõ‰∫ÜÊõ¥ÁÅµÊ¥ªÁöÑÊñπÂºèÊù•Â§ÑÁêÜËØ∑Ê±ÇÊï∞ÊçÆ
<ul>
<li><code>self._request</code>ÔºöÂ≠òÂÇ® Django ÁöÑÂéüÁîü <code>HttpRequest</code> ÂØπË±°</li>
<li><code>request.query_params</code>ÔºöÁî®‰∫éËé∑Âèñ URL Êü•ËØ¢ÂèÇÊï∞Ôºà<code>GET</code> ËØ∑Ê±ÇÁöÑÂèÇÊï∞Ôºâ</li>
<li><code>request.data</code>ÔºöÁî®‰∫éËé∑ÂèñËØ∑Ê±Ç‰Ωì‰∏≠ÁöÑÊï∞ÊçÆÔºåÊîØÊåÅÂ§öÁßçÊ†ºÂºèÔºàÂ¶Ç JSON„ÄÅË°®ÂçïÊï∞ÊçÆÁ≠âÔºâ</li>
<li><code>request.method</code>ÔºöËé∑ÂèñËØ∑Ê±ÇÊñπÊ≥ïÔºàÂ¶Ç GET„ÄÅPOST„ÄÅPUT Á≠âÔºâÔºå‰∏é Django ÁöÑ <code>request.method</code> ÂäüËÉΩÁõ∏Âêå</li>
<li><code>request.user</code> Âíå <code>request.auth</code>ÔºöÂΩìÂâçËØ∑Ê±ÇÁöÑÁî®Êà∑ÂØπË±°ÔºåÁªèËøáËÆ§ËØÅÂêéÁöÑÁî®Êà∑‰ø°ÊÅØÂíåËÆ§ËØÅÁõ∏ÂÖ≥ÁöÑÈ¢ùÂ§ñ‰ø°ÊÅØÔºå‰æãÂ¶Ç Token</li>
<li><code>request.parsers</code>ÔºöÂΩìÂâçËØ∑Ê±Ç‰ΩøÁî®ÁöÑËß£ÊûêÂô®ÂàóË°®ÔºåÁî®‰∫éËß£ÊûêËØ∑Ê±Ç‰ΩìÊï∞ÊçÆ</li>
<li><code>request.authenticators</code>ÔºöÂΩìÂâçËØ∑Ê±Ç‰ΩøÁî®ÁöÑËÆ§ËØÅÂô®ÂàóË°®</li>
<li><code>request.is_ajax()</code>ÔºöÂà§Êñ≠ËØ∑Ê±ÇÊòØÂê¶‰∏∫ AJAX ËØ∑Ê±Ç</li>
<li><code>request.accepted_renderer</code>ÔºöËé∑ÂèñÂΩìÂâçËØ∑Ê±ÇÁöÑÊ∏≤ÊüìÂô®ÔºåÁî®‰∫éÂÜ≥ÂÆöÂìçÂ∫îÊï∞ÊçÆÁöÑÊ†ºÂºè</li>
<li><code>request.accepted_media_type</code>ÔºöËé∑ÂèñÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÁöÑ <code>Accept</code> Â§¥ÈÉ®‰ø°ÊÅØÔºåÁî®‰∫éÂÜÖÂÆπÂçèÂïÜ</li>
<li><code>request.stream</code>ÔºöËé∑ÂèñËØ∑Ê±Ç‰ΩìÁöÑÂéüÂßãÊµÅÊï∞ÊçÆ</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>drf‰∏≠ÁöÑrequestÂÖ∂ÂÆûÊòØÂØπËØ∑Ê±ÇÁöÑÂÜçÊ¨°Â∞ÅË£ÖÔºåÂÖ∂ÁõÆÁöÑÂ∞±ÊòØÂú®ÂéüÊù•ÁöÑrequestÂØπË±°Âü∫Á°Ä‰∏≠ÂÜçËøõË°åÂ∞ÅË£Ö‰∏Ä‰∫õdrf‰∏≠ÈúÄË¶ÅÁî®Âà∞ÁöÑÂÄº</p>
<p><img src="/post%5cpython%5cDRF%5c1734153473029-fd2d91cd-6312-4f75-9888-afc49b5dfc8f.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li><code>ÊµãËØï‰ª£Á†Å</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">re_path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># path(&#39;admin/&#39;, admin.site.urls),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># path(&#39;users/&lt;str:version&gt;/&lt;int:pid&gt;/&#39;, views.UserView.as_view()),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># re_path(&#39;users/(\w+)/(\d+)/&#39;, views.UserView.as_view()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">re_path</span><span class="p">(</span><span class="s1">&#39;users/(?P&lt;version&gt;\w+)/(?P&lt;pid&gt;\d+)/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.request</span> <span class="kn">import</span> <span class="n">Request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># drfÁöÑrequestÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># djangoÁöÑrequestÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path_info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="5-ËÆ§ËØÅ">5. ËÆ§ËØÅ
</h2><p>Âú®ÂºÄÂèëAPIËøáÁ®ã‰∏≠ÔºåÊúâ‰∫õÂäüËÉΩÈúÄË¶ÅÁôªÂΩïÊâçËÉΩËÆøÈóÆÔºåÊúâ‰∫õÊó†ÈúÄÁôªÂΩï„ÄÇdrf‰∏≠ÁöÑËÆ§ËØÅÁªÑ‰ª∂‰∏ªË¶ÅÂ∞±ÊòØÁî®Êù•ÂÆûÁé∞Ê≠§ÂäüËÉΩ</p>
<h3 id="51-Âø´ÈÄü‰ΩøÁî®">5.1 Âø´ÈÄü‰ΩøÁî®
</h3><p>ÈÄöËøáÁºñÂÜôÁ±ªÁöÑÂΩ¢ÂºèÂÆûÁé∞Ôºå‰∏Ä‰∏™Á±ªÂ∞±ÊòØ‰∏Ä‰∏™ËÆ§ËØÅÁªÑ‰ª∂</p>
<ul>
<li>ÁºñÂÜôÁ±ª -&gt; ËÆ§ËØÅÁªÑ‰ª∂</li>
<li>Â∫îÁî®ÁªÑ‰ª∂</li>
</ul>
<h4 id="Ê°à‰æã1">Ê°à‰æã1
</h4><blockquote>
<p>È°πÁõÆË¶ÅÂºÄÂèë3‰∏™Êé•Âè£ÔºåÂÖ∂‰∏≠1‰∏™Êó†ÈúÄÁôªÂΩïÊé•Âè£„ÄÅ2‰∏™ÂøÖÈ°ªÁôªÂΩïÊâçËÉΩËÆøÈóÆÁöÑÊé•Âè£„ÄÇ</p>
<p>Â±ÄÈÉ®ÈÖçÁΩÆ authentication_classes = []</p></blockquote>
<p>Êó†ÈúÄÁôªÂΩïÁöÑ‰∏çÈÖçÁΩÆËÆ§ËØÅÁ±ªÔºåÈªòËÆ§ÊòØÂåøÂêçÁî®Êà∑ÔºåÈúÄË¶ÅÁôªÈôÜÁöÑÈÖçÁΩÆËÆ§ËØÅÁ±ªÔºåÈÄöËøáËøîÂõûÂÖÉÁªÑËµãÂÄº<code>request.user</code> Âíå <code>request.auth</code>ÔºåÊú™ÈÄöËøáÊäõÂá∫ÂºÇÂ∏∏„ÄÇËã•ËøîÂõûNoneÂàôÊòØÂåøÂêçÁî®Êà∑Ôºå‰∏çÁ¨¶ÂêàÈúÄÊ±Ç</p>
<ul>
<li>ËÆ§ËØÅÂ§±Ë¥•‰ø°ÊÅØÂÆöÂà∂</li>
</ul>
<p><img src="/post%5cpython%5cDRF%5c1734157419487-92ad7693-d15f-46a1-af5a-f403b0e0358b.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>ÂåøÂêçÁî®Êà∑</li>
</ul>
<p><img src="/post%5cpython%5cDRF%5c1734157650997-6ee13a51-5b0b-4f8b-bf96-c8e051217c05.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>ËÆ§ËØÅÁªÑ‰ª∂‰∏≠ËøîÂõûÁöÑ‰∏§‰∏™ÂÄºÔºåÂàÜÂà´ËµãÂÄºÁªôÔºö<code>request.user</code> Âíå <code>request.auth</code></li>
</ul>
<p><img src="/post%5cpython%5cDRF%5c1734157774032-eab61203-3c75-47c0-9b85-9273a5af1fbf.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li><code>urls.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;user/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;order/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">OrderView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>views.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.request</span> <span class="kn">import</span> <span class="n">Request</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.authentication</span> <span class="kn">import</span> <span class="n">BaseAuthentication</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.exceptions</span> <span class="kn">import</span> <span class="n">AuthenticationFailed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># /xxx/xxx/xxx?token=123123123</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># token = request._request.GET.get(&#39;token&#39;)</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># raise AuthenticationFailed(&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;)</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">AuthenticationFailed</span><span class="p">({</span><span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="mi">20000</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;LoginView&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyAuthentication</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;UserView&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyAuthentication</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;OrderView&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Ê°à‰æã2">Ê°à‰æã2
</h4><blockquote>
<p>È°πÁõÆË¶ÅÂºÄÂèë100‰∏™Êé•Âè£ÔºåÂÖ∂‰∏≠1‰∏™Êó†ÈúÄÁôªÂΩïÊé•Âè£„ÄÅ99‰∏™ÂøÖÈ°ªÁôªÂΩïÊâçËÉΩËÆøÈóÆÁöÑÊé•Âè£„ÄÇ</p>
<p>Ê≠§Êó∂ÔºåÂ∞±ÈúÄË¶ÅÁî®Âà∞drfÁöÑÂÖ®Â±ÄÈÖçÁΩÆÔºàËÆ§ËØÅÁªÑ‰ª∂ÁöÑÁ±ª‰∏çËÉΩÊîæÂú®ËßÜÂõæview.py‰∏≠Ôºå‰ºöÂõ†‰∏∫ÂØºÂÖ•APIViewÂØºËá¥Âæ™ÁéØÂºïÁî®ÔºåËØ•Ê°à‰æãÊîæÁΩÆÂú®ext/auth.py‰∏≠Ôºâ</p>
<p>drf‰ºöÂÖàÂä†ËΩΩÂÖ®Â±ÄÈÖçÁΩÆÔºåÂú®Âä†ËΩΩÂ±ÄÈÉ®ÈÖçÁΩÆÔºåÂ±ÄÈÉ®ÈÖçÁΩÆ‰ºöË¶ÜÁõñÂÖ®Â±ÄÈÖçÁΩÆ</p></blockquote>
<ul>
<li><code>ext\auth.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.authentication</span> <span class="kn">import</span> <span class="n">BaseAuthentication</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.exceptions</span> <span class="kn">import</span> <span class="n">AuthenticationFailed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># /xxx/xxx/xxx?token=123123123</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># token = request._request.GET.get(&#39;token&#39;)</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># raise AuthenticationFailed(&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;)</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">AuthenticationFailed</span><span class="p">({</span><span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="mi">20000</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>urls.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;user/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;order/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">OrderView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>views.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.auth</span> <span class="kn">import</span> <span class="n">MyAuthentication</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;LoginView&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;UserView&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;OrderView&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Ê°à‰æã3">Ê°à‰æã3
</h4><blockquote>
<p>Áä∂ÊÄÅÁ†Å‰∏ÄËá¥ÊÄßÈóÆÈ¢òÔºö
Â¶ÇÊûúËÆ§ËØÅÁªÑ‰ª∂‰∏≠Êú™ÂÆö‰πâÔºåÂàôÁªü‰∏Ä‰∏∫ HTTP_403_FORBIDDEN</p>
<p>Â¶ÇÊûúËá™ÂÆö‰πâ‰∫ÜÔºåËøò‰ºöÂä†‰∏ä‰∏Ä‰∏™ÂìçÂ∫îÂ§¥</p></blockquote>
<p>ÂÆö‰πâ<code>get_authenticate_header</code>ÊñπÊ≥ï</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241215160350164.png"
	
	
	
	loading="lazy"
	
		alt="image-20241215160350164"
	
	
></p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241215162322059.png"
	
	
	
	loading="lazy"
	
		alt="image-20241215162322059"
	
	
></p>
<ul>
<li>ÂèÇËÄÉÊ∫êÁ†Å</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">handle_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="p">(</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NotAuthenticated</span><span class="p">,</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthenticationFailed</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">auth_header</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">exc</span><span class="o">.</span><span class="n">auth_header</span> <span class="o">=</span> <span class="n">auth_header</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">exc</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">authenticators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticators</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">authenticators</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">authenticators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">authenticate_header</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Ê°à‰æã4">Ê°à‰æã4
</h4><blockquote>
<p>È°πÁõÆË¶ÅÂºÄÂèë100‰∏™Êé•Âè£ÔºåÂÖ∂‰∏≠1‰∏™Êó†ÈúÄÁôªÂΩïÊé•Âè£„ÄÅ98‰∏™ÂøÖÈ°ªÁôªÂΩïÊâçËÉΩËÆøÈóÆÁöÑÊé•Âè£„ÄÅ1‰∏™ÂÖ¨ÂÖ±Êé•Âè£ÔºàÊú™ÁôªÂΩïÊó∂ÊòæÁ§∫ÂÖ¨ÂÖ±/Â∑≤ÁôªÂΩïÊó∂ÊòæÁ§∫‰∏™‰∫∫‰ø°ÊÅØÔºâ„ÄÇ</p>
<p>ÂéüÊù•ÁöÑËÆ§ËØÅ‰ø°ÊÅØÂè™ËÉΩÊîæÂú®URL‰∏≠‰º†ÈÄíÔºåÂ¶ÇÊûúÁ®ãÂ∫è‰∏≠ÊîØÊåÅÊîæÂú®ÂæàÂ§öÂú∞ÊñπÔºå‰æãÂ¶ÇÔºöURL‰∏≠„ÄÅËØ∑Ê±ÇÂ§¥‰∏≠Á≠â„ÄÇ</p>
<p>ËÆ§ËØÅÁªÑ‰ª∂‰∏≠ÔºåÂ¶ÇÊûúÊòØ‰ΩøÁî®‰∫ÜÂ§ö‰∏™ËÆ§ËØÅÁ±ªÔºå‰ºöÊåâÁÖßÈ°∫Â∫èÈÄê‰∏ÄÊâßË°åÂÖ∂‰∏≠ÁöÑ<code>authenticate</code>ÊñπÊ≥ï</p>
<ul>
<li>ËøîÂõûNoneÊàñÊó†ËøîÂõûÂÄºÔºåË°®Á§∫ÁªßÁª≠ÊâßË°åÂêéÁª≠ÁöÑËÆ§ËØÅÁ±ª</li>
<li>ËøîÂõû   (user, auth) ÂÖÉÁªÑÔºåÂàô‰∏çÂÜçÁªßÁª≠Âπ∂Â∞ÜÂÄºËµãÂÄºÁªôrequest.userÂíårequest.auth</li>
<li>ÊäõÂá∫ÂºÇÂ∏∏ <code>AuthenticationFailed(...)</code>ÔºåËÆ§ËØÅÂ§±Ë¥•Ôºå‰∏çÂÜçÁªßÁª≠ÂêëÂêéËµ∞„ÄÇ</li>
</ul>
<p>Â§ö‰∏™ËÆ§ËØÅÁªÑ‰ª∂ÊØè‰∏Ä‰∏™ÈÉΩËøîÂõûNoneÔºåÈÉΩÊ≤°ÊúâËÆ§ËØÅÊàêÂäüÔºåËßÜÂõæÂáΩÊï∞‰πü‰ºöË¢´ÊâßË°åÔºåÂè™‰∏çËøá<code>self.userÔºåself.auth</code>‰∏∫None</p></blockquote>
<ul>
<li><code>ext\auth.py</code></li>
</ul>
<p>ËÆæÁΩÆ‰∏Ä‰∏™Ê£ÄÊü•ÂèÇÊï∞ÁöÑËÆ§ËØÅÁ±ªÔºå‰∏Ä‰∏™Ê£ÄÊü•ËØ∑Ê±ÇÂ§¥ÁöÑËÆ§ËØÅÁ±ªÔºåÈÄöËøá‰∏Ä‰∏™Âç≥‰∏∫ËÆ§ËØÅÊàêÂäüÔºåÁÑ∂ÂêéËÆæÁΩÆ‰∏Ä‰∏™ËÆ§ËØÅÁ±ªÁõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏</p>
<p>ÂØπ‰∫éÊó†ÈúÄÁôªÈôÜÁöÑÔºåÂ±ÄÈÉ®ËÆæÁΩÆÊó†ËÆ§ËØÅÁ±ª</p>
<p>ÂØπ‰∫éÈúÄË¶ÅÁôªÈôÜÁöÑÔºåÂàôÂ∞ÜÊâÄÊúâËÆ§ËØÅÁ±ªÂä†‰∏äÔºåËã•Á±ª1‰∏éÁ±ª2Êú™ÈÄöËøáÔºåËµ∞Âà∞Á±ª3‰ºöÁõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏Âç≥ËÆ§ËØÅ‰∏çÈÄöËøá</p>
<p>ÂØπ‰∫éÂÖ¨ÂÖ±Êé•Âè£ÔºåÂ±ÄÈÉ®ËÆæÁΩÆÂâç‰∏§‰∏™ËÆ§ËØÅÁ±ªÔºåËã•Êú™ÈÄöËøáÂàô‰ª•ÂåøÂêçÁî®Êà∑ËÆøÈóÆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.authentication</span> <span class="kn">import</span> <span class="n">BaseAuthentication</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.exceptions</span> <span class="kn">import</span> <span class="n">AuthenticationFailed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ParamAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HeaderAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_AUTHORIZATION&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NotAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">AuthenticationFailed</span><span class="p">({</span><span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="mi">20000</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>views.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.auth</span> <span class="kn">import</span> <span class="n">ParamAuthentication</span><span class="p">,</span> <span class="n">HeaderAuthentication</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êó†ÈúÄÁôªÂΩï</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;Áî®Êà∑‰ø°ÊÅØ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÖ¨ÂÖ±Êé•Âè£</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ParamAuthentication</span><span class="p">,</span> <span class="n">HeaderAuthentication</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">ÁöÑËÆ¢Âçï‰ø°ÊÅØ&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">message</span> <span class="o">=</span> <span class="s2">&#34;ÂÖ¨ÂÖ±ËÆ¢Âçï‰ø°ÊÅØ&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂøÖÈ°ªÁôªÂΩï</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">InfoView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">ÁöÑÁî®Êà∑‰ø°ÊÅØ&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>settings.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_USER&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.user=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_TOKEN&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.auth=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_AUTHENTICATION_CLASSES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.ParamAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.HeaderAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.NotAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="52-Èù¢ÂêëÂØπË±°-ÁªßÊâø">5.2 Èù¢ÂêëÂØπË±°-ÁªßÊâø
</h3><p>Â±ÄÈÉ®ÈÖçÁΩÆ‰∏éÂÖ®Â±ÄÈÖçÁΩÆÁöÑ‰ºòÂÖàÂÖ≥Á≥ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">APIView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="n">ËØªÂèñÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑÂàóË°®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">authentication_classes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">44</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">UserView</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span><span class="o">.</span><span class="n">dispatch</span><span class="p">()</span>  <span class="c1"># authentication_classes = [11,22,33,44]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="53-ÁªÑ‰ª∂Ê∫êÁ†Å">5.3 ÁªÑ‰ª∂Ê∫êÁ†Å
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Âú®requestÁöÑÂàùÂßãÂåñÈò∂ÊÆµÂä†ËΩΩËÆ§ËØÅÁªÑ‰ª∂ÔºåÂç≥Ë∞ÉÁî®initialize_requestÊñπÊ≥ïÊó∂ÔºåÈÄöËøáget_authenticatorsÊñπÊ≥ïËé∑ÂèñËÆ§ËØÅÁ±ªÂÆû‰æãÂØπË±°ÂàóË°®authenticators
</span></span><span class="line"><span class="cl">	get_authenticatorsÊñπÊ≥ïÂæ™ÁéØauthentication_classesÔºåÂÆû‰æãÂåñÁîüÊàêËÆ§ËØÅÁ±ªÂÆû‰æãÂØπË±°Â≠òÂÇ®Âú®ÂàóË°®‰∏≠
</span></span><span class="line"><span class="cl">	authentication_classesËØªÂèñÁöÑÂ±ÄÈÉ®ÈÖçÁΩÆÂíåÂÖ®Â±ÄÈÖçÁΩÆ
</span></span><span class="line"><span class="cl">Âä†ËΩΩÂÆåÊàêÂêéÔºåËÆ§ËØÅËøáÁ®ãÔºåÂç≥Ë∞ÉÁî®initialÊñπÊ≥ïÊó∂ÔºåË∞ÉÁî®perform_authenticationÊñπÊ≥ïÔºåËé∑Âèñrequest.userÁöÑÂÄº
</span></span><span class="line"><span class="cl">	user‰∏∫Á©∫ÂÄºÂç≥Êú™ËÆ§ËØÅÔºåËß¶Âèë_authenticateÊñπÊ≥ïÔºåÂæ™ÁéØËÆ§ËØÅÁ±ªÂÆû‰æãÂØπË±°ÂàóË°®authenticatorsÔºåË∞ÉÁî®Ëá™Â∑±ÁöÑËÆ§ËØÅÊñπÊ≥ïÔºåËøîÂõûÂÖÉÁªÑÂ∞±ËµãÂÄºuserÂíåauthÔºåÈÄÄÂá∫Âæ™ÁéØÔºõËøîÂõûNoneÁªßÁª≠Âæ™ÁéØÔºõÊäõÂá∫ÂºÇÂ∏∏Â∞±ÊçïËé∑ÂºÇÂ∏∏ÔºåÂú®dispatch‰∏≠ÊçïËé∑ÔºõÂ¶ÇÊûúÂæ™ÁéØÂÆåÊ≤°ËøîÂõûÂÖÉÁªÑ‰πüÊ≤°ÂºÇÂ∏∏ÔºåÊâßË°å_not_authenticatedÊñπÊ≥ïÂ§ÑÁêÜÂåøÂêçÁî®Êà∑
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/post%5cpython%5cDRF%5c%e6%97%a0%e6%a0%87%e9%a2%98-2024-11-16-0939.png"
	
	
	
	loading="lazy"
	
		alt="Êó†Ê†áÈ¢ò-2024-11-16-0939"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Request</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">authenticators</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="o">=</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">authenticators</span> <span class="o">=</span> <span class="n">authenticators</span> <span class="ow">or</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_user&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="n">wrap_attributeerrors</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@user.setter</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># authenticatorÊòØËÆ§ËØÅÁ±ªÂÆû‰æãÂåñÂêéÁöÑÂØπË±°ÔºåÂæ™ÁéØÈÄê‰∏ÄËÆ§ËØÅ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â¶ÇÊûúËÆ§ËØÅËøáÁ®ãÊäõÂá∫ÂºÇÂ∏∏ÔºåËÆ§ËØÅ‰∏çÈÄöËøá</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëã•ËÆ§ËØÅËøáÁ®ãÊ≤°ÊúâÊäõÂá∫ÂºÇÂ∏∏Ôºå‰πüÊ≤°ÊúâËøîÂõûself.user, self.authÔºåÂàôÂåøÂêçÊâßË°åËßÜÂõæÂáΩÊï∞</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">authenticator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">authenticators</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">user_auth_tuple</span> <span class="o">=</span> <span class="n">authenticator</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Ë∞ÉÁî®ËÆ§ËØÅÁ±ªÁöÑauthenticateÊñπÊ≥ïÔºåËøîÂõûÂÖÉÁªÑ</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">APIException</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_not_authenticated</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">user_auth_tuple</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_authenticator</span> <span class="o">=</span> <span class="n">authenticator</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="n">user_auth_tuple</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_not_authenticated</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_not_authenticated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_authenticator</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">UNAUTHENTICATED_USER</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">UNAUTHENTICATED_USER</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">UNAUTHENTICATED_TOKEN</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">UNAUTHENTICATED_TOKEN</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">APIView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">DEFAULT_AUTHENTICATION_CLASSES</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">as_view</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">initkwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">view</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="o">**</span><span class="n">initkwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">csrf_exempt</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Á¨¨‰∏ÄÊ≠•ÔºöËØ∑Ê±ÇÁöÑÂ∞ÅË£Ö(djangoÁöÑ request + drfÁöÑ authenticatorsËÆ§ËØÅÁªÑ‰ª∂)  --&gt; Âä†ËΩΩËÆ§ËØÅÁªÑ‰ª∂ËøáÁ®ã</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># request.authenticators  [ÂØπË±°1ÔºåÂØπË±°2Ôºå...]</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Á¨¨‰∫åÊ≠•ÔºöËÆ§ËØÅËøáÁ®ã</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_method_not_allowed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Á¨¨‰∏âÊ≠•ÔºöÊâßË°åËßÜÂõæÂáΩÊï∞</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># ËÆ§ËØÅÊó∂ÊäõÂá∫ÈîôËØØÂú®ËøôÈáåË¢´ÊçïËé∑</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">initialize_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Request</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">authenticators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_authenticators</span><span class="p">(),</span>  <span class="c1"># [ÂØπË±°1ÔºåÂØπË±°2Ôºå...]</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">perform_authentication</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_permissions</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_throttles</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">perform_authentication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_authenticators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ËøîÂõû‰∏Ä‰∏™ÂàóË°®ÊØè‰∏Ä‰∏™ÂÖÉÁ¥†ÈÉΩÊòØËÆ§ËØÅÁ±ªÂØπË±° [ÂØπË±°1ÔºåÂØπË±°2Ôºå...]</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="n">auth</span><span class="p">()</span> <span class="k">for</span> <span class="n">auth</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">authentication_classes</span><span class="p">]</span>  <span class="c1"># ‰ºòÂÖàËØªÂèñÂ±ÄÈÉ®ÈÖçÁΩÆÔºåÂêéÂÖ®Â±ÄÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">handle_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="p">(</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NotAuthenticated</span><span class="p">,</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthenticationFailed</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">auth_header</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">exc</span><span class="o">.</span><span class="n">auth_header</span> <span class="o">=</span> <span class="n">auth_header</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">exc</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">authenticators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticators</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">authenticators</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">authenticators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">authenticate_header</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">View</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">as_view</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">initkwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">view</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;UserView&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="54-ÊãìÂ±ï-Â≠êÁ±ªÁ∫¶Êùü">5.4 ÊãìÂ±ï-Â≠êÁ±ªÁ∫¶Êùü
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÂØπÂ≠êÁ±ªËøõË°åÁ∫¶ÊùüÔºåÁ∫¶ÊùüÂ≠êÁ±ª‰∏≠ÂøÖÈ°ªË¶ÅÂÆö‰πâËØ•ÊñπÊ≥ïÔºå‰∏çÁÑ∂Â∞±Êä•Èîô</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">Foo</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;123&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>BaseAuthenticationÁ±ªÂÆö‰πâ</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseAuthentication</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    All authentication classes should extend BaseAuthentication.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Authenticate the request and return a two-tuple of (user, token).
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&#34;.authenticate() must be overridden.&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="55-Ê°à‰æã-Áî®Êà∑ÁôªÂΩïÂíåËÆ§ËØÅ">5.5 Ê°à‰æã-Áî®Êà∑ÁôªÂΩïÂíåËÆ§ËØÅ
</h3><h4 id="551-ÂàõÂª∫Êï∞ÊçÆË°®">5.5.1 ÂàõÂª∫Êï∞ÊçÆË°®
</h4><blockquote>
<p>‰∏çÈÖçÁΩÆÂÖ∂‰ªñÊï∞ÊçÆÂ∫ìÔºåÈááÁî®ÈªòËÆ§ÁöÑ<code>sqlite</code>ÂÅöÁÆÄÂçïÊµãËØï</p></blockquote>
<ul>
<li><code>Ê≥®ÂÜåapp --&gt; settings.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.admin&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.auth&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.contenttypes&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.sessions&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.contrib.messages&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;api.apps.ApiConfig&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>api/models.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create your models here.</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Áî®Êà∑Ë°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Áî®Êà∑Âêç&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Áî®Êà∑Âêç&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ‰∏¥Êó∂ÂΩ¢Âºè„ÄÅÂêéÁª≠ÂèØ‰ª•‰ΩøÁî®jwtÁ≠â</span>
</span></span><span class="line"><span class="cl">    <span class="n">token</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;TOKEN&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂàõÂª∫Êï∞ÊçÆÂ∫ì</li>
</ul>
<p><img src="/post%5cpython%5cDRF%5cimage-20241215214124221.png"
	
	
	
	loading="lazy"
	
		alt="image-20241215214124221"
	
	
></p>
<ul>
<li>ÊâãÂä®Ê∑ªÂä†Êï∞ÊçÆÂÅöÊµãËØï</li>
</ul>
<p><img src="/post%5cpython%5cDRF%5cimage-20241215214406794.png"
	
	
	
	loading="lazy"
	
		alt="image-20241215214406794"
	
	
></p>
<h4 id="552-Ë∑ØÁî±Á≥ªÁªü">5.5.2 Ë∑ØÁî±Á≥ªÁªü
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;user/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;order/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">OrderView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="553-ËÆ§ËØÅÁªÑ‰ª∂">5.5.3 ËÆ§ËØÅÁªÑ‰ª∂
</h4><blockquote>
<p>ÂÆûÈôÖÂºÄÂèëËøáÁ®ã‰∏≠Â∫îÂÆöÂà∂ÂìçÂ∫îÁä∂ÊÄÅÁ†ÅÔºåËØ•Ê°à‰æã‰ΩøÁî®ÁÆÄÂçïÁöÑTrueÂíåFalseÊ†áËØÜÁä∂ÊÄÅ</p></blockquote>
<ul>
<li><code>settings.pyÂÖ®Â±ÄÈÖçÁΩÆ</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_USER&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.user=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_TOKEN&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.auth=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_AUTHENTICATION_CLASSES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.QueryParamsAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.HeaderAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.NoAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>ext/auth.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.authentication</span> <span class="kn">import</span> <span class="n">BaseAuthentication</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.exceptions</span> <span class="kn">import</span> <span class="n">AuthenticationFailed</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">QueryParamsAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñËØ∑Ê±ÇÂèÇÊï∞ÂÄº</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_object</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">user_object</span><span class="p">,</span> <span class="n">token</span>  <span class="c1"># request.user = Áî®Êà∑ÂØπË±°Ôºårequest.auth = token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HeaderAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñËØ∑Ê±ÇÂ§¥</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_AUTHORIZATION&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_object</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">user_object</span><span class="p">,</span> <span class="n">token</span>  <span class="c1"># request.user = Áî®Êà∑ÂØπË±°Ôºårequest.auth = token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NoAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">AuthenticationFailed</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="554-ËßÜÂõæÂáΩÊï∞">5.5.4 ËßÜÂõæÂáΩÊï∞
</h4><ul>
<li>postmanÂèëÈÄÅpostËØ∑Ê±ÇÊµãËØïÊé•Âè£Á§∫‰æã</li>
</ul>
<p><img src="/post%5cpython%5cDRF%5cimage-20241215215621539.png"
	
	
	
	loading="lazy"
	
		alt="image-20241215215621539"
	
	
></p>
<ul>
<li>ÁôªÂΩïÁîüÊàêtokenÊé•Âè£</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uuid</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.request</span> <span class="kn">import</span> <span class="n">Request</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Â±ÄÈÉ®ÈÖçÁΩÆÔºåËØ•ÂáΩÊï∞Êó†ÈúÄÁôªÂΩï</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Êé•Êî∂Áî®Êà∑postÊèê‰∫§ÁöÑÁî®Êà∑ÂêçÂØÜÁ†Å</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># request.dataÁõ¥Êé•ÊòØ‰∏Ä‰∏™Â≠óÂÖ∏Á±ªÂûã</span>
</span></span><span class="line"><span class="cl">        <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">pwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Êï∞ÊçÆÂ∫ìÊ†°È™å</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">pwd</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_object</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ÁôªÈôÜÊàêÂäü</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/post%5cpython%5cDRF%5cimage-20241215221444282.png"
	
	
	
	loading="lazy"
	
		alt="image-20241215221444282"
	
	
></p>
<ul>
<li>ÈúÄË¶ÅËÆ§ËØÅÁöÑËßÜÂõæÂáΩÊï∞</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;UserView&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="555-ËÆøÈóÆÊïàÊûú">5.5.5 ËÆøÈóÆÊïàÊûú
</h4><blockquote>
<p>Âú®ËØ∑Ê±ÇÂ§¥‰∏≠Êê∫Â∏¶ÂíåÂú®ËØ∑Ê±ÇÂèÇÊï∞‰∏≠Êê∫Â∏¶ÂùáÂèØÔºåÊúâÂØπÂ∫îÁöÑËÆ§ËØÅÁªÑ‰ª∂Ê†°È™å</p></blockquote>
<p><img src="/post%5cpython%5cDRF%5cimage-20241215223514300.png"
	
	
	
	loading="lazy"
	
		alt="image-20241215223514300"
	
	
></p>
<h3 id="56-ÊÄªÁªì">5.6 ÊÄªÁªì
</h3><p>ÁºñÂÜôÁªÑ‰ª∂</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># ext/auth.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.authentication</span> <span class="kn">import</span> <span class="n">BaseAuthentication</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.exceptions</span> <span class="kn">import</span> <span class="n">AuthenticationFailed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂéªÂÅöÁî®Êà∑ËÆ§ËØÅ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.ËØªÂèñËØ∑Ê±Ç‰º†ÈÄíÁöÑtoken</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Ê†°È™åÂêàÊ≥ïÊÄß</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ËøîÂõûÂÄº</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.1 ËøîÂõûÂÖÉÁªÑ (111,222) ËÆ§ËØÅÊàêÂäü request.user request.auth</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.2 ÊäõÂá∫ÂºÇÂ∏∏           ËÆ§ËØÅÂ§±Ë¥• -&gt; ËøîÂõûÈîôËØØ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.1 ËøîÂõûNone          Â§ö‰∏™ËÆ§ËØÅÁ±ª [Á±ª1ÔºåÁ±ª2ÔºåÁ±ª3ÔºåÁ±ª4ÔºåÔºåÔºå] -&gt; ÂåøÂêçÁî®Êà∑</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NotAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">AuthenticationFailed</span><span class="p">({</span><span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="mi">20000</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ®Â±ÄÈÖçÁΩÆÂåøÂêçÁî®Êà∑ÂíåËÆ§ËØÅÁ±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># settings.py</span>
</span></span><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_USER&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.user=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_TOKEN&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.auth=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_AUTHENTICATION_CLASSES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.ParamAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.HeaderAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.NotAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â±ÄÈÉ®ÈÖçÁΩÆËÆ§ËØÅÁ±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># views.py</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëß£ÂÜ≥Â§öËÆ§ËØÅÂèÇÊï∞‰º†ÈÄíÔºàËØ∑Ê±ÇÂèÇÊï∞ÂíåËØ∑Ê±ÇÂ§¥Á≠âÁ≠âÔºâÂíå ÂøÖÈ°ªËÆ§ËØÅÔºåÂÖ¨ÂÖ±Êé•Âè£ÔºàÂèØËÆ§ËØÅÂèØÂåøÂêçÔºâÔºåÊó†ÈúÄËÆ§ËØÅ‰∏âÁßçÁ±ªÂûãÊé•Âè£ &ndash;&gt;  ËßÅÊ°à‰æã4</p>
<h2 id="6-ÊùÉÈôê">6. ÊùÉÈôê
</h2><blockquote>
<ul>
<li>
<p>ËÆ§ËØÅÁªÑ‰ª∂ = [ËÆ§ËØÅÁ±ªÔºåËÆ§ËØÅÁ±ªÔºåËÆ§ËØÅÁ±ªÔºå]		-&gt;	ÊâßË°åÊØè‰∏Ä‰∏™ËÆ§ËØÅÁ±ªÁöÑauthenticateÊñπÊ≥ï</p>
<ul>
<li>
<p>ËÆ§ËØÅÊàêÂäüÊàñÂ§±Ë¥•Ôºå‰∏ç‰ºöÂÜçÊâßË°åÂêéÁª≠ÁöÑËÆ§ËØÅÁ±ª</p>
</li>
<li>
<p>ËøîÂõûNoneÔºåÊâßË°åÂêéÁª≠ËÆ§ËØÅÁ±ª</p>
</li>
</ul>
</li>
<li>
<p>ÊùÉÈôêÁªÑ‰ª∂ = [ÊùÉÈôêÁ±ªÔºåÊùÉÈôêÁ±ªÔºåÊùÉÈôêÁ±ªÔºå]        -&gt;    ÊâßË°åÊâÄÊúâÊùÉÈôêÁ±ªÁöÑhas_permissionÊñπÊ≥ïÔºåËøîÂõûTrueÈÄöËøáÔºåËøîÂõûFalse‰∏çÈÄöËøá</p>
<ul>
<li>ÊâßË°åÊâÄÊúâÁöÑÊùÉÈôêÁ±ª</li>
</ul>
</li>
</ul>
<p>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåË¶Å‰øùËØÅÊâÄÊúâÁöÑÊùÉÈôêÁ±ª‰∏≠ÁöÑhas_permissionÊñπÊ≥ïÈÉΩËøîÂõûTrueÔºåÂç≥<code>‰∏é</code>ÁöÑÂÖ≥Á≥ª</p>
<p>ÊéåÊè°Ê∫êÁ†ÅÊµÅÁ®ãÂêéÔºåÂèØ‰ª•Êâ©Â±ï+Ëá™ÂÆö‰πâÔºåÂÆûÁé∞ÂÖ∂‰ªñÈÄªËæë</p></blockquote>
<h3 id="61-Âø´ÈÄü‰ΩøÁî®">6.1 Âø´ÈÄü‰ΩøÁî®
</h3><ul>
<li>ÁºñÂÜôÁ±ª</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BasePermission</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">BasePermissionMetaclass</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    A base class from which all permission classes should inherit.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Return `True` if permission is granted, `False` otherwise.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈòÖËØªÊ∫êÁ†ÅÂèØÁü•ÔºåËá™ÂÆö‰πâÁöÑÊùÉÈôêÁ±ªÁöÑ<code>has_permission</code>Â∫îËøîÂõû<code>TrueÊàñFalse</code>Êù•Ë°®Á§∫ÊòØÂê¶ÊúâÊùÉÈôê</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># ext/per.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.permissions</span> <span class="kn">import</span> <span class="n">BasePermission</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyPermission</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñËØ∑Ê±Ç‰∏≠ÁöÑÊï∞ÊçÆÔºåÁÑ∂ÂêéËøõË°åÊ†°È™å...</span>
</span></span><span class="line"><span class="cl">        <span class="n">v1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â∫îÁî®Á±ª</li>
</ul>
<blockquote>
<p>ÂÖ®Â±ÄÂ∫îÁî®	Âú®<code>settings.py</code>‰∏≠ÈÖçÁΩÆ</p>
<p>Â±ÄÈÉ®Â∫îÁî®	Âú®ËßÜÂõæÂáΩÊï∞‰∏≠ÂÆö‰πâ<code>permission_classes = []</code>ÂèÇÊï∞</p>
<p>Ê†πÊçÆ‰∏öÂä°ÈúÄÊ±ÇÁÅµÊ¥ªÈÖçÁΩÆ</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_USER&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.user=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_TOKEN&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.auth=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_AUTHENTICATION_CLASSES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.ParamAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.HeaderAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.NotAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_PERMISSION_CLASSES&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.per.Mypermission&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/post%5cpython%5cDRF%5cimage-20241217125147471.png"
	
	
	
	loading="lazy"
	
		alt="image-20241217125147471"
	
	
></p>
<h3 id="62-ÈîôËØØ‰ø°ÊÅØÂíåÂ§ö‰∏™ÊùÉÈôêÁ±ª">6.2 ÈîôËØØ‰ø°ÊÅØÂíåÂ§ö‰∏™ÊùÉÈôêÁ±ª
</h3><ul>
<li>Âú®ÊùÉÈôêÁ±ª‰∏≠Ëá™ÂÆö‰πâÈîôËØØ‰ø°ÊÅØ<code>message</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyPermission</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Êó†ÊùÉËÆøÈóÆ&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñËØ∑Ê±Ç‰∏≠ÁöÑÊï∞ÊçÆÔºåÁÑ∂ÂêéËøõË°åÊ†°È™å...</span>
</span></span><span class="line"><span class="cl">        <span class="n">v1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∑¶Âõæ‰∏∫ÈªòËÆ§ÈîôËØØ‰ø°ÊÅØÔºåÂè≥Âõæ‰∏∫Ëá™ÂÆö‰πâÈîôËØØ‰ø°ÊÅØ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241217131658811.png"
	
	
	
	loading="lazy"
	
		alt="image-20241217131658811"
	
	
></p>
<ul>
<li>Â§ö‰∏™ÊùÉÈôêÁ±ª</li>
</ul>
<p><code>api/per.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.permissions</span> <span class="kn">import</span> <span class="n">BasePermission</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyPermission1</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Êó†ÊùÉËÆøÈóÆ&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;MyPermission1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyPermission2</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Êó†ÊùÉËÆøÈóÆ&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;MyPermission2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyPermission3</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Êó†ÊùÉËÆøÈóÆ&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;MyPermission3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>api/views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.per</span> <span class="kn">import</span> <span class="n">MyPermission1</span><span class="p">,</span> <span class="n">MyPermission2</span><span class="p">,</span> <span class="n">MyPermission3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyPermission1</span><span class="p">,</span> <span class="n">MyPermission2</span><span class="p">,</span> <span class="n">MyPermission3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁªàÁ´ØÂè™ÊâìÂç∞‰∫Ü<code>MyPermission1</code></p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241217140459678.png"
	
	
	
	loading="lazy"
	
		alt="image-20241217140459678"
	
	
></p>
<blockquote>
<p>ËØ¥ÊòéÁ®ãÂ∫è‰ºöÊåâÈ°∫Â∫èÊ†°È™åÊØè‰∏™ÊùÉÈôêÁ±ªÔºå‰∏ÄÊó¶Êúâ‰∏Ä‰∏™ËøîÂõûFalseÂç≥Ê†°È™å‰∏çÈÄöËøáÔºåÂàô‰∏çÂÜçÊ†°È™åÂêéÁª≠ÊùÉÈôêÁ±ªÔºåÂè™ÊúâÈÄöËøáÊØè‰∏Ä‰∏™ÊùÉÈôêÁ±ªÁöÑÊ†°È™åÊâçÁÆóÊúâÊùÉÈôêËÆøÈóÆ</p></blockquote>
<h3 id="63-Ê∫êÁ†ÅÊµÅÁ®ã">6.3 Ê∫êÁ†ÅÊµÅÁ®ã
</h3><blockquote>
<p>as_view()Á≠âÊñπÊ≥ïÁöÑË∞ÉÁî®Âú®ËÆ§ËØÅÁªÑ‰ª∂‰∏≠Â∑≤ËØ¶ÁªÜÈòêÊòéÔºåÊ≠§Â§ÑÁõ¥Êé•‰ªédispatch()ÊñπÊ≥ïÂºÄÂßã</p>
<p>ÂàùÂßãÂåñÁöÑinitialize_requestÊó†Ê∂âÂèäÔºåÁõ¥Êé•Êù•Âà∞initialÊñπÊ≥ïÔºåË∞ÉÁî®check_permissionsÊñπÊ≥ï</p>
<p>check_permissionsÊñπÊ≥ïÂæ™ÁéØÊùÉÈôêÁ±ªÂÆû‰æãÂØπË±°ÂàóË°®permission_classesÔºåË∞ÉÁî®has_permissionÊñπÊ≥ïÔºå‰∏ÄÊó¶ËøîÂõûFalseÔºåÂ∞±Ë∞ÉÁî®permission_deniedÊñπÊ≥ïÔºåÂπ∂‰º†ÂÖ•ÈîôËØØ‰ø°ÊÅØmessageÂíåcode</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">APIView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">DEFAULT_PERMISSION_CLASSES</span>  <span class="c1"># ÊùÉÈôêÁªÑ‰ª∂ÁöÑÂÖ®Â±ÄÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">permission_denied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">authenticators</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">successful_authenticator</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotAuthenticated</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">PermissionDenied</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñÊùÉÈôêÁ±ªÂØπË±°ÁöÑÂàóË°®</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="n">permission</span><span class="p">()</span> <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">permission_classes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Âæ™ÁéØÊØè‰∏Ä‰∏™ÊùÉÈôêÁ±ªÂØπË±°ÔºåÂà§Êñ≠ÊùÉÈôêÊ†°È™åÊòØÂê¶ÈÄöËøá</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permissions</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Â¶ÇÊûúÊú™ÈÄöËøáÔºåÂàôÊäõÂá∫ÂºÇÂ∏∏Âú®dispatch‰∏≠ÊçïËé∑</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">permission</span><span class="o">.</span><span class="n">has_permission</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">permission_denied</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">message</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="n">code</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">perform_authentication</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># ËÆ§ËØÅÁªÑ‰ª∂ÁöÑËøáÁ®ãÔºåÂæ™ÁéØÊâßË°åÊØè‰∏™authenticateÊñπÊ≥ïÔºõÂ§±Ë¥•ÂàôÊäõÂá∫ÂºÇÂ∏∏‰∏çÂêë‰∏ãÊâßË°å</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_permissions</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># ÊùÉÈôêÁöÑÊ†°È™å</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_throttles</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â∞ÅË£ÖdrfÁöÑrequest</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_response_headers</span>  <span class="c1"># deprecate?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ÂèçÂ∞ÑËé∑Âèñget/postÁ≠âÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">            <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_method_not_allowed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ÊâßË°åÁõ∏Â∫îÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂºÇÂ∏∏Â§ÑÁêÜ</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyPermission1</span><span class="p">,</span> <span class="n">MyPermission2</span><span class="p">,</span> <span class="n">MyPermission3</span><span class="p">]</span>  <span class="c1"># ÊùÉÈôêÁªÑ‰ª∂ÁöÑÂ±ÄÈÉ®ÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="64-ÁªÑ‰ª∂ÁöÑÊãìÂ±ï">6.4 ÁªÑ‰ª∂ÁöÑÊãìÂ±ï
</h3><blockquote>
<p>ÈÄöËøáÊ∫êÁ†ÅÂèØ‰ª•Áü•ÈÅìÔºåÂú®<code>check_permissions</code>‰∏≠ÔºåÂè™Ë¶ÅÊúâ‰∏Ä‰∏™ÊùÉÈôêÁ±ªÊ†°È™å‰∏çÈÄöËøáÂ∞±ÊòØÊó†ÊùÉËÆøÈóÆÔºåÈÇ£‰πàÂ¶Ç‰ΩïÊâçËÉΩÂÆûÁé∞ÊãìÂ±ïÔºå‰ΩøÂÖ∂Êª°Ë∂≥Âè™Ë¶ÅÊúâ‰∏Ä‰∏™ÊùÉÈôêÁ±ªÈÄöËøáÂ∞±ÊòØÊúâÊùÉÈôêÂë¢ÔºüÊòæËÄåÊòìËßÅÈúÄË¶ÅÈáçÂÜô<code>check_permissions</code>ÊñπÊ≥ï</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyPermission1</span><span class="p">,</span> <span class="n">MyPermission2</span><span class="p">,</span> <span class="n">MyPermission3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">no_permission_objects_list</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permissions</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">permission</span><span class="o">.</span><span class="n">has_permission</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">no_permission_objects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">permission_denied</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">message</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">no_permission_objects_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">code</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">no_permission_objects_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Âú®<code>OrderView</code>ËßÜÂõæ‰∏≠ÈáçÂÜô<code>check_permissions</code>ÊñπÊ≥ïÔºåÂàôÂú®ÊùÉÈôêÊ†°È™åÁöÑÁîüÂëΩÂë®Êúü‰∏≠ÔºåËá™ÂÆö‰πâÁöÑ<code>check_permissions</code>‰æøË¶ÜÁõñ‰∫Ü<code>APIView</code>‰∏≠ÁöÑÈªòËÆ§<code>check_permissions</code>ÂÆûÁé∞ÈÄªËæëÔºåËææÂà∞Ëá™ÂÆö‰πâÊãìÂ±ïÁöÑÊïàÊûú</p>
<p>Ëá™ÂÆö‰πâÁöÑ<code>check_permissions</code>ÂÆûÁé∞‰∫Ü‰∏ÄÊó¶Êüê‰∏ÄÊùÉÈôêÁ±ªÊ†°È™åÈÄöËøáÔºåÂ∞±‰∏çÂÜçËøõË°åÂêéÁª≠Ê†°È™å„ÄÇËã•ÊâÄÊúâÁ±ªÂùáÊú™ÈÄöËøáÔºåÂàôËøîÂõûÁ¨¨‰∏Ä‰∏™Êú™ÈÄöËøáÁöÑÁ±ªÁöÑÈîôËØØ‰ø°ÊÅØ</p>
<p>Áî±Ê≠§ÂèØËßÅÂ≠¶‰π†Ê∫êÁ†ÅÁöÑÈáçË¶ÅÊÄßÔºå‰∏ç‰ªÖÂèØ‰ª•Â≠¶‰π†Ê∫êÁ†Å‰∏≠‰ºòÁßÄÁöÑ‰ª£Á†ÅÁºñÂÜôÊñπÂºèÔºåËøòÂèØ‰ª•Âú®ÂéüÊúâÈÄªËæëÁöÑÂü∫Á°Ä‰∏äËøõË°åÊãìÂ±ï</p></blockquote>
<p>‰∏äËø∞ÊòØ‰øÆÊîπ‰∏Ä‰∏™ËßÜÂõæÂáΩÊï∞ÁöÑÊùÉÈôêÊ†°È™åÈÄªËæëÔºåÂ¶Ç‰ΩïÂ∫îÁî®Âà∞ÂÖ∂‰ªñËßÜÂõæÂë¢Ôºü</p>
<blockquote>
<p>ÂèØ‰ª•Ëá™ÂÆö‰πâ‰∏Ä‰∏™<code>NbApiView</code>ÁöÑÁ±ªÔºåÁªßÊâø<code>APIView</code>Âπ∂‰∏îÈáçÂÜô<code>check_permissions</code>Ôºå‰πãÂêéË¶ÅÂÆûÁé∞ÊàñÈÄªËæëÁöÑÊùÉÈôêËÆ§ËØÅÁöÑËßÜÂõæÂè™ÈúÄÁªßÊâø<code>NbApiView</code>Âç≥ÂèØ</p></blockquote>
<ul>
<li><code>ext/view.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbApiView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">no_permission_objects_list</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permissions</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">permission</span><span class="o">.</span><span class="n">has_permission</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">no_permission_objects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">permission_denied</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">message</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">no_permission_objects_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">code</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">no_permission_objects_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>api/views.py</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.per</span> <span class="kn">import</span> <span class="n">MyPermission1</span><span class="p">,</span> <span class="n">MyPermission2</span><span class="p">,</span> <span class="n">MyPermission3</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.view</span> <span class="kn">import</span> <span class="n">NbApiView</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">NbApiView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyPermission1</span><span class="p">,</span> <span class="n">MyPermission2</span><span class="p">,</span> <span class="n">MyPermission3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="65-Ê°à‰æã-ÊùÉÈôêÂ§ÑÁêÜ">6.5 Ê°à‰æã-ÊùÉÈôêÂ§ÑÁêÜ
</h3><h4 id="651-ÂàõÂª∫Êï∞ÊçÆË°®">6.5.1 ÂàõÂª∫Êï∞ÊçÆË°®
</h4><p><img src="/post%5cpython%5cDRF%5cimage-20241217171036327.png"
	
	
	
	loading="lazy"
	
		alt="image-20241217171036327"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Áî®Êà∑Ë°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">role</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ËßíËâ≤&#34;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;ÊÄªÁõë&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;ÁªèÁêÜ&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;ÂëòÂ∑•&#34;</span><span class="p">)),</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Áî®Êà∑Âêç&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Áî®Êà∑Âêç&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ‰∏¥Êó∂ÂΩ¢Âºè„ÄÅÂêéÁª≠ÂèØ‰ª•‰ΩøÁî®jwtÁ≠â</span>
</span></span><span class="line"><span class="cl">    <span class="n">token</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;TOKEN&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">makemigrations</span>
</span></span><span class="line"><span class="cl"><span class="n">migrate</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâãÂä®Ê∑ªÂä†Êï∞ÊçÆ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241217172759096.png"
	
	
	
	loading="lazy"
	
		alt="image-20241217172759096"
	
	
></p>
<h4 id="652-Ë∑ØÁî±Á≥ªÁªü">6.5.2 Ë∑ØÁî±Á≥ªÁªü
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;user/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;order/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">OrderView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;avatar/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">AvatarView</span><span class="o">.</span><span class="n">as_view</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="653-ËÆ§ËØÅÁªÑ‰ª∂">6.5.3 ËÆ§ËØÅÁªÑ‰ª∂
</h4><blockquote>
<p>Ê†πÊçÆ‰º†ÂÖ•tokenËøîÂõûÁî®Êà∑ÂØπË±°</p></blockquote>
<p><code>ext/auth.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.authentication</span> <span class="kn">import</span> <span class="n">BaseAuthentication</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.exceptions</span> <span class="kn">import</span> <span class="n">AuthenticationFailed</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">QueryParamsAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_object</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">user_object</span><span class="p">,</span> <span class="n">token</span>  <span class="c1"># request.user = Áî®Êà∑ÂØπË±°Ôºårequest.auth = token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HeaderAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_AUTHORIZATION&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_object</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">user_object</span><span class="p">,</span> <span class="n">token</span>  <span class="c1"># request.user = Áî®Êà∑ÂØπË±°Ôºårequest.auth = token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NoAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">AuthenticationFailed</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Token&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="654-ÊùÉÈôêÁªÑ‰ª∂">6.5.4 ÊùÉÈôêÁªÑ‰ª∂
</h4><p><code>ext/per.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.permissions</span> <span class="kn">import</span> <span class="n">BasePermission</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserPermission</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Êó†ÊùÉËÆøÈóÆ1&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ManagerPermission</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Êó†ÊùÉËÆøÈóÆ1&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BossPermission</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Êó†ÊùÉËÆøÈóÆ1&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ext/view.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbApiView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">no_permission_objects_list</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permissions</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">permission</span><span class="o">.</span><span class="n">has_permission</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">no_permission_objects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">permission_denied</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">message</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">no_permission_objects_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">code</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">no_permission_objects_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="655-ËßÜÂõæÂáΩÊï∞">6.5.5 ËßÜÂõæÂáΩÊï∞
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uuid</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.per</span> <span class="kn">import</span> <span class="n">UserPermission</span><span class="p">,</span> <span class="n">ManagerPermission</span><span class="p">,</span> <span class="n">BossPermission</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.view</span> <span class="kn">import</span> <span class="n">NbApiView</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Êé•Êî∂Áî®Êà∑postÊèê‰∫§ÁöÑÁî®Êà∑ÂêçÂØÜÁ†Å</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(request.query_params)  # Ëé∑ÂèñgetËØ∑Ê±ÇÊèê‰∫§ÁöÑÂèÇÊï∞</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># request.dataÁõ¥Êé•ÊòØ‰∏Ä‰∏™Â≠óÂÖ∏Á±ªÂûã</span>
</span></span><span class="line"><span class="cl">        <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">pwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Êï∞ÊçÆÂ∫ìÊ†°È™å</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">pwd</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_object</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ÁôªÈôÜÊàêÂäü</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_object</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">NbApiView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÁªèÁêÜ„ÄÅÊÄªÊ£Ä„ÄÅÊôÆÈÄöÁî®Êà∑ÈÉΩÂèØ‰ª•ËÆøÈóÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">BossPermission</span><span class="p">,</span> <span class="n">ManagerPermission</span><span class="p">,</span> <span class="n">UserPermission</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;UserView&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">NbApiView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÁªèÁêÜ„ÄÅÊÄªÁõëÂèØ‰ª•ËÆøÈóÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">BossPermission</span><span class="p">,</span> <span class="n">ManagerPermission</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AvatarView</span><span class="p">(</span><span class="n">NbApiView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÊÄªÁõë„ÄÅÂëòÂ∑•ÂèØ‰ª•ËÆøÈóÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">BossPermission</span><span class="p">,</span> <span class="n">UserPermission</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="656-ËÆøÈóÆÊïàÊûú">6.5.6 ËÆøÈóÆÊïàÊûú
</h4><blockquote>
<p><code>token2</code>ÂØπÂ∫î<code>ÁªèÁêÜ</code></p>
<p><code>token3</code>ÂØπÂ∫î<code>ÂëòÂ∑•</code></p>
<p>ÂëòÂ∑•ÂèØ‰ª•ËÆøÈóÆ<code>/avatar</code>,ËÆøÈóÆ‰∏ç‰∫Ü<code>/order</code></p>
<p>ÁªèÁêÜÂèØ‰ª•ËÆøÈóÆ<code>/order</code>,ËÆøÈóÆ‰∏ç‰∫Ü<code>/avatar</code></p></blockquote>
<p><img src="/post%5cpython%5cDRF%5cimage-20241217173736707.png"
	
	
	
	loading="lazy"
	
		alt="image-20241217173736707"
	
	
></p>
<h3 id="66-ÊÄùËÄÉ">6.6 ÊÄùËÄÉ
</h3><blockquote>
<p>Âú®ÂºÄÂèëËøáÁ®ã‰∏≠,ÂèëÁé∞drf‰∏≠ÁöÑrequestÂØπË±°‰∏çÂ•ΩÁî®,Â∫îËØ•Â¶Ç‰ΩïÊç¢ÊàêÂè¶‰∏Ä‰∏™requestÁ±ªÂØπË±°?</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AvatarView</span><span class="p">(</span><span class="n">NbApiView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÊÄªÁõë„ÄÅÂëòÂ∑•ÂèØ‰ª•ËÆøÈóÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">BossPermission</span><span class="p">,</span> <span class="n">UserPermission</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">initialize_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># super().initialize_request()</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parser_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Request</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">parsers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parsers</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">authenticators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_authenticators</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">negotiator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_content_negotiator</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">parser_context</span><span class="o">=</span><span class="n">parser_context</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÜçËá™Â∑±ÂÆö‰πâ‰∏Ä‰∏™RequestÁ±ªÂç≥ÂèØÂÆåÊàêÊé•ÁÆ°,ÈΩêÊ¥ª!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>drf‰∏≠ÁöÑËÆ§ËØÅ/ÊùÉÈôêÁªÑ‰ª∂‰∏édjango‰∏≠ÁöÑ‰∏≠Èó¥‰ª∂Êúâ‰ªÄ‰πàÂÖ≥Á≥ª?</p>
<p>ËÆ§ËØÅ/ÊùÉÈôêÁªÑ‰ª∂Âú®‰∏≠Èó¥‰ª∂‰πãÂêé</p></blockquote>
<p><img src="/post%5cpython%5cDRF%5cimage-20241217182023566.png"
	
	
	
	loading="lazy"
	
		alt="image-20241217182023566"
	
	
></p>
<h3 id="67-ÊÄªÁªì">6.7 ÊÄªÁªì
</h3><p>ÈªòËÆ§ÊåâÊùÉÈôêÁ±ªÂàóË°®ÂÆö‰πâÁöÑÈ°∫Â∫èÂà§Êñ≠ÊØè‰∏Ä‰∏™ÊùÉÈôêÔºåËøîÂõûTrueÁªßÁª≠Âà§Êñ≠ÔºåÁü•ÈÅìÊâÄÊúâÊùÉÈôêÁ±ªÂùáÈÄöËøáÔºõËøîÂõûFalseÁõ¥Êé•ÈÄÄÂá∫ÔºåÊó†ÊùÉÈôê</p>
<p>ÈÄöËøá‰øÆÊîπcheck_permissionsÁöÑÈÄªËæëÂèØ‰ª•ÂÆûÁé∞ÔºåËøîÂõûTrueÁõ¥Êé•ÈÄÄÂá∫ÔºåÊúâÊùÉÈôêÔºõËøîÂõûFalseÁªßÁª≠Âà§Êñ≠ÔºåÁü•ÈÅìÊúâTrueÔºåËã•ÂÖ®‰∏∫FalseÔºåÊó†ÊùÉÈôê</p>
<p>ÂÖ®Â±ÄÈÖçÁΩÆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_USER&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.user=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_TOKEN&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.auth=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_AUTHENTICATION_CLASSES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.ParamAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.HeaderAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.NotAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_PERMISSION_CLASSES&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.per.Mypermission&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ext/per.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.permissions</span> <span class="kn">import</span> <span class="n">BasePermission</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserPermission</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Â≠êÂÆö‰πâÈîôËØØ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;Êó†ÊùÉËÆøÈóÆ1&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># ÊùÉÈôêÂà§Êñ≠ÔºåTrueÊàñFalse</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ext/view.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbApiView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">no_permission_objects_list</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permissions</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">permission</span><span class="o">.</span><span class="n">has_permission</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">no_permission_objects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">permission_denied</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">request</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">message</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">no_permission_objects_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">code</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">no_permission_objects_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËßÜÂõæÂáΩÊï∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.per</span> <span class="kn">import</span> <span class="n">UserPermission</span><span class="p">,</span> <span class="n">ManagerPermission</span><span class="p">,</span> <span class="n">BossPermission</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.view</span> <span class="kn">import</span> <span class="n">NbApiView</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÁªßÊâøËá™ÂÆö‰πâËØïÂõæÁ±ªÔºåÊîπÂèòÊùÉÈôêÈÄªËæë</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">NbApiView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># Â±ÄÈÉ®ÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">BossPermission</span><span class="p">,</span> <span class="n">ManagerPermission</span><span class="p">,</span> <span class="n">UserPermission</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="7-ÈôêÊµÅ">7. ÈôêÊµÅ
</h2><h3 id="71-Âü∫Êú¨ÈÄªËæë">7.1 Âü∫Êú¨ÈÄªËæë
</h3><blockquote>
<p>ÂºÄÂèëËøáÁ®ã‰∏≠ÔºåÊüê‰∏™Êé•Âè£‰∏çÊÉ≥ËÆ©Áî®Êà∑ËÆøÈóÆËøá‰∫éÈ¢ëÁπÅÔºåÈúÄË¶ÅÈôêÊµÅÊú∫Âà∂</p>
<p>‰æãÂ¶ÇÔºöÂπ≥Âè∞ÂèëÈÄÅÈ™åËØÅÁ†ÅÔºåÈô§‰∫Ü‰∫ëÂéÇÂïÜÊèê‰æõÁöÑÈôêÂà∂ÔºåÂèØËÉΩËøòÈúÄË¶ÅÂÅöÂÖ∂‰ªñÈôêÂà∂ÔºåÂ¶ÇIPÈôêÂà∂„ÄÅÈ™åËØÅÁ†ÅÁ≠âÁ≠â</p>
<p>ÈôêÂà∂ËÆøÈóÆÈ¢ëÁéáÈúÄË¶ÅÊâæÂà∞ÂîØ‰∏ÄÊ†áËØÜ:</p>
<pre><code>  - Â∑≤ÁôªÂΩïÁî®Êà∑ÔºåÂèØ‰ª•‰ΩøÁî®Áî®Êà∑‰ø°ÊÅØ‰∏ªÈîÆÔºåIDÔºåÁî®Êà∑Âêç
  - Êú™ÁôªÂΩïÁî®Êà∑ÔºåÂèØ‰ª•ÈááÁî®IP‰Ωú‰∏∫ÂîØ‰∏ÄÊ†áËØÜ
</code></pre></blockquote>
<p>Â¶Ç‰ΩïÈôêÂà∂Ôºü</p>
<p>Áª¥Êä§‰∏Ä‰∏™<code>ÂîØ‰∏ÄÊ†áËØÜÔºöËÆøÈóÆËÆ∞ÂΩïÂàóË°®</code></p>
<blockquote>
<p><code>&quot;121&quot;Ôºö[ 20:35  20:32  20:22  20:12 ]</code>     ÈôêÂà∂10ÂàÜÈíü3Ê¨°</p>
<ol>
<li>
<p>Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥  20:36</p>
</li>
<li>
<p>ÂΩìÂâçÊó∂Èó¥-10ÂàÜÈíü=ËÆ°Êï∞ÂºÄÂßãÊó∂Èó¥  20Ôºö26</p>
</li>
<li>
<p>Âà†Èô§Â∞è‰∫é20Ôºö26ÁöÑËÆ∞ÂΩï</p>
</li>
<li>
<p>ËÆ°ÁÆóÈïøÂ∫¶</p>
<p>‚Äã	4.1 Ë∂ÖËøáÔºåÊä•Èîô</p>
<p>‚Äã	4.2 Êú™Ë∂ÖËøáÔºåËÆøÈóÆ</p>
</li>
</ol></blockquote>
<h3 id="72-Âø´ÈÄü‰ΩøÁî®">7.2 Âø´ÈÄü‰ΩøÁî®
</h3><ul>
<li>ÁºñÂÜôÁ±ª</li>
</ul>
<blockquote>
<p>ÈáçÂÜô‰∫ÜËé∑ÂèñÂîØ‰∏ÄÊ†áËØÜÁöÑget_cache_keyÊñπÊ≥ïÔºå‰ºòÂÖà‰ΩøÁî®Áî®Êà∑idÔºåËã•Ê≤°ÊúâÂÜçÈááÁî®ÈªòËÆ§ÁöÑËé∑ÂèñËØ∑Ê±ÇipÂÅöÂîØ‰∏ÄÊ†áËØÜ</p>
<p>ÂêéÁª≠ÂèØ‰ª•ËøûÊé•redisÂ∞ÜÊ†áËØÜÂÅöÈîÆÔºåËÆøÈóÆËÆ∞ÂΩïÂ≠òÂÇ®‰∏∫ÂØπÂ∫îÁöÑÂÄºËøõË°åËÅîÂä®</p></blockquote>
<ul>
<li><code>ext/throttle.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.throttling</span> <span class="kn">import</span> <span class="n">SimpleRateThrottle</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span> <span class="k">as</span> <span class="n">default_cache</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyThrottle</span><span class="p">(</span><span class="n">SimpleRateThrottle</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="s2">&#34;XXX&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">THROTTLE_RATES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;XXX&#34;</span><span class="p">:</span> <span class="s2">&#34;5/m&#34;</span><span class="p">}</span>  <span class="c1"># ÈôêÂà∂È¢ëÁéá</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache</span> <span class="o">=</span> <span class="n">default_cache</span>  <span class="c1"># redisÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Ëé∑ÂèñÂîØ‰∏ÄÊ†áËØÜÔºåÂêéÁª≠ÂèØ‰ª•ËøûÊé•redisÂÅöÊìç‰Ωú</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">ident</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span>  <span class="c1"># Áî®Êà∑ID</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ident</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># Ëé∑ÂèñËØ∑Ê±ÇÁî®Êà∑IPÔºàÂéªrequest‰∏≠ÊâæËØ∑Ê±ÇÂ§¥Ôºâ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># cache_format = &#39;throttle_%(scope)s_%(ident)s&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_format</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="s1">&#39;ident&#39;</span><span class="p">:</span> <span class="n">ident</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>redisÈÖçÁΩÆ</li>
</ul>
<blockquote>
<p>1.django-redisÈÖçÁΩÆ 	-&gt;	settings.py
2.ÂÆâË£Ödjango-redis	pip install django-redis
3.ÂêØÂä®redisÊúçÂä°</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># settings.py</span>
</span></span><span class="line"><span class="cl"><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;default&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;BACKEND&#34;</span><span class="p">:</span> <span class="s2">&#34;django_redis.cache.RedisCache&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;LOCATION&#34;</span><span class="p">:</span> <span class="s2">&#34;redis://127.0.0.1:6379&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;OPTIONS&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;CLIENT_CLASS&#34;</span><span class="p">:</span> <span class="s2">&#34;django_redis.client.DefaultClient&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;PASSWORD&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â∫îÁî®Á±ª</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.throttle</span> <span class="kn">import</span> <span class="n">MyThrottle</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyThrottle</span><span class="p">,]</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/post%5cpython%5cDRF%5cimage-20241218093359538.png"
	
	
	
	loading="lazy"
	
		alt="image-20241218093359538"
	
	
></p>
<h3 id="73-Ê∫êÁ†ÅÊµÅÁ®ã">7.3 Ê∫êÁ†ÅÊµÅÁ®ã
</h3><blockquote>
<ol>
<li>
<p>ÂØπË±°Âä†ËΩΩ</p>
<p>Ëé∑ÂèñÊØè‰∏™ÈôêÊµÅÁ±ªÂØπË±°ÔºåÂàùÂßãÂåñÔºàËØªÂèñÈôêÊµÅÈÖçÁΩÆÔºåËé∑ÂèñÊó∂Èó¥Èó¥ÈöîÂíåËÆøÈóÆÊ¨°Êï∞Ôºâ</p>
</li>
<li>
<p>allow_requestÂà§Êñ≠ÊòØÂê¶ÈôêÊµÅ</p>
</li>
</ol></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‰ªédispatchÊñπÊ≥ïÁöÑinitialÊñπÊ≥ïÂºÄÂßãÔºåË∞ÉÁî®‰∫Ücheck_throttlesÊñπÊ≥ï
</span></span><span class="line"><span class="cl">check_throttlesÊñπÊ≥ï‰∏≠Ôºö
</span></span><span class="line"><span class="cl">	self.get_throttles()Ôºå‰ªéÂ±ÄÈÉ®ÈÖçÁΩÆÊàñÂÖ®Â±ÄÈÖçÁΩÆËØªÂèñÈôêÊµÅÁ±ªÂàóË°®throttle_classesÔºåÁÑ∂ÂêéÈÄê‰∏ÄÂÆû‰æãÂåñÔºåËøîÂõû‰∏Ä‰∏™ÈôêÊµÅÁ±ªÂØπË±°ÂàóË°®
</span></span><span class="line"><span class="cl">	Âæ™ÁéØ‰∏äËø∞ÂàóË°®ÔºåË∞ÉÁî®ÊØè‰∏Ä‰∏™Á±ªÁöÑallow_requestÊñπÊ≥ïÔºåÂ¶ÇÊûúËøîÂõûFalseÂç≥Ë¢´ÈôêÊµÅÔºåÂ∞ÜÁ≠âÂæÖÊó∂Èó¥Ê∑ªÂä†Âà∞ÂàóË°®throttle_durations‰∏≠ÔºåÂπ∂Ëé∑ÂèñÊúÄÂ§ßÁ≠âÂæÖÊó∂Èó¥durationÔºåÁÑ∂ÂêéÊäõÂá∫ÂºÇÂ∏∏
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ÂØπ‰∫éÊØè‰∏Ä‰∏™ÈôêÊµÅÁ±ªÔºåÂæ™ÁéØthrottle_classesÂÆû‰æãÂåñÊó∂ÔºåÈáçÂÜô‰∫ÜscopeÔºåTHROTTLE_RATESÔºåcacheÔºåget_cache_keyÁ≠âÁ≠âÂ±ûÊÄßÊñπÊ≥ïÔºåÂπ∂Ë∞ÉÁî®__init__ÂàùÂßãÂåñ
</span></span><span class="line"><span class="cl">	Ë∞ÉÁî®get_rateÊñπÊ≥ïÔºåËé∑ÂèñTHROTTLE_RATES[self.scope]‰Ωú‰∏∫rateÔºåÂ¶Ç5/m
</span></span><span class="line"><span class="cl">	Ë∞ÉÁî®parse_rateÊñπÊ≥ïÔºåÂ∞Ürate‰Ωú‰∏∫ÂèÇÊï∞ÔºåËøîÂõûÊ¨°Êï∞‰∏éÈó¥ÈöîÁªônum_requestsÂíåduration
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">ÊØè‰∏Ä‰∏™Á±ªÊâßË°åallow_requestÊó∂ÔºåË∞ÉÁî®get_cache_keyËé∑ÂèñÂîØ‰∏ÄÊ†áËØÜkeyÔºå‰ªécache‰∏≠Ê†πÊçÆkeyËé∑ÂèñÂØπÂ∫îÁª¥Êä§ÁöÑËÆ∞ÂΩïÂàóË°®ÁªôhistoryÔºåËé∑ÂèñÂΩìÂâçÊó∂Èó¥nowÔºåÂæ™ÁéØhistoryÔºåÂ∞ÜÊó∂Èó¥Â∞è‰∫énow-durationÂç≥ËÆ°Êï∞Ëµ∑ÁÇπÁöÑËÆ∞ÂΩïpopÊéâÔºåÊØîËæÉÂàóË°®Ââ©‰ΩôÈïøÂ∫¶‰∏énum_requests
</span></span><span class="line"><span class="cl">	Â¶ÇÊûúË∂ÖËøáÈôêÂà∂ÔºåË∞ÉÁî®throttle_failure
</span></span><span class="line"><span class="cl">	Ê≠£Â∏∏ËÆøÈóÆÔºåË∞ÉÁî®throttle_success
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">Ê≠£Â∏∏ËÆøÈóÆÔºåthrottle_successÂ∞ÜÊú¨Ê¨°ËÆ∞ÂΩïÂä†ÂÖ•historyÔºåÂπ∂Êõ¥Êñ∞ÁºìÂ≠òÔºåËøîÂõûTrue
</span></span><span class="line"><span class="cl">Ë∂ÖËøáÈôêÂà∂ÔºåË∞ÉÁî®throttle_failureËøîÂõûFalse
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseThrottle</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">allow_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;.allow_request() must be overridden&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_ident</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SimpleRateThrottle</span><span class="p">(</span><span class="n">BaseThrottle</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache</span> <span class="o">=</span> <span class="n">default_cache</span>
</span></span><span class="line"><span class="cl">    <span class="n">timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache_format</span> <span class="o">=</span> <span class="s1">&#39;throttle_</span><span class="si">%(scope)s</span><span class="s1">_</span><span class="si">%(ident)s</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÂÖ®Â±ÄÈÖçÁΩÆÁöÑscope‰∏éTHROTTLE_RATESÂØπÂ∫îÂÖ≥Á≥ªÔºåÂèØ‰ª•Âú®settings.py‰∏≠ÈÖçÁΩÆDEFAULT_THROTTLE_RATESÔºåÂú®Ëá™ÂÆö‰πâÈôêÊµÅÁ±ª‰∏≠Âè™ÈúÄÊåáÂÆöscopeÂç≥ÂèØ</span>
</span></span><span class="line"><span class="cl">    <span class="n">THROTTLE_RATES</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">DEFAULT_THROTTLE_RATES</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ÂàùÂßãÂåñËÆøÈóÆÈôêÂà∂ÁöÑÊ¨°Êï∞‰∏éÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate</span><span class="p">()</span>  <span class="c1"># &#34;5/m&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">num_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_rate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;.get_cache_key() must be overridden&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;scope&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&#34;You must set either `.scope` or `.rate` for &#39;</span><span class="si">%s</span><span class="s2">&#39; throttle&#34;</span> <span class="o">%</span>
</span></span><span class="line"><span class="cl">                   <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># THROTTLE_RATES = {&#34;XXX&#34;: &#34;5/m&#34;}  # ÈôêÂà∂È¢ëÁéá</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># scope = &#34;XXX&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">THROTTLE_RATES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&#34;No default throttle rate set for &#39;</span><span class="si">%s</span><span class="s2">&#39; scope&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Â∞ÜTHROTTLE_RATESÂàáÂâ≤‰∏∫Ê¨°Êï∞ÂíåÂØπÂ∫îÊó∂Èó¥ËåÉÂõ¥</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># &#34;5/m&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">num</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">num_requests</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># period[0]ÂèñÂá∫s„ÄÅmÊàñhÔºåÂõ†Ê≠§Ëá™ÂÆö‰πâTHROTTLE_RATESÊó∂‰πüÂèØ‰ª•Â∞ÜhÂÜôÊàêhourÔºåÂõ†‰∏∫ÂÆÉÂè™ËØªÂèñÁ¥¢Âºï‰∏∫Èõ∂ÁöÑÂ≠óÁ¨¶</span>
</span></span><span class="line"><span class="cl">        <span class="n">duration</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">}[</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">num_requests</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>  <span class="c1"># ËøîÂõû 5 60</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">allow_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñÂîØ‰∏ÄÊ†áËØÜ</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cache_key</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñÂéÜÂè≤ËÆøÈóÆËÆ∞ÂΩï[20:35  20:32  20:22  20:12]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Âæ™ÁéØ Â∞ÜÂ∞è‰∫éËÆ°Êï∞ÂºÄÂßãÊó∂Èó¥ÂâîÈô§</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ËÆ°ÁÆóÈïøÂ∫¶</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_requests</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">throttle_failure</span><span class="p">()</span>  <span class="c1"># Ë∂ÖËøáÈôêÂà∂ÔºåËøîÂõûFalse</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">throttle_success</span><span class="p">()</span>  <span class="c1"># Ê≠£Â∏∏ËÆøÈóÆÔºåËøîÂõûTrue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">throttle_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â∞ÜÊú¨Ê¨°ËØ∑Ê±Ç‰∫ã‰ª∂Âä†ÂÖ•ÂéÜÂè≤ËÆøÈóÆËÆ∞ÂΩï‰∏≠</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">throttle_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">remaining_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># ËøòÈúÄË¶ÅÁ≠âÂæÖÁöÑÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">remaining_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">available_requests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_requests</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">available_requests</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">remaining_duration</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">available_requests</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyThrottle</span><span class="p">(</span><span class="n">SimpleRateThrottle</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="s2">&#34;XXX&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">THROTTLE_RATES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;XXX&#34;</span><span class="p">:</span> <span class="s2">&#34;5/m&#34;</span><span class="p">}</span>  <span class="c1"># ÈôêÂà∂È¢ëÁéá</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache</span> <span class="o">=</span> <span class="n">default_cache</span>  <span class="c1"># redisÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Ëé∑ÂèñÂîØ‰∏ÄÊ†áËØÜÔºåÂêéÁª≠ÂèØ‰ª•ËøûÊé•redisÂÅöÊìç‰Ωú</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">ident</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span>  <span class="c1"># Áî®Êà∑ID</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ident</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># Ëé∑ÂèñËØ∑Ê±ÇÁî®Êà∑IPÔºàÂéªrequest‰∏≠ÊâæËØ∑Ê±ÇÂ§¥Ôºâ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># cache_format = &#39;throttle_%(scope)s_%(ident)s&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_format</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="s1">&#39;ident&#39;</span><span class="p">:</span> <span class="n">ident</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">APIView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">DEFAULT_THROTTLE_CLASSES</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_throttles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂàõÂª∫ÈôêÊµÅÁ±ªÂÆû‰æãÂØπË±°ÔºåËøîÂõûÈôêÊµÅÁ±ªÂØπË±°ÂàóË°®ÔºåÂ±ÄÈÉ®ÈÖçÁΩÆ‰ºòÂÖà‰∫éÂÖ®Â±Ä</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="n">throttle</span><span class="p">()</span> <span class="k">for</span> <span class="n">throttle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">throttle_classes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_throttles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">throttle_durations</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Âæ™ÁéØÊØè‰∏™ÂØπË±°  -&gt;  allow_requestÂà∞Â∫ïÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">throttle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_throttles</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Ë∂ÖËøáÈ¢ëÁéáÈôêÂà∂Ôºå‰∏çÂÖÅËÆ∏ËÆøÈóÆ</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">throttle</span><span class="o">.</span><span class="n">allow_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Â∞ÜÁ≠âÂæÖÊó∂Èó¥Ê∑ªÂä†ËøõÂàóË°®</span>
</span></span><span class="line"><span class="cl">                <span class="n">throttle_durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">throttle</span><span class="o">.</span><span class="n">wait</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">throttle_durations</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="n">duration</span> <span class="k">for</span> <span class="n">duration</span> <span class="ow">in</span> <span class="n">throttle_durations</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Ëé∑ÂèñÊúÄÂ§ßÁ≠âÂæÖÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl">            <span class="n">duration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">durations</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ÊäõÂá∫ÂºÇÂ∏∏</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">throttled</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">throttled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">wait</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">Throttled</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">perform_authentication</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># ËÆ§ËØÅÁªÑ‰ª∂ÁöÑËøáÁ®ãÔºåÂæ™ÁéØÊâßË°åÊØè‰∏™authenticateÊñπÊ≥ïÔºõÂ§±Ë¥•ÂàôÊäõÂá∫ÂºÇÂ∏∏‰∏çÂêë‰∏ãÊâßË°å</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_permissions</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># ÊùÉÈôêÁöÑÊ†°È™å</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_throttles</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â∞ÅË£ÖdrfÁöÑrequest</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_response_headers</span>  <span class="c1"># deprecate?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ÂèçÂ∞ÑËé∑Âèñget/postÁ≠âÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">            <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_method_not_allowed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ÊâßË°åÁõ∏Â∫îÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂºÇÂ∏∏Â§ÑÁêÜ</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyThrottle</span><span class="p">(</span><span class="n">SimpleRateThrottle</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="s2">&#34;XXX&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">THROTTLE_RATES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;XXX&#34;</span><span class="p">:</span> <span class="s2">&#34;5/m&#34;</span><span class="p">}</span>  <span class="c1"># ÈôêÂà∂È¢ëÁéá</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache</span> <span class="o">=</span> <span class="n">default_cache</span>  <span class="c1"># redisÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Ëé∑ÂèñÂîØ‰∏ÄÊ†áËØÜÔºåÂêéÁª≠ÂèØ‰ª•ËøûÊé•redisÂÅöÊìç‰Ωú</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">ident</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span>  <span class="c1"># Áî®Êà∑ID</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ident</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># Ëé∑ÂèñËØ∑Ê±ÇÁî®Êà∑IPÔºàÂéªrequest‰∏≠ÊâæËØ∑Ê±ÇÂ§¥Ôºâ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># cache_format = &#39;throttle_%(scope)s_%(ident)s&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_format</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="s1">&#39;ident&#39;</span><span class="p">:</span> <span class="n">ident</span><span class="p">}</span>    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyPermission1</span><span class="p">,</span> <span class="n">MyPermission2</span><span class="p">,</span> <span class="n">MyPermission3</span><span class="p">]</span>  <span class="c1"># ÊùÉÈôêÁªÑ‰ª∂ÁöÑÂ±ÄÈÉ®ÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="74-Ê°à‰æã-ÈôêÊµÅÁöÑÂ∫îÁî®">7.4 Ê°à‰æã-ÈôêÊµÅÁöÑÂ∫îÁî®
</h3><p>Âú®ÂâçÂá†‰∏™ÁªÑ‰ª∂Ê°à‰æãÁöÑÂü∫Á°Ä‰∏äÂÆûÁé∞Ôºå‰∏ãÂàóÈùûÂÆåÊï¥‰ª£Á†ÅÔºå‰∏ªË¶ÅÊòØÈôêÊµÅÂäüËÉΩÁöÑÂÆûÁé∞</p>
<blockquote>
<ul>
<li>Êó†ÈúÄÁôªÂΩïÔºåÈôêÊµÅ 10/m</li>
<li>ÁôªÂΩïÔºåÈôêÊµÅ 5/m</li>
</ul></blockquote>
<ul>
<li><code>settings.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_USER&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.user=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_TOKEN&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.auth=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_AUTHENTICATION_CLASSES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.QueryParamsAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.HeaderAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.NoAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_PERMISSION_CLASSES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_THROTTLE_RATES&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Ip&#34;</span><span class="p">:</span> <span class="s2">&#34;10/m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;5/m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>ext/throttle.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.throttling</span> <span class="kn">import</span> <span class="n">SimpleRateThrottle</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span> <span class="k">as</span> <span class="n">default_cache</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">IpThrottle</span><span class="p">(</span><span class="n">SimpleRateThrottle</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="s2">&#34;Ip&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache</span> <span class="o">=</span> <span class="n">default_cache</span>  <span class="c1"># redisÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Á°ÆÂÆöÊòØÂåøÂêçÁöÑÔºåÂõ†Ê≠§Áõ¥Êé•Ëé∑ÂèñipÂÅöÊ†áËØÜÂç≥ÂèØ</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ident</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># Ëé∑ÂèñËØ∑Ê±ÇÁî®Êà∑IPÔºàÂéªrequest‰∏≠ÊâæËØ∑Ê±ÇÂ§¥Ôºâ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># cache_format = &#39;throttle_%(scope)s_%(ident)s&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_format</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="s1">&#39;ident&#39;</span><span class="p">:</span> <span class="n">ident</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserThrottle</span><span class="p">(</span><span class="n">SimpleRateThrottle</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache</span> <span class="o">=</span> <span class="n">default_cache</span>  <span class="c1"># redisÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ident</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span>  <span class="c1"># Áî®Êà∑ID</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_format</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="s1">&#39;ident&#39;</span><span class="p">:</span> <span class="n">ident</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>api/views.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IpThrottle</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AvatarView</span><span class="p">(</span><span class="n">NbApiView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÊÄªÁõë„ÄÅÂëòÂ∑•ÂèØ‰ª•ËÆøÈóÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">BossPermission</span><span class="p">,</span> <span class="n">UserPermission</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">UserThrottle</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="75-ÊÄªÁªì">7.5 ÊÄªÁªì
</h3><p>ÂÖ®Â±ÄÈÖçÁΩÆÈôêÊµÅÈ¢ëÁéá<code>settings.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_USER&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.user=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UNAUTHENTICATED_TOKEN&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Êú™ÁôªÂΩïÊó∂Ôºårequest.auth=None</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_AUTHENTICATION_CLASSES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.QueryParamsAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.HeaderAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.auth.NoAuthentication&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_PERMISSION_CLASSES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ext.per.Mypermission&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;DEFAULT_THROTTLE_RATES&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Ip&#34;</span><span class="p">:</span> <span class="s2">&#34;10/m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;5/m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈôêÊµÅÁªÑ‰ª∂ÁöÑÂÆö‰πâ<code>ext/throttle.py</code>ÔºåÂ±ÄÈÉ®ÈÖçÁΩÆÂèØË¶ÜÁõñÂÖ®Â±ÄÂÆö‰πâÁöÑÈ¢ëÁéá</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.throttling</span> <span class="kn">import</span> <span class="n">SimpleRateThrottle</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span> <span class="k">as</span> <span class="n">default_cache</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">IpThrottle</span><span class="p">(</span><span class="n">SimpleRateThrottle</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Â±ÄÈÉ®ÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="s2">&#34;Ip&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">THROTTLE_RATES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;Ip&#34;</span><span class="p">:</span> <span class="s2">&#34;5/m&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache</span> <span class="o">=</span> <span class="n">default_cache</span>  <span class="c1"># redisÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Á°ÆÂÆöÊòØÂåøÂêçÁöÑÔºåÂõ†Ê≠§Áõ¥Êé•Ëé∑ÂèñipÂÅöÊ†áËØÜÂç≥ÂèØ</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ident</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># Ëé∑ÂèñËØ∑Ê±ÇÁî®Êà∑IPÔºàÂéªrequest‰∏≠ÊâæËØ∑Ê±ÇÂ§¥Ôºâ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># cache_format = &#39;throttle_%(scope)s_%(ident)s&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_format</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="s1">&#39;ident&#39;</span><span class="p">:</span> <span class="n">ident</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserThrottle</span><span class="p">(</span><span class="n">SimpleRateThrottle</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÈááÁî®ÂÖ®Â±Ä</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache</span> <span class="o">=</span> <span class="n">default_cache</span>  <span class="c1"># redisÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ident</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span>  <span class="c1"># Áî®Êà∑ID</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_format</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="s1">&#39;ident&#39;</span><span class="p">:</span> <span class="n">ident</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËßÜÂõæÂáΩÊï∞Â∫îÁî®ÈôêÊµÅÁ±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.throttle</span> <span class="kn">import</span> <span class="n">MyThrottle</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">throttle_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyThrottle</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="8-ÁâàÊú¨">8. ÁâàÊú¨
</h2><blockquote>
<p>APIÁâàÊú¨ÊéßÂà∂ÊòØ‰∏Ä‰∏™ÂÖ≥ÈîÆÁöÑÂÆûË∑µÔºåÂÆÉÊúâÂä©‰∫éÁ°Æ‰øùAPIÁöÑÁ®≥ÂÆöÊÄß„ÄÅÂèØÈù†ÊÄßÂíåÂÖºÂÆπÊÄßÔºåÂêåÊó∂‰∏∫APIÁöÑÈïøÊúüÁª¥Êä§ÂíåÊºîËøõÊèê‰æõÊîØÊåÅ„ÄÇÈÄöËøáÂú®ËØ∑Ê±Ç‰∏≠Êê∫Â∏¶ÁâàÊú¨Âè∑ÔºåÂºÄÂèëËÄÖÂèØ‰ª•Êõ¥Â•ΩÂú∞ÁÆ°ÁêÜAPIÁöÑ‰∏çÂêåÁâàÊú¨ÔºåÂπ∂Á°Æ‰øùÂØπÂÆ¢Êà∑Á´ØÁöÑÂΩ±ÂìçÊúÄÂ∞èÂåñ</p></blockquote>
<h3 id="81-getÂèÇÊï∞‰º†ÈÄí">8.1 GETÂèÇÊï∞‰º†ÈÄí
</h3><blockquote>
<p>ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑ<code>VERSION_PARAM</code>ÂÜ≥ÂÆöÂì™‰∏™ÂèÇÊï∞Ë°®Á§∫ÁâàÊú¨‰ø°ÊÅØ</p>
<p>ÂèÇÊï∞Êê∫Â∏¶ÁöÑÁâàÊú¨‰ø°ÊÅØ‰ºöË¢´Â∞ÅË£ÖÂà∞<code>request.version</code></p></blockquote>
<p><img src="/post%5cpython%5cDRF%5cimage-20241219203724421.png"
	
	
	
	loading="lazy"
	
		alt="image-20241219203724421"
	
	
></p>
<ul>
<li><code>settings.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Êê∫Â∏¶ÁâàÊú¨‰ø°ÊÅØÁöÑËØ∑Ê±ÇÂèÇÊï∞Âêç</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;VERSION_PARAM&#39;</span><span class="p">:</span> <span class="s1">&#39;version&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Êú™‰º†ÂÖ•ÁâàÊú¨ÂèÇÊï∞Êó∂ÁöÑÈªòËÆ§ÁâàÊú¨</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_VERSION&#39;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÁâàÊú¨ËåÉÂõ¥ÂàóË°®</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;ALLOWED_VERSIONS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;v1&#34;</span><span class="p">,</span> <span class="s2">&#34;v2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÈªòËÆ§ÁâàÊú¨Á±ª</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_VERSIONING_CLASS&#39;</span><span class="p">:</span> <span class="s1">&#39;rest_framework.versioning.QueryParameterVersioning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="82-ÂèçÂêëÁîüÊàêurl">8.2 ÂèçÂêëÁîüÊàêURL
</h3><blockquote>
<p>‰∏édjango‰∏≠ÁöÑÂèçÂêëÁîüÊàêURL‰∏çÂêåÔºådrfÂèçÂêëÁîüÊàêÁöÑURLÂèØ‰ª•Êê∫Â∏¶Áõ∏ÂÖ≥ÁâàÊú¨‰ø°ÊÅØ</p></blockquote>
<p><img src="/post%5cpython%5cDRF%5cimage-20241220092026291.png"
	
	
	
	loading="lazy"
	
		alt="image-20241220092026291"
	
	
></p>
<p>GETËØ∑Ê±ÇÊê∫Â∏¶ÁöÑÂÖ∂‰ªñÂèÇÊï∞‰∏ç‰ºöËá™Âä®ÁîüÊàê</p>
<h3 id="83-Ê∫êÁ†ÅËß£ËØª">8.3 Ê∫êÁ†ÅËß£ËØª
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1 ÂÖ•Âè£Âú®APIViewÁ±ªÁöÑinitial()ÊñπÊ≥ïÔºåË∞ÉÁî®determine_versionÊñπÊ≥ïÔºåÂ∞ÜÁâàÊú¨‰ø°ÊÅØÂíåÁâàÊú¨Á±ªÂ∞ÅË£ÖÂà∞request‰∏≠versionÔºåversioning_scheme
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2 determine_versionÊñπÊ≥ïÔºåÂ¶ÇÊûúÊ≤°ÊúâÂÆö‰πâÁâàÊú¨Á±ªÔºåËøîÂõû(None, None)ÔºåÂÆö‰πâ‰∫ÜÁâàÊú¨Á±ªÔºåÂ∞ÜÂÖ∂ÂÆû‰æãÂåñËµãÂÄºÁªôversioning_schemeÔºåË∞ÉÁî®schemeÁöÑdetermine_versionÔºåËøîÂõûÁªìÊûúËµãÂÄºversion„ÄÇ
</span></span><span class="line"><span class="cl">	2.1 ÁâàÊú¨Á±ªÂÆû‰æãÂåñÊó∂ÔºåÁªßÊâøÁà∂Á±ªÔºåËØªÂèñÂÖ®Â±ÄÈÖçÁΩÆdefault_versionÔºåallowed_versionsÔºåversion_paramÔºåÂÆû‰æãÂåñÂêéËµãÂÄºÁªôversioning_scheme
</span></span><span class="line"><span class="cl">	2.2 Ë∞ÉÁî®schemeÁöÑdetermine_versionÔºå‰ªéËØ∑Ê±ÇÂèÇÊï∞‰∏≠ËØªÂèñÁâàÊú¨‰ø°ÊÅØversionÔºåÂπ∂‰∏îË∞ÉÁî®is_allowed_versionÊñπÊ≥ïÔºåÂà§Êñ≠versionÂÄºÊòØÂê¶ÂêàÊ≥ïÔºöallowed_versions‰∏∫Á©∫ÊàñversionÊòØÈªòËÆ§ÂÄºÊàñÂú®allowed_versionsËåÉÂõ¥ÂÜÖÔºåÂêàÊ≥ïÔºöËøîÂõûÁªôversion
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ÂΩìËßÜÂõæÂáΩÊï∞‰∏≠Ë¶ÅÂèçÂêëÁîüÊàêurlÊó∂Ôºårequest.versioning_scheme.reverse(&#34;hm&#34;,request=request)
</span></span><span class="line"><span class="cl">1 Ë∞ÉÁî®ÁâàÊú¨Á±ªÁöÑreverseÊñπÊ≥ïÔºåÂπ∂‰º†ÂÖ•Ë∑ØÁî±ÁöÑÂà´Âêç
</span></span><span class="line"><span class="cl">	1.1 Ë∞ÉÁî®Áà∂Á±ªÁöÑreverseÔºå‰º†ÂÖ•Ë∑ØÁî±Âà´ÂêçÔºåÂèçÂêëÁîüÊàêurlÔºàÂ∞±ÊòØdjango‰∏≠ÁöÑÔºâ
</span></span><span class="line"><span class="cl">	1.2 Ë∞ÉÁî®replace_query_paramÔºåÈÄöËøáquery_dictÂíåurlencodeÂ∞ÜÁâàÊú¨‰ø°ÊÅØÊèíÂÖ•Âà∞url‰∏≠
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseVersioning</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">default_version</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">DEFAULT_VERSION</span>
</span></span><span class="line"><span class="cl">    <span class="n">allowed_versions</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">ALLOWED_VERSIONS</span>
</span></span><span class="line"><span class="cl">    <span class="n">version_param</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">VERSION_PARAM</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">determine_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{cls}</span><span class="s1">.determine_version() must be implemented.&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="bp">cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span></span><span class="line"><span class="cl">        <span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewname</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">_reverse</span><span class="p">(</span><span class="n">viewname</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">is_allowed_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂàóË°®‰∏∫Á©∫ -&gt; ÊâÄÊúâÁâàÊú¨ÂùáÂèØ</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_versions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># versionÊòØÈªòËÆ§ÂÄºÊàñËÄÖÂú®allowed_versionsÂàóË°®ËåÉÂõ¥ÂÜÖ</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">((</span><span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_version</span><span class="p">)</span> <span class="ow">or</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="n">version</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_versions</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">QueryParameterVersioning</span><span class="p">(</span><span class="n">BaseVersioning</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    GET /something/?version=0.1 HTTP/1.1
</span></span></span><span class="line"><span class="cl"><span class="s2">    Host: example.com
</span></span></span><span class="line"><span class="cl"><span class="s2">    Accept: application/json
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">invalid_version_message</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Invalid version in query parameter.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">determine_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂéªËØ∑Ê±ÇÂèÇÊï∞‰∏≠Ëé∑ÂèñÈîÆ‰∏∫version_paramÁöÑÂÄºÂç≥‰∏∫ÁâàÊú¨ÔºåËã•‰∏çÂ≠òÂú®ÂàôËØªÂèñsettings.py‰∏≠ÁöÑÈªòËÆ§ÂÄº</span>
</span></span><span class="line"><span class="cl">        <span class="n">version</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_param</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_allowed_version</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotFound</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invalid_version_message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">version</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ‰º†ÂÖ•ËßÜÂõæÂêçÁß∞Âíårequest</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewname</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Êú¨Ë¥®‰∏äÂ∞±ÊòØË∞ÉÁî®djangoÁöÑreverseÂèçÂêëÁîüÊàêURL</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">viewname</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â∞ÜÁâàÊú¨‰ø°ÊÅØÊ∑ªÂä†ÊàñÊõøÊç¢ËøõÂéª</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">replace_query_param</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_param</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">url</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">replace_query_param</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">force_str</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">query_dict</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">query_dict</span><span class="p">[</span><span class="n">force_str</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">force_str</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">query</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">query_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">doseq</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlunsplit</span><span class="p">((</span><span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fragment</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">APIView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">versioning_class</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">DEFAULT_VERSIONING_CLASS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">determine_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">versioning_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂÆû‰æãÂåñÁ±ªÂØπË±°ÔºåÂç≥QueryParameterVersioning(),ÔºåÊ¨∏Êúâ__init__ÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">        <span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">versioning_class</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ËøîÂõûÁâàÊú¨‰ø°ÊÅØ‰∏éÁâàÊú¨Á±ªÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">scheme</span><span class="o">.</span><span class="n">determine_version</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">scheme</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â∞ÜÁâàÊú¨‰ø°ÊÅØ‰∏éÁâàÊú¨Á±ªÂ∞ÅË£ÖÂà∞request‰∏≠</span>
</span></span><span class="line"><span class="cl">        <span class="n">version</span><span class="p">,</span> <span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_version</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">versioning_scheme</span> <span class="o">=</span> <span class="n">version</span><span class="p">,</span> <span class="n">scheme</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Ensure that the incoming request is permitted</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">perform_authentication</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_permissions</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_throttles</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_response_headers</span>  <span class="c1"># deprecate?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_method_not_allowed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HomeView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÈÖçÁΩÆÊñá‰ª∂ VERSION_PARAM</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># http://127.0.0.1:8000/home/?xx=123&amp;page=44&amp;vertion=v1     -&gt;    request.version</span>
</span></span><span class="line"><span class="cl">    <span class="n">versioning_class</span> <span class="o">=</span> <span class="n">QueryParameterVersioning</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="84-urlË∑ØÂæÑ‰º†ÈÄí">8.4 URLË∑ØÂæÑ‰º†ÈÄí
</h3><blockquote>
<p>urls.py‰∏≠pathÂíåre_path‰∏§ÁßçÊñπÂºèÂùáÂèØ</p></blockquote>
<p><img src="/post%5cpython%5cDRF%5cimage-20241220114016697.png"
	
	
	
	loading="lazy"
	
		alt="image-20241220114016697"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Ê∫êÁ†Å</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">URLPathVersioning</span><span class="p">(</span><span class="n">BaseVersioning</span><span class="p">):</span>    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">determine_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">version</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_param</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_version</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_allowed_version</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotFound</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invalid_version_message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">version</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>‰ªé<code>kwargs</code>‰∏≠ËØªÂèñÁâàÊú¨ÔºåÂõ†Ê≠§ËßÜÂõæÂáΩÊï∞Ë¶ÅÁî®<code>*args</code>Âíå<code>**kwargs</code>Êé•Êî∂ÔºåÂÖ∂‰ªñÊ∫êÁ†ÅÈÄªËæë‰∏éGETÂèÇÊï∞‰º†ÈÄíÂü∫Êú¨Áõ∏Âêå</p>
<p>URLÂèÇÊï∞‰º†ÈÄí‰∏çÈúÄË¶Å<code>*args</code>Âíå<code>**kwargs</code>Êé•Êî∂ÊòØÂõ†‰∏∫‰º†ÂèÇÂèØ‰ª•‰ªérequest‰∏≠ÂèØ‰ª•ÂèñÂá∫</p></blockquote>
<h3 id="85-acceptËØ∑Ê±ÇÂ§¥‰º†ÈÄí">8.5 AcceptËØ∑Ê±ÇÂ§¥‰º†ÈÄí
</h3><blockquote>
<p>ÂèçÂêëÁîüÊàêÁöÑURL‰∏çÂê´ÁâàÊú¨ÔºåÂõ†‰∏∫‰ªñÊú¨Êù•Â∞±‰∏çÂá∫Áé∞Âú®url‰∏≠</p></blockquote>
<p><img src="/post%5cpython%5cDRF%5cimage-20241220121052593.png"
	
	
	
	loading="lazy"
	
		alt="image-20241220121052593"
	
	
></p>
<p><strong>ÂèÇËÄÉ‰ª£Á†Å</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># urls.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">re_path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># path(&#39;admin/&#39;, admin.site.urls),</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;home/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">HomeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hm&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># path(&#39;api/&lt;str:version&gt;/home/&#39;, views.HomeView.as_view(), name=&#39;hm&#39;),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># re_path(r&#39;^api/(?P&lt;version&gt;\w+)/home/$&#39;, views.HomeView.as_view(), name=&#39;hm&#39;),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># views.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.versioning</span> <span class="kn">import</span> <span class="n">QueryParameterVersioning</span><span class="p">,</span> <span class="n">URLPathVersioning</span><span class="p">,</span> <span class="n">AcceptHeaderVersioning</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create your views here.</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HomeView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÈÖçÁΩÆÊñá‰ª∂ VERSION_PARAM</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># http://127.0.0.1:8000/home/?xx=123&amp;page=44&amp;vertion=v1     -&gt;    request.version</span>
</span></span><span class="line"><span class="cl">    <span class="n">versioning_class</span> <span class="o">=</span> <span class="n">AcceptHeaderVersioning</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">versioning_scheme</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">versioning_scheme</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;hm&#39;</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÂèçÂêëÁîüÊàêÁöÑurl:&#34;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="86-ÊÄªÁªì">8.6 ÊÄªÁªì
</h3><blockquote>
<p>ÂêéÁª≠ÂºÄÂèëÊó∂Ôºå‰∏ÄËà¨ÈÉΩÈááÁî®URLË∑ØÂæÑ‰º†ÈÄíÁöÑÂΩ¢ÂºèÔºå‰∏ãÂàóÁªôÂá∫ÂºÄÂèëÁ§∫‰æã</p></blockquote>
<ul>
<li><code>settings.pyËøõË°åÂÖ®Â±ÄÈÖçÁΩÆ</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;UNAUTHENTICATED_USER&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;VERSION_PARAM&#39;</span><span class="p">:</span> <span class="s1">&#39;version&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_VERSION&#39;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;ALLOWED_VERSIONS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;v1&#34;</span><span class="p">,</span> <span class="s2">&#34;v2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÂÖ®Â±ÄÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_VERSIONING_CLASS&#39;</span><span class="p">:</span> <span class="s1">&#39;rest_framework.versioning.URLPathVersioning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>views.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.versioning</span> <span class="kn">import</span> <span class="n">QueryParameterVersioning</span><span class="p">,</span> <span class="n">URLPathVersioning</span><span class="p">,</span> <span class="n">AcceptHeaderVersioning</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HomeView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Â±ÄÈÉ®ÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">versioning_class</span> <span class="o">=</span> <span class="n">URLPathVersioning</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">versioning_scheme</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂèçÂêëÁîüÊàêurl</span>
</span></span><span class="line"><span class="cl">        <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">versioning_scheme</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;hm&#39;</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÂèçÂêëÁîüÊàêÁöÑurl:&#34;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>urls.py</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">re_path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/&lt;str:version&gt;/home/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">HomeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hm&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="9-Ëß£ÊûêÂô®">9. Ëß£ÊûêÂô®
</h2><p>Âú® <code>Django REST FrameworkÔºàDRFÔºâ</code>‰∏≠ÔºåËß£ÊûêÂô®ÔºàParserÔºâÊòØÁî®‰∫éÂ§ÑÁêÜ‰º†ÂÖ•ËØ∑Ê±ÇÊï∞ÊçÆÁöÑÁªÑ‰ª∂„ÄÇËß£ÊûêÂô®Ë¥üË¥£Â∞ÜÂéüÂßãËØ∑Ê±ÇÊï∞ÊçÆ<code>request.body</code>ÔºàÂ¶Ç JSON„ÄÅË°®ÂçïÊï∞ÊçÆ„ÄÅXML Á≠âÔºâËß£ÊûêÊàê Python Êï∞ÊçÆÁªìÊûÑÔºå‰ΩøÂæóËßÜÂõæÂáΩÊï∞ÂèØ‰ª•Êñπ‰æøÂú∞ËÆøÈóÆÂíåÊìç‰ΩúËØ∑Ê±ÇÊï∞ÊçÆÔºåËÆ©Â∫èÂàóÂåñÂô®ÂèØ‰ª•Ëøõ‰∏ÄÊ≠•Â§ÑÁêÜËøô‰∫õÊï∞ÊçÆ</p>
<h3 id="91-ÊµÅÁ®ãÊ¶ÇËø∞">9.1 ÊµÅÁ®ãÊ¶ÇËø∞
</h3><p>Ëß£ÊûêÂô®‰∏ÄËà¨Áî®‰∫éËß£ÊûêPOSTËØ∑Ê±ÇËØ∑Ê±Ç‰Ωì‰∏≠ÁöÑÊï∞ÊçÆÔºå‰∏éÂÜÖÂÆπÂçèÂïÜÊú∫Âà∂ÔºàContent NegotiationÔºâÈÖçÂêàÔºå<code>content-type</code>‰∏çÂêåÔºåÂÆ¢Êà∑Á´Ø‰º†ÈÄíÊù•ÁöÑÊï∞ÊçÆÊ†ºÂºè‰πü‰∏çÂêåÔºåÊ†πÊçÆÂÆ¢Êà∑Á´ØÁöÑ <code>Content-Type</code> Â§¥ÈÉ®ÈÄâÊã©ÂêàÈÄÇÁöÑËß£ÊûêÂô®Êù•Ëß£ÊûêËØ∑Ê±Ç‰Ωì</p>
<p>Â§ß‰ΩìÁöÑÊµÅÁ®ã‰∏∫Ôºö</p>
<ol>
<li>ËØªÂèñËØ∑Ê±ÇÂ§¥</li>
<li>Ê†πÊçÆËØ∑Ê±ÇÂ§¥Ëß£ÊûêÊï∞ÊçÆ
<ul>
<li>Ê†πÊçÆËØ∑Ê±ÇÂ§¥Ëé∑ÂèñËß£ÊûêÂô® -&gt; Â¶ÇJSONËß£ÊûêÂô®</li>
<li>request.data = JSONËß£ÊûêÂô®.parse</li>
</ul>
</li>
<li>request.dataËé∑ÂèñÂ§ÑÁêÜÂêéÁöÑÊï∞ÊçÆ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Form</span> <span class="n">Ëß£ÊûêÂô®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span><span class="s2">&#34;urlencode&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">JSON</span> <span class="n">Ëß£ÊûêÂô®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span><span class="s2">&#34;application/json&#34;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    	<span class="o">...</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="n">ËØ∑Ê±ÇËÄÖ</span><span class="err">Ôºö</span>
</span></span><span class="line"><span class="cl">	<span class="n">GET</span>
</span></span><span class="line"><span class="cl">    	<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="err">?</span><span class="n">xxx</span><span class="o">=</span><span class="mi">123</span><span class="o">&amp;</span><span class="n">abc</span><span class="o">=</span><span class="n">xxx</span>   <span class="o">--&gt;</span>  <span class="n">request</span><span class="o">.</span><span class="n">query_params</span>
</span></span><span class="line"><span class="cl">        <span class="n">ËØ∑Ê±ÇÂ§¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">POST</span>
</span></span><span class="line"><span class="cl">    	<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">home</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">        <span class="n">ËØ∑Ê±ÇÂ§¥</span>
</span></span><span class="line"><span class="cl">        	<span class="n">content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span><span class="s2">&#34;urlencode...&#34;</span>
</span></span><span class="line"><span class="cl">    		<span class="n">content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span><span class="s2">&#34;application/json&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">ËØ∑Ê±Ç‰Ωì</span>
</span></span><span class="line"><span class="cl">        	<span class="n">name</span><span class="o">=</span><span class="n">zhangs</span><span class="o">&amp;</span><span class="n">age</span><span class="o">=</span><span class="mi">18</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;zhangs&#34;</span><span class="p">,</span><span class="s2">&#34;age&#34;</span><span class="p">:</span><span class="mi">19</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="92-Â∏∏ËßÅÂ∫îÁî®">9.2 Â∏∏ËßÅÂ∫îÁî®
</h3><h4 id="921-jsonparser">9.2.1 JSONParser
</h4><p>Ëß£Êûê<code>JSON</code>Ê†ºÂºèÁöÑËØ∑Ê±ÇÊï∞ÊçÆÔºà<code>application/json</code>ÔºâÔºåËøîÂõûpython‰∏≠ÁöÑ<code>Â≠óÂÖ∏</code>Á±ªÂûã</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221095817376.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221095817376"
	
	
></p>
<h4 id="922-formparser">9.2.2 FormParser
</h4><p>Ëß£Êûê<code>Ë°®Âçï</code>Ôºà<code>application/x-www-form-urlencoded</code>ÔºâÊï∞ÊçÆ‰∏∫<code>QueryDictÔºàÂ≠óÂÖ∏Ôºâ</code>Á±ªÂûãÊï∞ÊçÆ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221100042471.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221100042471"
	
	
></p>
<h4 id="923-multipartparser">9.2.3 MultiPartParser
</h4><p>Ëß£Êûê<code>Â§öÈÉ®ÂàÜË°®ÂçïÊï∞ÊçÆ</code>Ôºà<code>multipart/form-data</code>ÔºâÔºåÊîØÊåÅÂêåÊó∂Ëß£ÊûêÊñá‰ª∂ÂíåË°®ÂçïÂ≠óÊÆµÔºåÈÄöÂ∏∏Áî®‰∫éÊñá‰ª∂‰∏ä‰º†</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221100114196.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221100114196"
	
	
></p>
<h4 id="924-fileuploadparser">9.2.4 FileUploadParser
</h4><p>Âè™ËÉΩÂ§ÑÁêÜ<code>Êñá‰ª∂</code>‰∏ä‰º†ËØ∑Ê±Ç<code>application/octet-stream</code></p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221100143428.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221100143428"
	
	
></p>
<h3 id="93-Ê∫êÁ†ÅÊµÅÁ®ã">9.3 Ê∫êÁ†ÅÊµÅÁ®ã
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">dispatch</span><span class="p">()</span><span class="err">ÁöÑÊµÅÁ®ãËµ∞ÂÆå‰ªÖ‰ªÖÂÆûÁé∞</span><span class="n">parsers</span><span class="err">Ôºå</span><span class="n">negotiator</span><span class="err">Ôºå</span><span class="n">parser_contextÁ≠âÂÄºÁöÑÂ∞ÅË£Ö</span><span class="err">ÔºåÁúüÊ≠£ÁöÑËß£ÊûêÂèëÁîüÂú®Ë∞ÉÁî®</span><span class="n">request</span><span class="o">.</span><span class="n">dataÊó∂</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">Âä†ËΩΩÊó∂Ëß¶Âèë</span><span class="n">dispatch</span><span class="p">()</span><span class="err">ÊñπÊ≥ïÔºåË∞ÉÁî®</span><span class="n">initialize_request</span>
</span></span><span class="line"><span class="cl">	<span class="err">Ë∞ÉÁî®</span><span class="n">get_parser_contextÊñπÊ≥ï</span><span class="err">ÔºåÂ∞ÜËßÜÂõæÂØπË±°Ôºå</span><span class="n">URLË∑ØÁî±ÂèÇÊï∞Â∞ÅË£ÖÊàêÂØπË±°ËµãÂÄºÁªôparser_context</span>
</span></span><span class="line"><span class="cl">	<span class="err">Ë∞ÉÁî®</span><span class="n">get_parsers</span><span class="err">ÔºåÂæ™ÁéØËß£ÊûêÂô®Á±ªÂØπË±°ÂàóË°®</span><span class="n">parser_classesÂàõÂª∫ÂÆû‰æãÂàóË°®parsers</span>
</span></span><span class="line"><span class="cl">	<span class="err">Ë∞ÉÁî®</span><span class="n">get_content_negotiator</span><span class="err">ÔºåÂ∞ÜÂçèÂïÜÂô®</span><span class="n">content_negotiation_classÂÆû‰æãÂåñÂêéÁöÑÂØπË±°ËµãÂÄºÁªônegotiator</span>
</span></span><span class="line"><span class="cl">	<span class="err">Â∞Ü</span><span class="n">parser_context</span><span class="err">Ôºå</span><span class="n">parsers</span><span class="err">Ôºå</span><span class="n">negotiator‰∏ÄÂπ∂Â∞ÅË£ÖËøõRequest‰∏≠</span>
</span></span><span class="line"><span class="cl">	<span class="err">Âú®</span><span class="n">RequestÁöÑinitÊñπÊ≥ï‰∏≠</span><span class="err">ÔºöÂæÄ</span><span class="n">parser_context‰∏≠Ëøõ‰∏ÄÊ≠•Ê∑ªÂä†‰∫ÜrequestÂíåencodingÊï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="n">initialize_requestÊâßË°åÂÆå</span><span class="err">ÔºåË∞ÉÁî®</span><span class="n">initialÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">	<span class="err">Ë∞ÉÁî®</span><span class="n">perform_content_negotiationÊñπÊ≥ï</span><span class="err">ÔºåÂ∞ÜË¢´ÈÄâÊã©ÁöÑÊ∏≤ÊüìÂô®ÂÆû‰æãËµãÂÄºÁªô</span><span class="n">accepted_renderer</span><span class="err">ÔºåÂ∞ÜÂØπÂ∫îÁöÑÂ™í‰ΩìÁ±ªÂûãÂ≠óÁ¨¶‰∏≤ËµãÂÄºÁªô</span><span class="n">accepted_media_type</span>
</span></span><span class="line"><span class="cl">		<span class="err">Âæ™ÁéØÂÆû‰æãÂåñËé∑ÂèñÊ∏≤ÊüìÂô®ÂÆû‰æãÂåñÂØπË±°ÂàóË°®</span><span class="n">renderers</span><span class="err">Ôºå</span><span class="n">conneg‰∏∫ÂçèÂïÜÂô®ÂØπË±°</span><span class="err">ÔºåË∞ÉÁî®</span><span class="n">connegÁöÑselect_rendererÊñπÊ≥ï</span><span class="err">ÔºåÊ†πÊçÆÂÆ¢Êà∑Á´ØÁöÑ</span> <span class="n">Accept</span> <span class="err">ËØ∑Ê±ÇÂ§¥ÂíåÊ∏≤ÊüìÂô®ÁöÑ‰ºòÂÖàÁ∫ßÈÄâÊã©‰∏Ä‰∏™ÂêàÈÄÇÁöÑÊ∏≤ÊüìÂô®</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl"><span class="err">ÂΩìË∞ÉÁî®</span><span class="n">request</span><span class="o">.</span><span class="n">dataÊó∂</span><span class="err">ÔºåÊâçÁúüÊ≠£Âú∞Ëß£ÊûêÊï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">	<span class="err">Â¶ÇÊûú</span><span class="n">_full_dataÊúâÂÄº</span><span class="err">ÔºåÁõ¥Êé•ËøîÂõûÔºåÊó†ÂÄºÔºåË∞ÉÁî®</span><span class="n">_load_data_and_filesÂä†ËΩΩÂÄº</span>
</span></span><span class="line"><span class="cl">	<span class="err">Ë∞ÉÁî®</span><span class="n">_parse</span><span class="err">Ôºå</span>
</span></span><span class="line"><span class="cl">		<span class="err">Âæ™ÁéØËß£ÊûêÂô®ÂàóË°®</span><span class="n">parsers</span><span class="err">ÔºåË∞ÉÁî®ÂçèÂïÜÂô®ÁöÑ</span><span class="n">select_parserÊñπÊ≥ï</span><span class="err">ÔºåÂ∞ÜËØ∑Ê±Ç‰∏≠ÁöÑ</span><span class="n">content_type‰∏éËß£ÊûêÂô®ÂÜÖÈÉ®ÁöÑmedia_typeÂåπÈÖç</span><span class="err">ÔºåÊâæÂà∞ÂåπÈÖçÁöÑËß£ÊûêÂô®</span><span class="n">parser</span>
</span></span><span class="line"><span class="cl">		<span class="err">Ë∞ÉÁî®Ëß£ÊûêÂô®ÁöÑ</span><span class="n">parseÊñπÊ≥ï</span><span class="err">ÔºåÂ∞ÜÊï∞ÊçÆËß£ÊûêÊàêÁõÆÊ†áÊ†ºÂºèÔºåËµãÂÄºÁªô</span><span class="n">parsed</span><span class="err">ÔºåËøîÂõû</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">parsed</span><span class="o">.</span><span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="err">Áî®</span><span class="n">_dataÂíå_filesÊé•Êî∂Ëß£ÊûêÂêéÁöÑÊï∞ÊçÆ</span><span class="err">ÔºåÂ§ÑÁêÜÊàêÂÆåÊï¥ÁöÑÊï∞ÊçÆËµãÂÄºÁªô</span><span class="n">_full_data</span><span class="err">Ôºå‰∏ãÊ¨°Ë∞ÉÁî®</span><span class="n">request</span><span class="o">.</span><span class="n">dataÂèØ‰ª•Áõ¥Êé•ËøîÂõû</span>
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DefaultContentNegotiation</span><span class="p">(</span><span class="n">BaseContentNegotiation</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Ê†πÊçÆËØ∑Ê±ÇÂ§¥Á±ªÂûã‰∏éËß£ÊûêÂô®ÂÜÖÂÆö‰πâÁöÑmedia_typeÂåπÈÖçÂá∫ÂØπÂ∫îÁöÑËß£ÊûêÂô®</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">select_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">parsers</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">parser</span> <span class="ow">in</span> <span class="n">parsers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">media_type_matches</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">media_type</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">content_type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">parser</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FormParser</span><span class="p">(</span><span class="n">BaseParser</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">media_type</span> <span class="o">=</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">media_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parser_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser_context</span> <span class="o">=</span> <span class="n">parser_context</span> <span class="ow">or</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="n">encoding</span> <span class="o">=</span> <span class="n">parser_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;encoding&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_CHARSET</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">QueryDict</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">JSONParser</span><span class="p">(</span><span class="n">BaseParser</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">media_type</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">renderer_class</span> <span class="o">=</span> <span class="n">renderers</span><span class="o">.</span><span class="n">JSONRenderer</span>
</span></span><span class="line"><span class="cl">    <span class="n">strict</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">STRICT_JSON</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">media_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parser_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser_context</span> <span class="o">=</span> <span class="n">parser_context</span> <span class="ow">or</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="n">encoding</span> <span class="o">=</span> <span class="n">parser_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;encoding&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_CHARSET</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">decoded_stream</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">stream</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">parse_constant</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">strict_constant</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict</span> <span class="k">else</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">decoded_stream</span><span class="p">,</span> <span class="n">parse_constant</span><span class="o">=</span><span class="n">parse_constant</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="s1">&#39;JSON parse error - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Request</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">parsers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">authenticators</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">negotiator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parser_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="o">=</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">parsers</span> <span class="o">=</span> <span class="n">parsers</span> <span class="ow">or</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">authenticators</span> <span class="o">=</span> <span class="n">authenticators</span> <span class="ow">or</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">negotiator</span> <span class="o">=</span> <span class="n">negotiator</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_negotiator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">parser_context</span> <span class="o">=</span> <span class="n">parser_context</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">Empty</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">Empty</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span> <span class="o">=</span> <span class="n">Empty</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_content_type</span> <span class="o">=</span> <span class="n">Empty</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span> <span class="o">=</span> <span class="n">Empty</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">parser_context</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">parser_context</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">parser_context</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_CHARSET</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">_hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_full_data&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Âä†ËΩΩÂÄº</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_load_data_and_files</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_load_data_and_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">_hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_data&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_full_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">is_form_media_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="o">.</span><span class="n">_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">POST</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FILES</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="o">.</span><span class="n">META</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñËØ∑Ê±ÇÂ§¥‰∏≠ÁöÑcontent_type</span>
</span></span><span class="line"><span class="cl">        <span class="n">media_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ËØ∑Ê±ÇÂèëÈÄÅËøáÊù•ÁöÑÂéüÂßãÊï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">        <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># DefaultContentNegotiation.select_parser()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Âæ™ÁéØËß£ÊûêÂô®ÂàóË°®ÔºåÊâæÂà∞content-typeÁ¨¶ÂêàÁöÑËß£ÊûêÂô®Âπ∂ËøîÂõû</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiator</span><span class="o">.</span><span class="n">select_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsers</span><span class="p">)</span>  <span class="c1"># request [JSONParserm,FormParser]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÊâßË°åËß£ÊûêÂô®ÁöÑparseÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">        <span class="n">parsed</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">media_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser_context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">parsed</span><span class="o">.</span><span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">empty_files</span> <span class="o">=</span> <span class="n">MultiValueDict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">empty_files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">APIView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">renderer_classes</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">DEFAULT_RENDERER_CLASSES</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser_classes</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">DEFAULT_PARSER_CLASSES</span>
</span></span><span class="line"><span class="cl">    <span class="n">content_negotiation_class</span> <span class="o">=</span> <span class="n">api_settings</span><span class="o">.</span><span class="n">DEFAULT_CONTENT_NEGOTIATION_CLASS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_parser_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">http_request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;view&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="p">()),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_parsers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="n">parser</span><span class="p">()</span> <span class="k">for</span> <span class="n">parser</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser_classes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_content_negotiator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_negotiator&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_negotiator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_negotiation_class</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_negotiator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">initialize_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># {ËßÜÂõæÂØπË±°ÔºåURLË∑ØÁî±ÂèÇÊï∞}</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parser_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Request</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">request</span><span class="p">,</span>  <span class="c1"># djangoÁöÑrequest</span>
</span></span><span class="line"><span class="cl">            <span class="n">parsers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parsers</span><span class="p">(),</span>  <span class="c1"># Ëß£ÊûêÂô® [JSONParser(),FormParser(),]</span>
</span></span><span class="line"><span class="cl">            <span class="n">authenticators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_authenticators</span><span class="p">(),</span>  <span class="c1"># ËÆ§ËØÅÁªÑ‰ª∂ [ËÆ§ËØÅÂØπË±°1ÔºåËÆ§ËØÅÂØπË±°2]</span>
</span></span><span class="line"><span class="cl">            <span class="n">negotiator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_content_negotiator</span><span class="p">(),</span>  <span class="c1"># DefaultContentNegotiation()</span>
</span></span><span class="line"><span class="cl">            <span class="n">parser_context</span><span class="o">=</span><span class="n">parser_context</span>  <span class="c1"># {ËßÜÂõæÂØπË±°ÔºåURLË∑ØÁî±ÂèÇÊï∞ + drfÁöÑrequest,encoding}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_response_headers</span>  <span class="c1"># deprecate?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_method_not_allowed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">neg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_content_negotiation</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Á¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÊòØË¢´ÈÄâÊã©ÁöÑÊ∏≤ÊüìÂô®ÂÆû‰æãÔºåÁ¨¨‰∫å‰∏™ÂÖÉÁ¥†ÊòØÂØπÂ∫îÁöÑÂ™í‰ΩìÁ±ªÂûãÂ≠óÁ¨¶‰∏≤</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="n">accepted_renderer</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">accepted_media_type</span> <span class="o">=</span> <span class="n">neg</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">version</span><span class="p">,</span> <span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_version</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">versioning_scheme</span> <span class="o">=</span> <span class="n">version</span><span class="p">,</span> <span class="n">scheme</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Ensure that the incoming request is permitted</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">perform_authentication</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_permissions</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">check_throttles</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># ËØ•ÊñπÊ≥ïË¥üË¥£Ê†πÊçÆÂÆ¢Êà∑Á´ØÁöÑ Accept ËØ∑Ê±ÇÂ§¥Êù•Á°ÆÂÆöÂìçÂ∫îÁöÑÂÜÖÂÆπÁ±ªÂûã„ÄÇËøô‰∏™ÊñπÊ≥ï‰ºöÊ£ÄÊü•ÂÆ¢Êà∑Á´ØÊé•ÂèóÂì™‰∫õÂ™í‰ΩìÁ±ªÂûãÔºåÂπ∂Ê†πÊçÆÊúçÂä°Âô®ËÉΩÂ§üÊèê‰æõÁöÑÂ™í‰ΩìÁ±ªÂûãÊù•ÈÄâÊã©‰∏Ä‰∏™ÂêàÈÄÇÁöÑÊ∏≤ÊüìÂô®ÔºàRendererÔºâ</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">perform_content_negotiation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">renderers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_renderers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">conneg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_negotiator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">conneg</span><span class="o">.</span><span class="n">select_renderer</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">renderers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_kwarg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="p">(</span><span class="n">renderers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">renderers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_renderers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="n">renderer</span><span class="p">()</span> <span class="k">for</span> <span class="n">renderer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderer_classes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_content_negotiator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_negotiator&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_negotiator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_negotiation_class</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_negotiator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HomeView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ÊâÄÊúâÁöÑËß£ÊûêÂô®</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">JSONParser</span><span class="p">,</span> <span class="n">FormParser</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Ê†πÊçÆËØ∑Ê±ÇÔºåÂåπÈÖçÂØπÂ∫îÁöÑËß£ÊûêÂô®</span>
</span></span><span class="line"><span class="cl">    <span class="n">content_negotiation</span> <span class="o">=</span> <span class="n">DefaultContentNegotiation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;ËØ∑Ê±ÇÊù•‰∫Ü&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="94-Ëß£ÊûêÂô®ÂÖ®Â±ÄÈÖçÁΩÆ">9.4 Ëß£ÊûêÂô®ÂÖ®Â±ÄÈÖçÁΩÆ
</h3><p>Â¶ÇÂõæÔºåÈªòËÆ§Ëß£ÊûêÂô®Êúâ<code>JSONParser,FormParser,MutiPartParser</code>‰∏âÁßç</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221100502285.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221100502285"
	
	
></p>
<p>‰ΩÜ‰∏∫‰∫ÜÈò≤Ê≠¢‰∏çËÉΩ‰∏ä‰º†ÂõæÁâáÁ≠âÂäüËÉΩÁÇπÂõ†‰∏∫ÈªòËÆ§Ëß£ÊûêÂô®ÂèØ‰ª•‰∏ä‰º†ÂõæÁâáÔºåÂØºËá¥<code>request.data</code>ÁöÑÁ±ªÂûãÁöÑ‰∏çÁ°ÆÂÆöÊÄßÔºåÂª∫ËÆÆÂ±ÄÈÉ®ÈÖçÁΩÆ</p>
<p>‰øÆÊîπÂÖ®Â±ÄÈÖçÁΩÆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;UNAUTHENTICATED_USER&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;VERSION_PARAM&#39;</span><span class="p">:</span> <span class="s1">&#39;version&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_VERSION&#39;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;ALLOWED_VERSIONS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;v1&#34;</span><span class="p">,</span> <span class="s2">&#34;v2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_VERSIONING_CLASS&#39;</span><span class="p">:</span> <span class="s1">&#39;rest_framework.versioning.QueryParameterVersioning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_PARSER_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;rest_framework.parsers.JSONParser&#39;</span><span class="p">,</span> <span class="p">]</span>  <span class="c1"># ËÆæÁΩÆÈªòËÆ§Ëß£ÊûêÂô®Âè™ÊúâJSONParser</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_RENDERER_CLASSES&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_CONTENT_NEGOTIATION_CLASS&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂêéÁª≠Â¶ÇÊûúÊúâ‰∏ä‰º†ÂõæÁâáÁöÑÂäüËÉΩÁÇπÔºåÂÜçÂ±ÄÈÉ®ÈÖçÁΩÆÂÖ∂Ëß£ÊûêÂô®Âç≥ÂèØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">parser_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MutiPartParser</span><span class="p">,]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="95-ÊÄªÁªì">9.5 ÊÄªÁªì
</h3><ul>
<li>Ëß£ÊûêÂô®Ë¥üË¥£Â∞ÜÂÆ¢Êà∑Á´ØÂèëÈÄÅÁöÑËØ∑Ê±Ç‰ΩìËß£Êûê‰∏∫ Python ÂèØÊìç‰ΩúÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇDRF Êèê‰æõ‰∫ÜÂ§öÁßçÈªòËÆ§Ëß£ÊûêÂô®Ôºå‰æãÂ¶Ç <code>JSONParser</code>Ôºå<code>FormParser</code> Âíå <code>MultiPartParser</code></li>
<li>Ê∏≤ÊüìÂô®Ë¥üË¥£Â∞ÜÂìçÂ∫îÊï∞ÊçÆËΩ¨Êç¢‰∏∫ÂÆ¢Êà∑Á´ØÂèØËØªÁöÑÊ†ºÂºè„ÄÇDRF Êèê‰æõ‰∫ÜÂ§öÁßçÈªòËÆ§Ê∏≤ÊüìÂô®Ôºå‰æãÂ¶Ç <code>JSONRenderer</code> Âíå <code>BrowsableAPIRenderer</code></li>
<li>ÂÜÖÂÆπÂçèÂïÜÂô®Ë¥üË¥£Ê†πÊçÆÂÆ¢Êà∑Á´ØÁöÑ <code>Accept</code> ËØ∑Ê±ÇÂ§¥ÂíåÊúçÂä°Âô®ÊîØÊåÅÁöÑÊ∏≤ÊüìÂô®ÈÄâÊã©ÂêàÈÄÇÁöÑÊ∏≤ÊüìÂô®„ÄÇDRF ÈªòËÆ§‰ΩøÁî® <code>DefaultContentNegotiation</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_PARSER_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;rest_framework.parsers.JSONParser&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;rest_framework.parsers.FormParser&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;rest_framework.parsers.MultiPartParser&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_RENDERER_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;rest_framework.renderers.JSONRenderer&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;rest_framework.renderers.BrowsableAPIRenderer&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DEFAULT_CONTENT_NEGOTIATION_CLASS&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;rest_framework.negotiation.DefaultContentNegotiation&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.parsers</span> <span class="kn">import</span> <span class="n">JSONParser</span><span class="p">,</span> <span class="n">FormParser</span><span class="p">,</span> <span class="n">MultiPartParser</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.renderers</span> <span class="kn">import</span> <span class="n">JSONRenderer</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.negotiation</span> <span class="kn">import</span> <span class="n">DefaultContentNegotiation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyUploadView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">parser_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">JSONParser</span><span class="p">,</span> <span class="n">FormParser</span><span class="p">,</span> <span class="n">MultiPartParser</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">renderer_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">JSONRenderer</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">content_negotiation_class</span> <span class="o">=</span> <span class="n">DefaultContentNegotiation</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="10-ÂÖÉÁ±ª">10. ÂÖÉÁ±ª
</h2><p>Âú®Python‰∏≠Ôºå‰∏ÄÂàáÁöÜÂØπË±°„ÄÇÁ±ªÊú¨Ë∫´‰πüÊòØÂØπË±°ÔºåËÄå<strong>ÂÖÉÁ±ªÂ∞±ÊòØÁî®Êù•ÂàõÂª∫Á±ªÁöÑÁ±ª</strong>„ÄÇÂÖÉÁ±ªÔºàmetaclassÔºâÂèØ‰ª•Âπ≤È¢ÑÁ±ªÁöÑÂàõÂª∫ÔºåÊéßÂà∂Á±ªÁöÑÂÆû‰æãÂåñ</p>
<p>ÊôÆÈÄöÁöÑÁ±ªÁî®Êù•ÂÆö‰πâ‰∏ÄËà¨ÂØπË±°ÁöÑÂ±ûÊÄßÂíåË°å‰∏∫ÔºåÂÖÉÁ±ªÁî®Êù•ÂÆö‰πâÊôÆÈÄöÁöÑÁ±ªÂèäÂÖ∂ÂÆû‰æãÂØπË±°ÁöÑÂ±ûÊÄßÂíåË°å‰∏∫</p>
<h3 id="101-Á±ªÂíåÂØπË±°ÁöÑÂü∫Á°ÄÁü•ËØÜ">10.1 Á±ªÂíåÂØπË±°ÁöÑÂü∫Á°ÄÁü•ËØÜ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Á±ªÂíåÂØπË±°ÔºåÂü∫‰∫éÁ±ªÂÆû‰æãÂåñÂØπË±°</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Á±ª</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Á±ªÂèòÈáè</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂÆû‰æãÂèòÈáè</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Á±ªÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂØπË±°</span>
</span></span><span class="line"><span class="cl"><span class="n">obj1</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">obj2</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="s1">&#39;test2&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="102-ÂàõÂª∫Á±ªÁöÑ‰∏§ÁßçÊñπÂºè">10.2 ÂàõÂª∫Á±ªÁöÑ‰∏§ÁßçÊñπÂºè
</h3><p>ÊñπÂºè‰∏ÄÂ∞±ÊòØÊàë‰ª¨Âπ≥Â∏∏‰π¶ÂÜôÁöÑÂΩ¢ÂºèÔºåËÄåÊñπÂºè‰∫åÂ∞±ÊòæÁ§∫Âú∞Â±ïÁ§∫‰∫ÜÂÖÉÁ±ªÂàõÂª∫Á±ªÁöÑËøáÁ®ãÔºåÊú¨Ë¥®‰∏äÊñπÂºè‰∏ÄÁªèËøáÂ§ÑÁêÜÂêéÂ∞±ÊòØÈÄöËøáÊñπÂºè‰∫åÂàõÂª∫Á±ªÁöÑÔºåÂè™ÊòØÊñπÂºè‰∏ÄÊõ¥Âä†Áõ¥ËßÇ‰∏îÊòì‰∫é‰π¶ÂÜô</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫Á±ªÔºöÊñπÂºè1</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">999</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫Á±ªÔºöÊñπÂºè2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Á±ªÂêç = type(&#34;Á±ªÂêç&#34;,(Áà∂Á±ª,),{ÊàêÂëò})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Foo = type(&#34;Foo&#34;, (object,), {&#34;v1&#34;: 123, &#34;func&#34;: lambda self: 999})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">obj1</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">obj1</span><span class="o">.</span><span class="n">v1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">obj1</span><span class="o">.</span><span class="n">func</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="103-mytypeÂàõÂª∫Á±ª‰∏éÊãìÂ±ï">10.3 MyTypeÂàõÂª∫Á±ª‰∏éÊãìÂ±ï
</h3><p>‰ΩøÁî®ÂÖÉÁ±ªÔºåÊúÄÂ∏∏ËßÅÊñπÂºèÊòØËá™ÂÆö‰πâ‰∏Ä‰∏™ÂÖÉÁ±ªÔºåÁªßÊâøtypeÔºåÁÑ∂Âêé‰ΩøÁî®Ëá™ÂÆö‰πâÁöÑÂÖÉÁ±ªÂàõÂª∫Á±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">xx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÂàõÂª∫Á±ª&#34;</span><span class="p">,</span> <span class="n">xx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">xx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Foo</span> <span class="o">=</span> <span class="n">MyType</span><span class="p">(</span><span class="s2">&#34;Foo&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nb">object</span><span class="p">,),</span> <span class="p">{</span><span class="s2">&#34;v1&#34;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="s2">&#34;func&#34;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="mi">999</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">obj1</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">obj1</span><span class="o">.</span><span class="n">v1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">obj1</span><span class="o">.</span><span class="n">func</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫Á±ª &lt;class &#39;__main__.Foo&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 123</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 999</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∫îÁî®Âú®Êàë‰ª¨Â∏∏Áî®ÁöÑÁ±ªÁöÑÂàõÂª∫ÊñπÂºèÊó∂ÔºåÂ∞±ÊòØË¶ÅÂ∞ÜÂÖÉÁ±ªÊåáÂÆö‰∏∫Á±ªÁöÑ<code>metaclass</code>ÂÖ≥ÈîÆÂ≠óÂèÇÊï∞ÔºåÂëäËØâPythonÂú®ÂàõÂª∫Á±ªÊó∂‰ΩøÁî®ÊåáÂÆöÁöÑÂÖÉÁ±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Âü∫‰∫étypeÂàõÂª∫</span>
</span></span><span class="line"><span class="cl"><span class="c1"># class Foo:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     v1 = 123</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     def func(self):</span>
</span></span><span class="line"><span class="cl"><span class="c1">#         pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âü∫‰∫éMyTypeÂàõÂª∫</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">xx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÂàõÂª∫Á±ª&#34;</span><span class="p">,</span> <span class="n">xx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">xx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">MyType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖÉÁ±ª‰∏≠ÂèØ‰ª•ÈáçÂÜô<code>__new__</code>Âíå<code>__init__</code>ÊñπÊ≥ïÊù•ÊéßÂà∂Á±ªÁöÑÂàõÂª∫ÂíåÂàùÂßãÂåñËøáÁ®ã„ÄÇ<code>__new__</code>ÊñπÊ≥ïÂú®Á±ªÂàõÂª∫‰πãÂâçË∞ÉÁî®Ôºå<code>__init__</code>ÊñπÊ≥ïÂú®Á±ªÂàõÂª∫‰πãÂêéË∞ÉÁî®„ÄÇ</p>
<p><code>__new__</code>‰º†ÂÖ•ÁöÑname, bases, attrsÂÖ∂ÂÆûÂ∞±ÊòØÊàë‰ª¨‰ΩøÁî®ÊñπÂºè‰∫åÂàõÂª∫Êó∂‰º†ÂÖ•ÁöÑÁ±ªÂêçÔºåÁà∂Á±ªÂèäÂèäÂ±ûÊÄßÔºåÂõ†Ê≠§Â∞±ÂèØ‰ª•Âú®Ë∞ÉÁî®typeÁöÑ<code>__new__</code>ÂàõÂª∫Á±ª‰πãÂâçÔºåÂØπ‰º†ÂÖ•ÁöÑname, bases, attrsËøõË°å‰øÆÊîπÔºå‰ªéËÄåÂπ≤È¢ÑÁ±ªÁöÑÂàõÂª∫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Foo (&lt;class &#39;object&#39;&gt;,) {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__qualname__&#39;: &#39;Foo&#39;, &#39;v1&#39;: 123, &#39;func&#39;: &lt;function Foo.func at 0x000002209BA9C310&gt;}</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂèØ‰ª•Âú®ÂàõÂª∫Á©∫Èó¥ÂâçÂØπÁ±ªËøõË°åÊõ¥ÊîπÔºåÂ¶ÇÊ∑ªÂä†/Âà†Èô§Â±ûÊÄßÁ≠âÁ≠â</span>
</span></span><span class="line"><span class="cl">        <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;xxx&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">xx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">xx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">MyType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">v1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="104-ÁªßÊâøÂÖ≥Á≥ª">10.4 ÁªßÊâøÂÖ≥Á≥ª
</h3><p>ÊåáÂÆö<code>metaclass</code>ÁöÑÁ±ª‰ª•Âèä‰ªñÊâÄÊúâÁöÑÂ≠êÁ±ªÈÉΩÂ∞ÜÁî±ÊåáÂÆöÁöÑ<code>metaclass</code>ÂàõÂª∫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">xx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">xx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Info</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">MyType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">Foo</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Foo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Bar</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/post%5cpython%5cDRF%5cimage-20241221113024024.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221113024024"
	
	
></p>
<h3 id="105-drfÂ∫èÂàóÂåñÊ∫êÁ†ÅÊ°à‰æã">10.5 drfÂ∫èÂàóÂåñÊ∫êÁ†ÅÊ°à‰æã
</h3><p>Âõ†‰∏∫UserSerializerÊòØSerializerÁöÑÂ≠êÁ±ªÔºåËÄåSerializerÊåáÂÆö‰∫Ümetaclass=SerializerMetaclassÔºåÂõ†Ê≠§Áî±‰∏ä‰∏ÄÂ∞èËäÇÁöÑÁªßÊâøÂÖ≥Á≥ªÁöÑ‰ªãÁªçÂèØÁü•ÔºåUserSerializer‰πüÂ∞ÜÁî±ÂÖÉÁ±ªSerializerMetaclassÂàõÂª∫ÔºåÂõ†Ê≠§‰ªñÁöÑÂÆû‰æãÁ©∫Èó¥‰∏≠Êúâ_declared_fieldsÂ±ûÊÄß</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SerializerMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>  <span class="c1"># {&#34;v1&#34;:123,&#34;v2&#34;:123,&#34;v3&#34;:123}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">data_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;_declared_fields&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_dict</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseSerializer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Serializer</span><span class="p">(</span><span class="n">BaseSerializer</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">SerializerMetaclass</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ModelSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">    <span class="n">v2</span> <span class="o">=</span> <span class="mi">456</span>
</span></span><span class="line"><span class="cl">    <span class="n">v3</span> <span class="o">=</span> <span class="s2">&#34;ÂìàÂìàÂìà&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">UserSerializer</span><span class="o">.</span><span class="n">v3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">UserSerializer</span><span class="o">.</span><span class="n">_declared_fields</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøêË°åÁªìÊûúÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ÂìàÂìàÂìà</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;v1&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="s1">&#39;v2&#39;</span><span class="p">:</span> <span class="mi">456</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="106-Êâ©Â±ï">10.6 Êâ©Â±ï
</h3><p>Á±ªÊòØÁî±MyTypeÂàõÂª∫Âá∫Êù•ÔºåÊâÄ‰ª•Á±ªÂÖ∂ÂÆûÊòØMyTypeÁ±ªÂÆû‰æãÂåñÁöÑÂØπË±°„ÄÇ</p>
<p>BaseÊòØÁ±ªÔºå‰πüÊòØMyTypeÁ±ªÁöÑÂØπË±°Âç≥Mytype()Ôºõ  Base()ÊòØBaseÁ±ªÂÆû‰æãÂåñÁöÑÂØπË±°ÔºåÁõ∏ÂΩì‰∫éMyType()()</p>
<ul>
<li>Âõ†Ê≠§BaseÁ±ªÂÆû‰æãÂåñÁöÑÂØπË±°Â∞±‰ºöÊâßË°åMyTypeÁ±ªÁöÑ<code>__call__</code></li>
<li>ËÄåobj()‰æø‰ºöÊâßË°åBaseÁ±ªÁöÑ<code>__call__</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">xx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">xx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÊâßË°åtypeÁöÑcall&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;----&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">MyType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÂàùÂßãÂåñ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÂÆû‰æãÂåñÁ±ªÁöÑÂØπË±°&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Base.call&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="n">Base</span><span class="p">()</span>  <span class="c1"># ÊâßË°åMyTypeÁöÑ__call__</span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span><span class="p">()</span>  <span class="c1"># ÊâßË°åBaseÁöÑ__call__</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="11-Â∫èÂàóÂåñÂô®">11. Â∫èÂàóÂåñÂô®
</h2><p>Â∫èÂàóÂåñÂô®ÊòØDjangoÊ°ÜÊû∂‰∏≠ÁöÑ‰∏Ä‰∏™ÈáçË¶ÅÊ¶ÇÂøµÔºåÁî®‰∫éÂú®PythonÂØπË±°ÂíåJSONÁ≠âÊ†ºÂºè‰πãÈó¥ËøõË°åÁõ∏‰∫íËΩ¨Êç¢„ÄÇÈÄöËøáÂ∫èÂàóÂåñÂô®ÔºåÊàë‰ª¨ÂèØ‰ª•Êñπ‰æøÂú∞Â∞ÜÊ®°ÂûãÂÆû‰æãËΩ¨Êç¢‰∏∫JSONÊ†ºÂºèÁöÑÊï∞ÊçÆÔºåÂπ∂‰∏îËøòÂèØ‰ª•ÂØπÊï∞ÊçÆËøõË°åÈ™åËØÅ„ÄÅÂàõÂª∫ÂíåÊõ¥Êñ∞Á≠âÊìç‰Ωú„ÄÇ</p>
<ul>
<li>Ëß£ÊûêÂô®Ôºö
<ul>
<li>Â∞ÜÂÆ¢Êà∑Á´ØÂèëÈÄÅÁöÑËØ∑Ê±Ç‰ΩìÔºàÂ¶ÇJSONÔºâËß£Êûê‰∏∫ Python Êï∞ÊçÆÁªìÊûÑÔºàÂ¶ÇÂ≠óÂÖ∏ÊàñÂàóË°®Ôºâ</li>
<li>Ëß£ÊûêÂêéÁöÑÊï∞ÊçÆÂ≠òÂÇ®Âú® <code>request.data</code> ‰∏≠Ôºå‰æõËßÜÂõæÂíåÂ∫èÂàóÂåñÂô®‰ΩøÁî®</li>
</ul>
</li>
<li>Â∫èÂàóÂåñÂô®Ôºö
<ul>
<li>Âú®ËßÜÂõæ‰∏≠Ôºå<code>request.data</code> Ë¢´‰º†ÈÄíÁªôÂ∫èÂàóÂåñÂô®ÔºåÈ™åËØÅËß£ÊûêÂêéÁöÑÊï∞ÊçÆÊòØÂê¶Á¨¶ÂêàÊ®°ÂûãÂ≠óÊÆµÁöÑË¶ÅÊ±Ç</li>
<li>Â∞ÜÈ™åËØÅÂêéÁöÑÊï∞ÊçÆËΩ¨Êç¢‰∏∫Ê®°ÂûãÂÆû‰æãÔºå‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ì</li>
<li>ÂìçÂ∫îÈò∂ÊÆµÔºåÂ∫èÂàóÂåñÂô®Â∞ÜÊ®°ÂûãÂÆû‰æãÂ∫èÂàóÂåñ‰∏∫Python Êï∞ÊçÆÁªìÊûÑÔºàÈÄöÂ∏∏ÊòØÂ≠óÂÖ∏ÔºåÂàóË°®ÔºåÊúâÂ∫èÂ≠óÂÖ∏Ôºâ</li>
</ul>
</li>
<li>Ê∏≤ÊüìÂô®Ôºö
<ul>
<li>Â∞ÜPython Êï∞ÊçÆÁªìÊûÑÔºàÈÄöÂ∏∏ÊòØÂ≠óÂÖ∏ÔºåÂàóË°®ÔºåÊúâÂ∫èÂ≠óÂÖ∏ÔºâËøõ‰∏ÄÊ≠•ËΩ¨Êç¢‰∏∫JSON„ÄÅXML ÊàñÂÖ∂‰ªñÊ†ºÂºè</li>
<li>Â∞ÜÂ∫èÂàóÂåñÂêéÁöÑÊï∞ÊçÆËΩ¨Êç¢‰∏∫Â≠óËäÇÊµÅÔºåÊúÄÁªàËøîÂõûÁªôÂÆ¢Êà∑Á´Ø</li>
</ul>
</li>
</ul>
<h3 id="111-Â∫èÂàóÂåñ">11.1 Â∫èÂàóÂåñ
</h3><p>Â∫èÂàóÂåñËøáÁ®ã ÊòØÂ∞Ü‰ªéORM‰∏≠Ëé∑ÂèñÁöÑÂ§çÊùÇÁöÑÊï∞ÊçÆÁ±ªÂûãÔºàÂ¶Ç Django Ê®°ÂûãÂÆû‰æãÊàñÊü•ËØ¢ÈõÜÔºâËΩ¨Êç¢‰∏∫ Python Êï∞ÊçÆÁªìÊûÑÔºàÈÄöÂ∏∏ÊòØÂ≠óÂÖ∏ÔºåÂàóË°®ÔºåÊúâÂ∫èÂ≠óÂÖ∏ÔºâÔºåÁÑ∂ÂêéËøõ‰∏ÄÊ≠•ËΩ¨Êç¢‰∏∫ JSON„ÄÅXML ÊàñÂÖ∂‰ªñÊ†ºÂºèÁöÑËøáÁ®ãÔºàÊ∏≤ÊüìÂô®‰ΩúÁî®Ôºâ</p>
<h4 id="1111-serializer">11.1.1 Serializer
</h4><p><code>Serializer</code>ÊòØÂü∫Á°ÄÂ∫èÂàóÂåñÂô®ÔºåÈúÄË¶ÅÊâãÂä®ÂÆö‰πâÊØè‰∏™Â≠óÊÆµ</p>
<p>ÂÖàÂàõÂª∫Êï∞ÊçÆÂ∫ìÔºå‰ª•‰æøÂêéÁª≠ÊµãËØïËé∑ÂèñÊï∞ÊçÆ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221182140560.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221182140560"
	
	
></p>
<p>ÊâãÂä®Ê∑ªÂä†‰∏§ÁªÑÊï∞ÊçÆ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221182452157.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221182452157"
	
	
></p>
<p>Ê®°ÂûãÂÆû‰æãÂØπË±°</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221184453282.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221184453282"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Êï∞ÊçÆÂ∫ì‰∏≠Ëé∑ÂèñÊï∞ÊçÆ obj.title  obj.order  obj.count</span>
</span></span><span class="line"><span class="cl">        <span class="n">depart_object</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># Ê®°ÂûãÂÆû‰æã</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â∫èÂàóÂåñÂô®ËΩ¨Êç¢JSONÊ†ºÂºè</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">DepartSerializer</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">depart_object</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># {&#39;title&#39;: &#39;ÊäÄÊúØÈÉ®&#39;, &#39;count&#39;: 10}</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Â≠óÂÖ∏</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ËøîÂõûÁªôÁî®Êà∑</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>  <span class="c1"># Â≠óÂÖ∏</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>  <span class="c1"># ResponseÂØπË±°ÈÄöËøáÊ∏≤ÊüìÂô®Â∞ÜÂ≠óÂÖ∏ÂØπË±°zhuanËΩ¨Êç¢‰∏∫JSONÂØπË±°</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>QuerysetÊï∞ÊçÆÈõÜÂØπË±°</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221185028899.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221185028899"
	
	
></p>
<h4 id="1112-modelserializer">11.1.2 ModelSerializer
</h4><p><code>ModelSerializer</code>ÊòØ<code>Serializer</code>ÁöÑÂ≠êÁ±ªÔºå‰∏ìÈó®‰∏∫Ê®°ÂûãÊï∞ÊçÆËÆæËÆ°ÔºåÊèê‰æõ‰∫ÜÂü∫‰∫éÊ®°ÂûãÁ±ªËá™Âä®ÁîüÊàêÂ≠óÊÆµÁöÑÂäüËÉΩ</p>
<p>Â¶Ç‰∏ãÂõæÔºåÊåáÂÆömodel‰∏∫DepartÁ±ªÂπ∂ÊåáÂÆöfieldsÂç≥ÂèØÂü∫‰∫éÊ®°ÂûãÁ±ªDepartÁöÑÂ≠óÊÆµËá™Âä®ÁîüÊàêÂ≠óÊÆµ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221185924204.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221185924204"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="s1">&#39;__all__&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1113-Â≠óÊÆµÂíåÂèÇÊï∞">11.1.3 Â≠óÊÆµÂíåÂèÇÊï∞
</h4><p>‰∏äÈù¢Êàë‰ª¨Â∑≤ÁªèÂ≠¶‰π†‰∫Ü<code>Serializer</code>Âíå<code>ModelSerializer</code>‰∏§ÁßçÂ∫èÂàóÂåñÂô®Ôºå‰ΩÜÊòØ‰ªÖ‰ªÖÂ¶ÇÊ≠§ËøúËøúËææ‰∏çÂà∞Êàë‰ª¨ÂºÄÂèëÊó∂ÈúÄË¶ÅÁöÑÁÅµÊ¥ªÁöÑÔºåÂõ†Ê≠§ÔºåËøô‰∏ÄÈÉ®ÂàÜÂ∞Ü‰ªãÁªçÂØπÂ≠óÊÆµÂèäÂèÇÊï∞ÁöÑËá™ÂÆö‰πâÔºåÊù•ÂÆûÁé∞ÁÅµÊ¥ªÂºÄÂèë</p>
<p>ÂâçÁΩÆÊï∞ÊçÆÂáÜÂ§á</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221194402180-17347814432471.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221194402180"
	
	
></p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221194618320.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221194618320"
	
	
></p>
<h5 id="11131-ËøîÂõûÊâÄÊúâÂ≠óÊÆµ">11.1.3.1 ËøîÂõûÊâÄÊúâÂ≠óÊÆµ
</h5><p>ËøîÂõûÊ®°ÂûãÁ±ª‰∏≠ÂÆö‰πâÁöÑÊâÄÊúâÂ≠óÊÆµ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241221195330516.png"
	
	
	
	loading="lazy"
	
		alt="image-20241221195330516"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="s1">&#39;__all__&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ctime</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Ëé∑ÂèñÊï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ËøîÂõûÁªôÁî®Êà∑</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="11132-ÊåáÂÆöÂ≠óÊÆµËøîÂõû">11.1.3.2 ÊåáÂÆöÂ≠óÊÆµËøîÂõû
</h5><p>ÊúâÊó∂Êàë‰ª¨‰∏çÈúÄË¶ÅÂ∞ÜÁ±ª‰∏≠ÂÆö‰πâÁöÑÂÖ®ÈÉ®Â≠óÊÆµËøîÂõûÔºå‰∫éÊòØÂ∞±ÈúÄË¶ÅËá™ÂÆö‰πâÂ≠óÊÆµËøîÂõû</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241222160835246.png"
	
	
	
	loading="lazy"
	
		alt="image-20241222160835246"
	
	
></p>
<p>Êàë‰ª¨ÂèëÁé∞genderËøîÂõûÁöÑÊòØÊï∞ÊçÆÂ∫ì‰∏≠ÁúüÂÆûÂ≠òÂÇ®ÁöÑ1Âíå2ÔºåÈÇ£Â∫îËØ•Â¶Ç‰ΩïËÆ©‰ªñËøîÂõûÁî∑ÂíåÂ•≥Âë¢Ôºü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Êàë‰ª¨ÂèØ‰ª•Ëá™ÂÆö‰πâÂ≠óÊÆµ</span>
</span></span><span class="line"><span class="cl"><span class="n">gender</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;gender&#39;</span><span class="p">)</span>  <span class="c1"># Á≠âÂêå‰∫éÁõ¥Êé•Âú®fields‰∏≠Ê∑ªÂä† &#39;gender&#39;ÔºåÊãøÂà∞ÁöÑËøòÊòØ1Âíå2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÆÉÊãøÂà∞ÊØè‰∏Ä‰∏™ÂØπË±°ÈÉΩ‰ºö.source Ôºå‰∏äËø∞ËØ≠Âè•Âç≥obj.genderÂç≥ÂèØÊãøÂà∞Êï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂÄºÔºåÈÇ£‰πàÁü•ÈÅì‰∫ÜËøô‰∏™ÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•Ëá™ÂÆö‰πâÂ≠óÊÆµÊåáÂÆöÂÖ∂sourceÊù•ÊãøÂà∞Êàë‰ª¨ÊÉ≥Ë¶ÅÁöÑÊï∞ÊçÆ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="11133-Â≠êÂÆö‰πâÂ≠óÊÆµËøîÂõû">11.1.3.3 Â≠êÂÆö‰πâÂ≠óÊÆµËøîÂõû
</h5><ul>
<li>
<p><code>choicesÂ±ïÁ§∫</code></p>
<ul>
<li><code>obj.get_gender_display</code>Âç≥ÂèØËé∑Âèñchoices‰∏≠ÁöÑÁî∑ÊàñÂ•≥</li>
</ul>
</li>
<li>
<p><code>foreignkeyË∑®Ë°®Êü•ËØ¢</code></p>
<ul>
<li>ÈÄöËøáFKËøõË°åË∑®Ë°®Êü•ËØ¢</li>
</ul>
</li>
<li>
<p><code>Êó∂Èó¥Êï∞ÊçÆÊ†ºÂºèËÆæÁΩÆ</code></p>
</li>
</ul>
<p><img src="/post%5cpython%5cDRF%5cimage-20241222161854882.png"
	
	
	
	loading="lazy"
	
		alt="image-20241222161854882"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">gender_text</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;get_gender_display&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">depart</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;depart.title&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ctime</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># fields = &#39;__all__&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;gender_text&#39;</span><span class="p">,</span> <span class="s1">&#39;depart&#39;</span><span class="p">,</span> <span class="s1">&#39;ctime&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨Â∑≤ÁªèËÉΩÂÅöÂà∞Ëé∑ÂèñÊï∞ÊçÆÂ∫ì‰∏≠‰ªª‰ΩïÊàë‰ª¨ÊÉ≥Ë¶ÅÁöÑÊï∞ÊçÆÔºåÈÇ£Êàë‰ª¨ÂèØ‰ª•Ê∑ªÂä†ÈùûÊï∞ÊçÆÂ∫ìÂ≠óÊÆµÂêóÔºü</p>
<h5 id="11134-Ëá™ÂÆö‰πâÊñπÊ≥ï">11.1.3.4 Ëá™ÂÆö‰πâÊñπÊ≥ï
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">xxx</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">SerializerMethodField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂΩìÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Âêç‰∏∫xxxÁöÑSerializerMethodFieldÂ≠óÊÆµÊó∂Ôºå‰ºöÂØªÊâæget_xxxÊñπÊ≥ïÔºåÂ∞ÜÂÖ∂ËøîÂõûÂÄº‰Ωú‰∏∫ËØ•Â≠óÊÆµÁöÑÂÄº</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_xxx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;123&#34;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ‰º†ÂÖ•ÁöÑobj‰∏∫ÊØèÊ¨°Âæ™ÁéØÁöÑÊï∞ÊçÆÂ∫ìÂØπË±°Ôºåobj.nameÂç≥ÂèØËé∑ÂèñÂØπÂ∫îÁöÑÊï∞ÊçÆÂ∫ìÂÜÖÁöÑÊï∞ÊçÆ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/post%5cpython%5cDRF%5cimage-20241222162904065.png"
	
	
	
	loading="lazy"
	
		alt="image-20241222162904065"
	
	
></p>
<h4 id="1114-ÂµåÂ•ó‰∏éÁªßÊâø">11.1.4 ÂµåÂ•ó‰∏éÁªßÊâø
</h4><p>ËÄÅÊ†∑Â≠êÔºåÂÖàÊãìÂ±ï‰∏Ä‰∏ãÊàë‰ª¨ÁöÑÊï∞ÊçÆË°®ÔºåÊ∑ªÂä†‰∏Ä‰∏™Ê†áÁ≠æÔºåËÆ©ÂÆÉ‰∏éÁî®Êà∑ÊûÑÂª∫Â§öÂØπÂ§öÁöÑÂÖ≥Á≥ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create your models here.</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Depart</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÈÉ®Èó®&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">order</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;È°∫Â∫è&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;‰∫∫Êï∞&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">caption</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Ê†áÁ≠æ&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂßìÂêç&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Âπ¥ÈæÑ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">gender</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÊÄßÂà´&#34;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;Áî∑&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;Â•≥&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">depart</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÈÉ®Èó®&#34;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&#34;Depart&#34;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ctime</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Êó∂Èó¥&#34;</span><span class="p">,</span> <span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Ê†áÁ≠æ&#34;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&#34;Tag&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéÂàõÂª∫Âπ∂Â∫îÁî®ËøÅÁßªÂØπË±°ÂÆûÁé∞ÂØπÊï∞ÊçÆÂ∫ìÁöÑÊìç‰Ωú</p>
<p>Ê∑ªÂä†Â¶Ç‰∏ãÊï∞ÊçÆ‰ª•‰æøÂêéÁª≠ÊµãËØï</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241222191532495.png"
	
	
	
	loading="lazy"
	
		alt="image-20241222191532495"
	
	
></p>
<h5 id="11141-ÂµåÂ•ó">11.1.4.1 ÂµåÂ•ó
</h5><p>ÈÇ£‰πàÈúÄÊ±ÇÊù•‰∫ÜÔºåÊàë‰ª¨Â¶Ç‰ΩïËøîÂõû‰∏Ä‰∏™Áî®Êà∑ÂØπÂ∫îÁöÑÊâÄÊúâÊ†áÁ≠æÂë¢Ôºü</p>
<p>ÊúÄÂ§ßÁöÑQuerysetÂØπË±°Â≠òÊîæÁöÑÊòØ‰∏Ä‰∏™‰∏Ä‰∏™ÁöÑÁî®Êà∑ÂØπË±°objÔºå<code>obj.tags.all()</code>Âç≥ÂèØËé∑ÂæóÊâÄÊúâÁöÑÊ†áÁ≠æÂØπË±°[Tag1,Tag2,&hellip;.]</p>
<p>ÈÇ£‰πàÊÄùË∑ØÊúâ‰∫ÜÊàë‰ª¨Â∞±ÂèØ‰ª•Áî®‰∏äÈù¢Â≠¶‰ºöÁöÑËá™ÂÆö‰πâÊñπÊ≥ïÂÆûÁé∞</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241222192549232.png"
	
	
	
	loading="lazy"
	
		alt="image-20241222192549232"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_xxx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">tag</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&#34;caption&#34;</span><span class="p">:</span> <span class="n">tag</span><span class="o">.</span><span class="n">caption</span><span class="p">}</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">result</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨ÈÄöËøáËá™ÂÆö‰πâÊñπÊ≥ïÂèØ‰ª•ÂÆûÁé∞ËØ•ÈúÄÊ±ÇÔºå‰ΩÜ‰ªçÈúÄË¶ÅËá™Â∑±‰π¶ÂÜôÈÄªËæëÔºåÂÖ∂ÂÆûDRFÁöÑÂ∫èÂàóÂåñÊîØÊåÅÂµåÂ•óÔºå‰∏ãÈù¢Â∞±Êù•ÁúãÁúãÂ¶Ç‰ΩïÂà©Áî®ÂµåÂ•óÂÆûÁé∞</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241222193614643.png"
	
	
	
	loading="lazy"
	
		alt="image-20241222193614643"
	
	
></p>
<p>Â¶Ç‰∏äÂõæÔºå‰∏Ä‰∏™Â∫èÂàóÂåñÂô®ÂèØ‰ª•ÂµåÂ•óÂ≠êÂ∫èÂàóÂåñÂô®ÔºåÂ≠êÂ∫èÂàóÂåñÂô®‰∏≠ÁöÑÊìç‰Ωú‰∏é‰∏ä‰∏ÄËäÇ‰ªãÁªçÁöÑÊó†ÂºÇÔºåÊîØÊåÅËá™ÂÆö‰πâÂ≠óÊÆµÔºåËá™ÂÆö‰πâÊñπÊ≥ïÁ≠âÁ≠âÔºåËøôÊ†∑Â∞±Âø´Êç∑Âú∞ÂÆûÁé∞‰∫ÜÊàë‰ª¨ÁöÑÈúÄÊ±Ç</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">D1</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;title&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">D2</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ex</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">SerializerMethodField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Tag</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;caption&#34;</span><span class="p">,</span> <span class="s2">&#34;ex&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_ex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;xxx&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">depart</span> <span class="o">=</span> <span class="n">D1</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">tags</span> <span class="o">=</span> <span class="n">D2</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s2">&#34;depart&#34;</span><span class="p">,</span> <span class="s2">&#34;tags&#34;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊÄªÁªìÔºö‰∏ÄËà¨Âú®Êúâ<code>foreignkey</code>ÊàñËÄÖ<code>manytomany</code>Êó∂‰ΩøÁî®</p>
<h5 id="11142-ÁªßÊâø">11.1.4.2 ÁªßÊâø
</h5><p><img src="/post%5cpython%5cDRF%5cimage-20241222194350380.png"
	
	
	
	loading="lazy"
	
		alt="image-20241222194350380"
	
	
></p>
<p>Â¶Ç‰∏äÂõæÔºåBaseÂ∫èÂàóÂåñÂô®ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™xxÂ≠óÊÆµÔºåËÄåUserSerializerÂ∫èÂàóÂåñÂô®ÁªßÊâø‰∫ÜBaseÔºåÂ∞±ÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®xxÂ≠óÊÆµ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">xx</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;name&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s2">&#34;xx&#34;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëá≥Ê≠§ÔºåÂ∫èÂàóÂåñÊï∞ÊçÆÁöÑÂÆûÁé∞Â∞±Â∑≤ÁªèÂÖ®ÈÉ®‰ªãÁªç‰∫ÜÔºåÁªèËøá‰∏äÈù¢ÁöÑÂ≠¶‰π†ÔºåÊàë‰ª¨Â∫îËØ•ËÉΩÂ§üÂÖ∑Â§áÔºåÊó†ËÆ∫ÊòØÊï∞ÊçÆÂ∫ì‰∏≠‰ªª‰ΩïË°®ÁªìÊûÑÂÖ≥Á≥ªÔºåËé∑ÂèñÂà∞Ê®°ÂûãÂØπË±°ÊàñËÄÖÊòØQuerySetÊó∂ÔºåÂèØ‰ª•Â∞ÜÂÖ∂ËøõË°åÂ∫èÂàóÂåñËΩ¨‰∏∫JSONÊï∞ÊçÆËøîÂõû</strong></p>
<h3 id="112-Ê∫êÁ†ÅÊµÅÁ®ã">11.2 Ê∫êÁ†ÅÊµÅÁ®ã
</h3><h4 id="1121-ÊµÅÁ®ãÊ¶ÇËø∞">11.2.1 ÊµÅÁ®ãÊ¶ÇËø∞
</h4><p>Á¨¨‰∏ÄÊ≠•ÔºöÂä†ËΩΩÂ≠óÊÆµÔºåÂàõÂª∫Á±ª</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">xx</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;name&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<ol>
<li>Âú®Á±ªÊàêÂëò‰∏≠ÊèêÂèñÂá∫xxÂ≠óÊÆµÂπ∂Âà†Èô§</li>
</ol>
</li>
<li>
<ol start="2">
<li>Ê±áÊÄªÂà∞ <code>BaseSerializer._declared_fields = {&quot;xx&quot;:ÂØπË±°}</code></li>
</ol>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">,</span> <span class="n">BaseSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">yy</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;name&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s2">&#34;yy&#34;</span> <span class="p">,</span><span class="s2">&#34;xx&#34;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<ol>
<li>Âú®Á±ªÊàêÂëò‰∏≠ÊèêÂèñÂá∫yyÂ≠óÊÆµÂπ∂Âà†Èô§</li>
<li>Â∞ÜËá™Â∑±Âç≥ÁªßÊâøÁ±ª‰∏≠ÁöÑÂ≠óÊÆµÈÉΩÊ±áÊÄªÂà∞<code>UserSerializer._declared_fields = {&quot;yy&quot;:ÂØπË±°,&quot;xx&quot;:ÂØπË±°,&quot;name&quot;:ÂØπË±°...}</code></li>
</ol>
</li>
</ul>
<p>Á¨¨‰∫åÊ≠•ÔºöÂ∫èÂàóÂåñ</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span> <span class="o">=</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># ListSerizlizerÂØπË±°„ÄÇÂæ™ÁéØqueryset‰∏≠ÁöÑÊØè‰∏Ä‰∏™ÂØπË±°ÔºåÂØπÂÖ∂Ë∞ÉÁî®UserSerializerËøõË°åÂÆû‰æãÂåñ</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>db-&gt;queryset = [{id:xxx,name:xxx,age:xxx},{id:xxx,name:xxx,age:xxx},]</code></p>
</li>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span> <span class="o">=</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># UserSerializerÂØπË±°</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>db-&gt;instance = {id:xxx,name:xxx,age:xxx}</code></p>
</li>
<li>
<p>Â∫èÂàóÂåñËøáÁ®ã</p>
<ul>
<li><code>instance = models.UserInfo.objects.all().first()</code></li>
<li><code>ser = UserSerializer(instance, many=False)</code></li>
<li>ÂΩìÊâßË°å<code>ser.data</code>Êó∂Ëß¶Âèë
<ul>
<li>ÂÜÖÈÉ®ÂØªÊâæÂØπÂ∫îÂÖ≥Á≥ª
<ul>
<li>Â∞ÜUserSerializer._declared_fields‰∏≠ÁöÑÂ≠óÊÆµ‰∏é‰ªéÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÊü•Âà∞ÁöÑÊï∞ÊçÆÁöÑÊ®°ÂûãÁ±ªÂ≠óÊÆµ‰∏Ä‰∏ÄÂØπÂ∫î</li>
</ul>
</li>
<li>ÈÄê‰∏ÄËøõË°åÂ∫èÂàóÂåñ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1122-ÂàõÂª∫Â≠óÊÆµÂØπË±°">11.2.2 ÂàõÂª∫Â≠óÊÆµÂØπË±°
</h4><p>È¶ñÂÖàÊù•ÊÄùËÄÉ‰∏Ä‰∏™ÈóÆÈ¢ò</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span><span class="n">metaclass</span><span class="o">=</span><span class="nb">type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">999</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äËø∞‰ª£Á†ÅÁöÑÁ±ªÔºåÂú®ÂàõÂª∫Êó∂ÔºåÊòØÂÖàÂä†ËΩΩÂ≠óÊÆµv1ÂíåfuncËøòÊòØÂÖàÂàõÂª∫FooËøô‰∏™Á±ª</p>
<p>Â¶ÇÊûúÁúã‰∏çÂá∫Êù•ÔºåÊàë‰ª¨‰∏çÂ¶®Êç¢‰∏™ÂΩ¢Âºè</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Foo</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s2">&#34;Foo&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nb">object</span><span class="p">,),</span> <span class="p">{</span><span class="s2">&#34;v1&#34;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="s2">&#34;func&#34;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="mi">999</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Áé∞Âú®ÊÉ≥ÂøÖÂæàÊ∏ÖÊô∞‰∫ÜÔºå‰∏ÄÂÆöÊòØÂÖàÂä†ËΩΩÂÆåv1,funcËøô‰∏§‰∏™Â≠óÊÆµÔºåÊâçËÉΩÊää‰ªñ‰ª¨ÂΩìÊàêÂèÇÊï∞‰º†ÈÄíÁªôtypeÂéªÂàõÂª∫FooÁ±ª</p>
<p>Âõ†Ê≠§ÂØπ‰∫é‰∏ãÂàó‰ª£Á†Å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">InfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">order</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏ÄÂÆö‰πüÊòØÂÖàÂä†ËΩΩidÔºåtitleÔºåorder‰∏â‰∏™Â≠óÊÆµÂÜçÂÆû‰æãÂåñ<code>IntegerField()</code>ÂØπË±°&hellip;</p>
<p>ÊâÄ‰ª•Êàë‰ª¨ÂÖàÊù•ÁúãDRFÂàõÂª∫Â≠óÊÆµÂØπË±°ÁöÑÊ∫êÁ†ÅÂÆûÁé∞(Á≤æÁÆÄÁâàÔºåÁî®‰∫éÁêÜËß£ÂÆûÁé∞ÈÄªËæë)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Field</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">_creation_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_creation_counter</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">_creation_counter</span>
</span></span><span class="line"><span class="cl">        <span class="n">Field</span><span class="o">.</span><span class="n">_creation_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">IntegerField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="mi">111</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CharField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">allow_blank</span> <span class="o">=</span> <span class="n">Flase</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">InfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>  <span class="c1"># {max_value:111, _creation_counter:0}</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>  <span class="c1"># {allow_blank:False, _creation_counter:1}</span>
</span></span><span class="line"><span class="cl">    <span class="n">order</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span>  <span class="c1"># {max_value:111, _creation_counter:2}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>id = serializers.IntegerField()</code>Âú®ÊâßË°åÊó∂Ôºå‰ºöÂÆû‰æãÂåñ‰∏Ä‰∏™<code>IntegerField</code>ÂØπË±°ÔºåÂÖàË∞ÉÁî®Ëá™Â∑±ÁöÑ<code>__init__</code>ÊñπÊ≥ïÁªôËá™Â∑±ÁöÑÂÆû‰æãÁ©∫Èó¥ÂÜôÂÖ•ÂÄºÔºåÂ¶Ç<code>max_value</code>ÔºåÂÜçË∞ÉÁî®Áà∂Á±ª<code>Field</code>ÁöÑ<code>__init__</code>ÊñπÊ≥ïÔºåÂÆûÁé∞<code>_creation_counter=0</code>ÔºåÂêåÊó∂Â∞Ü<code>Field</code>ÁöÑÁ±ªÂèòÈáè+1ÔºåÂç≥<code>Field._creation_counter = 1</code></p>
<p><code>title = serializers.CharField()</code>Âú®ÊâßË°åÊó∂Ôºå‰ºöÂÆû‰æãÂåñ‰∏Ä‰∏™<code>CharField</code>ÂØπË±°ÔºåÈÄªËæëÂêå‰∏äÔºå‰ΩÜÊòØ‰ªñÁöÑ<code>_creation_counter=1</code>Ôºå<code>Field._creation_counter = 2</code></p>
<p><code>order = serializers.IntegerField</code>ÂêåÁêÜÔºå<code>_creation_counter=2</code>Ôºå<code>Field._creation_counter = 3</code></p>
<p>Â¶ÇÊûúËøòÊúâÂÖ∂‰ªñ<code>XXSerializer</code>Á±ªÔºå‰ªñÁöÑÂ≠óÊÆµ‰πü‰ºöÊé•ÁùÄÁªôËá™Â∑±ÁöÑ<code>_creation_counter</code>ËµãÂÄºÂπ∂‰∏î‰ΩøÁ±ªÂèòÈáèËá™Â¢û</p>
<p>Âà∞ËøôÈáåÊÉ≥ÂøÖÂ§ßÂÆ∂ÈÉΩÊÑèËØÜÂà∞‰∫ÜÔºåFieldÁ±ªÁõ∏ÂΩì‰∫éÁª¥Êä§‰∫Ü‰∏Ä‰∏™ËÆ°Êï∞Âô®ÔºåÁªôÊØè‰∏Ä‰∏™Â≠óÊÆµËµã‰∫à‰∫ÜÂàõÂª∫ÁöÑÈ°∫Â∫èÔºåÊÑè‰πâ‰ΩïÂú®Ôºü</p>
<p>Â∞±ÊòØËÆ©ÂêéÁª≠ÂºÄÂèëÊó∂ÔºåÊ†πÊçÆÂ≠óÊÆµÂàõÂª∫ÁöÑÈ°∫Â∫èÔºåÊù•ÂÜ≥ÂÆöÊ∫êÁ†ÅÂ§ÑÁêÜÁöÑÈ°∫Â∫è(python3.6‰πãÂâçÂ≠óÂÖ∏ÊòØÊó†Â∫èÁöÑÔºåÂõ†Ê≠§ÈúÄË¶ÅËøôÊ†∑‰∏Ä‰∏™ÈÄªËæë)</p>
<p>ÊâÄ‰ª•ÊÉ≥ËÆ©ÈÇ£‰∏™Â≠óÊÆµÂÖàÂ§ÑÁêÜÔºåÂ∞±Êää‰ªñÁöÑ‰ΩçÁΩÆÂÜôÁöÑ‰∏äÈù¢‰∏Ä‰∫õÔºå‰æãÂ¶ÇÂØÜÁ†Å<code>password</code>‰∏éÁ°ÆËÆ§ÂØÜÁ†Å<code>confirm_password</code>Â∞±ÈúÄË¶ÅËøôÊ†∑‰∏Ä‰∏™ÂÖàÂêéÂÖ≥Á≥ª</p>
<h4 id="1123-ÂàõÂª∫Á±ª">11.2.3 ÂàõÂª∫Á±ª
</h4><p>‰∏ä‰∏ÄÂ∞èËäÇ‰∏≠Êàë‰ª¨Â∑≤Áªè‰∫ÜËß£‰∫ÜÂ≠óÊÆµÂØπË±°ÁöÑÂàõÂª∫ÈÄªËæëÔºåÈÇ£‰πàÂú®Â≠óÊÆµÂä†ËΩΩÂÆåÊàêÂêéÔºåÂ≠óÊÆµÂ∞Ü‰ºöË¢´‰Ωú‰∏∫ÂèÇÊï∞‰º†ÈÄíËøõÂéªÂàõÂª∫<code>InfoSerializer</code>Á±ª</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241223185239959.png"
	
	
	
	loading="lazy"
	
		alt="image-20241223185239959"
	
	
></p>
<p><code>InfoSerializer</code>Á±ªÁöÑÁà∂Á±ªÊòØ<code>Serializer</code>Á±ªÔºåËØ•Á±ªÂú®ÂàõÂª∫Êó∂ÊåáÂÆö‰∫Ü<code>metaclass=SerializerMetaclass</code>ÔºåÁî±ÂÖÉÁ±ªÁöÑÁü•ËØÜÊàë‰ª¨Áü•ÈÅìÔºå‰∏ÄÊó¶<code>Serializer</code>ÊåáÂÆö‰∫Ü<code>metaclass=SerializerMetaclass</code>ÔºåÈÇ£‰πàÂÖ∂ÊâÄÊúâÁöÑÂ≠êÁ±ªÂú®ÂàõÂª∫Êó∂ÈÉΩÂ∞ÜÊåáÂÆöÂÖÉÁ±ª‰∏∫<code>SerializerMetaclass</code>ÔºåÂõ†Ê≠§‰∏çÁÆ°ÊòØÁªßÊâøÁöÑ<code>Serializer</code>ËøòÊòØ<code>ModelSerializer</code>ÔºåÊúÄÁªàÈÉΩÁî±ÂÖÉÁ±ª<code>SerializerMetaclass</code>ÂàõÂª∫</p>
<p>‰∏ãÈù¢Êàë‰ª¨Â∞±Êù•ÁúãÁúã<code>SerializerMetaclass</code>ÊòØÊÄé‰πàÂàõÂª∫Á±ªÁöÑ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SerializerMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@classmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_get_declared_fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.1 ÂàóË°®Êé®ÂØºÂºèÊûÑÂª∫Ëá™Â∑±Á±ªÁöÑÂ≠óÊÆµÂØπË±°ÂàóË°®fields</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field_name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                  <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Field</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.2 ÊéíÂ∫è</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_creation_counter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">known</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">known</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.3 ÂàóË°®Êé®ÂØºÂºèÊûÑÂª∫Áà∂Á±ªÁöÑÂ≠óÊÆµÂàóË°®base_fields</span>
</span></span><span class="line"><span class="cl">        <span class="n">base_fields</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Â∞ÜÊú™ÈáçÂ§çÁöÑÂ≠óÊÆµÂíåÂÆû‰æãÊ∑ªÂä†Âà∞base_fields‰∏≠ÔºåÂêåÊó∂Â∞ÜÂ≠óÊÆµÊ†áËÆ∞‰∏∫Â∑≤Ê∑ªÂä†</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="n">visit</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ÈÅçÂéÜÁà∂Á±ªÔºåÊãøÂà∞Â≠êu‰ΩÜÂêçÁß∞fÂíåÂ≠óÊÆµÂÆû‰æãf</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;_declared_fields&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">_declared_fields</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">known</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.4 Â∞ÜÁà∂Á±ªÂ≠óÊÆµ‰∏éËá™Â∑±ÁöÑÂ≠óÊÆµÂêàÂπ∂ÂàóË°®ËøîÂõû</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">base_fields</span> <span class="o">+</span> <span class="n">fields</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Âú®attrs‰∏≠Êñ∞Â¢û_declared_fieldsÂ≠óÊÆµÁî®‰∫éÂ≠òÂÇ®Ëá™Â∑±ÁöÑÂ≠óÊÆµÂØπË±°ÂíåÁà∂Á±ªÁöÑÂ≠óÊÆµÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;_declared_fields&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_declared_fields</span><span class="p">(</span><span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.ÂÜçË∞ÉÁî®typeÁöÑ__new__ÂàõÂª∫Á±ª</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ËØ•Á±ªÂú®ÂàõÂª∫Êó∂attr‰∏ÄÂÖ±ÊòØ‰∫î‰∏™ÂÄºÔºå‰∏Ä‰∏™Êï¥Âûã‰∏â‰∏™Â≠óÊÆµÂØπË±°Âíå‰∏Ä‰∏™Á±ª</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">InfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="mi">123</span>
</span></span><span class="line"><span class="cl">    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">order</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>1.1 ÂàóË°®Êé®ÂØºÂºèÊûÑÂª∫Ëá™Â∑±Á±ªÁöÑÂ≠óÊÆµÂàóË°®fields</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">attrs</span> <span class="o">--&gt;</span>  <span class="p">{</span><span class="s2">&#34;v1&#34;</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="s2">&#34;id&#34;</span><span class="p">:</span><span class="n">IntegerFieldÂØπË±°</span><span class="p">,</span><span class="s2">&#34;title&#34;</span><span class="p">:</span><span class="n">CharFieldÂØπË±°</span><span class="p">,</span><span class="o">...</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âæ™ÁéØËé∑ÂèñÂ≠óÊÆµÂêç<code>field_name</code>ÂíåÂ≠óÊÆµÂÄº<code>obj</code>ÔºåÂ¶ÇÊûú<code>obj</code>ÊòØ<code>Field</code>ÁöÑÂ≠êÁ±ªÔºåÂàôÊûÑÂª∫ÂÖÉÁªÑÂä†ÂÖ•fieldsÂàóË°®ÔºåÂêåÊó∂Âú®attrs‰∏≠ÂâîÈô§Ôºå</p>
<p>Âõ†Ê≠§Âæ™ÁéØÁªìÊùüÂêé</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">attrs</span> <span class="o">--&gt;</span>  <span class="p">{</span><span class="s2">&#34;v1&#34;</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="s2">&#34;Meta&#34;</span><span class="p">:</span><span class="n">ÂØπË±°</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">fields</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&#34;id&#34;</span><span class="p">,</span><span class="n">ÂØπË±°</span><span class="p">),(</span><span class="s2">&#34;title&#34;</span><span class="p">,</span><span class="n">ÂØπË±°</span><span class="p">),(</span><span class="s2">&#34;order&#34;</span><span class="p">,</span><span class="n">ÂØπË±°</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>1.2 ÊéíÂ∫è</li>
</ul>
<p>ËøòËÆ∞Âæó‰∏ä‰∏ÄËäÇÂàõÂª∫Â≠óÊÆµÂØπË±°Êó∂ÁöÑÈÇ£‰∏™ËÆ°Êï∞Âô®ÂêóÔºüËøô‰∏ÄÊ≠•ÁöÑÊéíÂ∫è‰æøÊòØ‰æùÊçÆÂêÑ‰∏™Â≠óÊÆµÂØπË±°ÂÜÖÁöÑ<code>_creation_counter</code>Â§ßÂ∞èËøõË°åÊéíÂ∫è</p>
<ul>
<li>1.3 ÂàóË°®Êé®ÂØºÂºèÊûÑÂª∫Áà∂Á±ªÁöÑÂ≠óÊÆµÂàóË°®base_fields</li>
</ul>
<p>Âæ™ÁéØÁà∂Á±ªÁöÑ<code>_declared_fields</code>ÔºåÂ∞ÜÂΩìÂâçÁ±ªÊ≤°ÊúâÁöÑÂ≠óÊÆµÊ∑ªÂä†Âà∞ÂàóË°®<code>base_fields</code>‰∏≠</p>
<ul>
<li>1.4 Â∞ÜÁà∂Á±ªÂ≠óÊÆµ‰∏éËá™Â∑±ÁöÑÂ≠óÊÆµÂêàÂπ∂ÂàóË°®ËøîÂõû</li>
</ul>
<p>ÁÆÄÂçïÁöÑÂ∞Ü‰∏§‰∏™ÂàóË°®Áõ∏Âä†ËøîÂõûÔºåÂÜçË∞ÉÁî®typeÁöÑ<code>__new__</code>ÂÆûÁé∞Á±ªÁöÑÂàõÂª∫</p>
<h4 id="1124-ÂÆû‰æãÂåñÁ±ª">11.2.4 ÂÆû‰æãÂåñÁ±ª
</h4><p>ÂàõÂª∫ÂØπË±°‰ª•ÂèäÂâçÁΩÆÁöÑÂä†ËΩΩÂ≠óÊÆµÈÉΩÊòØÂú®djangoÈ°πÁõÆËøêË°åÊó∂Â∞±ÊâßË°åÁöÑÔºåËÄåÂΩìËØ∑Ê±ÇÂà∞Êù•Êó∂ÔºåËßÜÂõæÂáΩÊï∞‰ªéÊï∞ÊçÆÂ∫ìËé∑ÂèñÊï∞ÊçÆÂπ∂Â∫èÂàóÂåñÔºåÊ≠§Êó∂Â∞±Êù•Âà∞‰∫ÜÂÆû‰æãÂåñÁ±ªÁöÑËøáÁ®ã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span> <span class="o">=</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">instance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span> <span class="o">=</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖàËÆ≤Ëß£Á¨¨‰∫å‰∏™ÔºåÂç≥Âçï‰∏™ÂØπË±°ÁöÑÊÉÖÂÜµ</p>
<p>ÂÆû‰æãÂåñÁ±ª‰æùÊ¨°ÊâßË°å<code>BaseSerializer</code>Á±ªÁöÑ<code>__new__</code>ÔºåÊ†πÊçÆmanyÂ±ûÊÄßÁöÑÂÄºÂàÜ‰∏∫‰∏§Ë∑ØÔºåÂΩìÂâçÊÉÖÂÜµÊó∂Ë∞ÉÁî®Áà∂Á±ªÂç≥FieldÁöÑ<code>__new__</code>ÊñπÊ≥ïÔºåFieldÂèàË∞ÉÁî®objectÂü∫Á±ªÁöÑ<code>__new__</code>ÂàõÂª∫ÂÆû‰æã</p>
<p>ÂàõÂª∫ÂÆû‰æãÂêéÔºå‰ºöË∞ÉÁî® <code>BaseSerializer</code> ÁöÑ <code>__init__</code> ÊñπÊ≥ïÊù•ÂàùÂßãÂåñÂÆû‰æã</p>
<p>Ê†πÊçÆÂ∫èÂàóÂåñÂô®Á±ªÁªßÊâøÁöÑ‰∏çÂêåÔºåË∞ÉÁî®<code>ModelSerializer</code>Êàñ<code>Serializer</code>ÁöÑ<code>get_fields</code>ÊñπÊ≥ïÔºåËØ•Â§ÑËÆ≤Ëß£Ââç‰∏Ä‰∏™ÊÉÖÂÜµÔºåÊ†πÊçÆÊ®°ÂûãÂ≠óÊÆµÁîüÊàêÂ∫èÂàóÂåñÂ≠óÊÆµ</p>
<p>Ë∞ÉÁî®get_fields() Ëé∑ÂèñÂ∫èÂàóÂåñÂô®‰∏≠ÂÆö‰πâÁöÑÊâÄÊúâÂ≠óÊÆµfields</p>
<ul>
<li>ÊòæÁ§∫Â£∞ÊòéÁöÑÂ≠óÊÆµdeclared_fields</li>
<li>Ê†πÊçÆÊ®°ÂûãÂ≠óÊÆµËΩ¨ÂåñÊàêÂ∫èÂàóÂåñÂ≠óÊÆµÊ∑ªÂä†Âà∞fields‰∏≠</li>
</ul>
<p>Ë∞ÉÁî®_init_fields ÂàùÂßãÂåñÂ≠óÊÆµÔºåÂ∞ÜÂ≠óÊÆµÁªëÂÆöÂà∞Â∫èÂàóÂåñÂô®ÂÆû‰æã‰∏äÔºàË∞ÉÁî®FieldÁ±ªÁöÑbindÊñπÊ≥ïÔºâ</p>
<ul>
<li>field_name</li>
<li>parent</li>
<li>sourceÂ≠óÊÆµ</li>
<li>source_attrsÂ≠óÊÆµ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseSerializer</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;many&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">many_init</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># many=FlaseÂàôËµ∞ËøôÊù°ÈÄªËæëÔºåÂç≥Âè™Â§ÑÁêÜÂçïÂØπË±°ÔºåÂàôË∞ÉÁî®objectÂü∫Á±ªÁöÑ__new__ÂàõÂª∫ÂØπË±°ÔºåÁ¥ßÊé•ÁùÄÂØªÊâæ__init__ÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">empty</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â≠òÂÇ®‰º†ÂÖ•ÁöÑÊ®°ÂûãÂÆû‰æãÊàñÊü•ËØ¢ÈõÜ</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñÂ∫èÂàóÂåñÂô®‰∏≠ÂÆö‰πâÁöÑÊâÄÊúâÂ≠óÊÆµ</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂàùÂßãÂåñÂ≠óÊÆµÔºåÂ∞ÜÂ≠óÊÆµÁªëÂÆöÂà∞Â∫èÂàóÂåñÂô®ÂÆû‰æã‰∏äÔºàË∞ÉÁî®FieldÁ±ªÁöÑbindÊñπÊ≥ïÔºâ</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_fields</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_init_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">field</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ModelSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñÂú®Á±ªÂÆö‰πâ‰∏≠ÊòæÂºèÂ£∞ÊòéÁöÑÂ≠óÊÆµÔºåÂç≥ÂâçÈù¢ÊèêÂà∞ÁöÑid,title,order</span>
</span></span><span class="line"><span class="cl">        <span class="n">declared_fields</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_declared_fields</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëé∑ÂèñÊ®°ÂûãÁöÑÂ≠óÊÆµ‰ø°ÊÅØÔºåÂéª UserSerializer ‰∏≠ÁöÑ Meta ‰∏≠Êâæ model Â≠óÊÆµÔºåÂç≥ model = models.UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Meta</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ËøîÂõû‰∏Ä‰∏™ÂåÖÂê´Ê®°ÂûãÂ≠óÊÆµÂíåÂÖ≥Á≥ªÁöÑËØ¶ÁªÜ‰ø°ÊÅØÁöÑÂ≠óÂÖ∏,ÂåÖÂê´‰∫ÜÊØè‰∏™Â≠óÊÆµÁöÑËØ¶ÁªÜ‰ø°ÊÅØÔºå‰æãÂ¶ÇÂ≠óÊÆµÁ±ªÂûã„ÄÅÊòØÂê¶ÊòØÂÖ≥Á≥ªÂ≠óÊÆµÔºàÂ¶ÇÂ§ñÈîÆ„ÄÅÂ§öÂØπÂ§öÂ≠óÊÆµÁ≠âÔºâ‰ª•ÂèäÂÖ∂‰ªñÂÖÉÊï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">        <span class="n">info</span> <span class="o">=</span> <span class="n">model_meta</span><span class="o">.</span><span class="n">get_field_info</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ê†πÊçÆ declared_fields Âíå info Êù•Á°ÆÂÆöÊúÄÁªàÁöÑÂ≠óÊÆµÂêçÁß∞ÂàóË°®„ÄÇËøô‰∏™ÊñπÊ≥ïÂèØËÉΩ‰ºöÊ†πÊçÆÂ∫èÂàóÂåñÂô®ÁöÑÈÖçÁΩÆÂíåÊ®°ÂûãÁöÑÂ≠óÊÆµ‰ø°ÊÅØÊù•ÊéíÈô§ÊàñÂåÖÂê´Êüê‰∫õÂ≠óÊÆµ</span>
</span></span><span class="line"><span class="cl">        <span class="n">field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_field_names</span><span class="p">(</span><span class="n">declared_fields</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="c1"># Ê†πÊçÆÊ®°ÂûãÂ≠óÊÆµÁîüÊàêÂ∫èÂàóÂåñÂ≠óÊÆµ</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Ê†πÊçÆÂ≠óÊÆµÁöÑÁ±ªÂûãÂíåÂ±ûÊÄßÊù•ÂÜ≥ÂÆö‰ΩøÁî®Âì™‰∏™Â∫èÂàóÂåñÂô®Â≠óÊÆµÁ±ªÔºå‰ª•ÂèäÂ¶Ç‰ΩïÈÖçÁΩÆËøô‰∏™Â≠óÊÆµ</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ÁÆÄÂçïÊù•ËØ¥Â∞±ÊòØÊääÊï∞ÊçÆÂ∫ìÂ≠óÊÆµËΩ¨ÊàêÂ∫èÂàóÂåñÂô®Â≠óÊÆµÁ±ªÂ¶Çmodels.CharFieldÁ±ªËΩ¨ÊàêCharFieldÁ±ªÔºåÁÑ∂ÂêéÊîæÂÖ•fields‰∏≠</span>
</span></span><span class="line"><span class="cl">            <span class="n">field_class</span><span class="p">,</span> <span class="n">field_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_field</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">source</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">depth</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Create the serializer field.</span>
</span></span><span class="line"><span class="cl">            <span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_class</span><span class="p">(</span><span class="o">**</span><span class="n">field_kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Add in any hidden fields.</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hidden_fields</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">fields</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Field</span><span class="p">:</span>    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â≠óÊÆµÁöÑÂêçÁß∞ÔºåÁî®‰∫éÂú®Â∫èÂàóÂåñÂô®‰∏≠Ê†áËØÜÂ≠óÊÆµ</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span> <span class="o">=</span> <span class="n">field_name</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â≠óÊÆµÊâÄÂ±ûÁöÑÂ∫èÂàóÂåñÂô®ÂÆû‰æã</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â≠óÊÆµÁöÑÊ∫êÂêçÁß∞ÔºåÁî®‰∫é‰ªéÊ®°ÂûãÂÆû‰æã‰∏≠Ëé∑ÂèñÊï∞ÊçÆÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåsource ‰∏éÂ≠óÊÆµÂêçÁß∞Áõ∏Âêå</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">field_name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">source_attrs</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Â¶ÇÊûúÊòØÂ§ñÈîÆË∑®Ë°®ÁöÑÂΩ¢ÂºèÂ¶Çdepart.titleÔºåÂ∞±‰ºöË¢´ÂàÜÂâ≤Êàê‰∏Ä‰∏™ÂàóË°®</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">source_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøîÂõûÁöÑ<code>ser</code>ÊòØ<code>UserSerializer</code>Â∫èÂàóÂåñÂô®ÂÆû‰æãÔºåÊòØ‰∏Ä‰∏™Â§çÊùÇÁöÑÂØπË±°ÔºåÂåÖÂê´‰ª•‰∏ãÂÜÖÂÆπ</p>
<ul>
<li><code>instance</code>Ôºö‰º†ÂÖ•ÁöÑÊ®°ÂûãÂÆû‰æãÔºà<code>UserInfo</code> ÂØπË±°Ôºâ</li>
<li><code>data</code>ÔºöÂ∫èÂàóÂåñÂêéÁöÑÊï∞ÊçÆÔºàÈÄöËøáËÆøÈóÆ <code>ser.data</code> Ëé∑ÂæóÔºâ</li>
<li><code>fields</code>ÔºöÂ∫èÂàóÂåñÂô®‰∏≠ÂÆö‰πâÁöÑÊâÄÊúâÂ≠óÊÆµ
<ul>
<li>ÊØè‰∏™Â≠óÊÆµÂÆû‰æãÈÉΩÊúâËá™Â∑±ÁöÑÂ±ûÊÄßÂíåÊñπÊ≥ïÔºå‰æãÂ¶ÇÔºö
<ul>
<li><code>field_name</code>ÔºöÂ≠óÊÆµÁöÑÂêçÁß∞„ÄÇ</li>
<li><code>parent</code>ÔºöÂ≠óÊÆµÊâÄÂ±ûÁöÑÂ∫èÂàóÂåñÂô®ÂÆû‰æã„ÄÇ</li>
<li><code>source</code>ÔºöÂ≠óÊÆµÁöÑÊ∫êÂêçÁß∞ÔºåÁî®‰∫é‰ªéÊ®°ÂûãÂÆû‰æã‰∏≠Ëé∑ÂèñÊï∞ÊçÆ„ÄÇ</li>
<li><code>to_representation</code>ÔºöÂ∞ÜÂ≠óÊÆµÂÄºËΩ¨Êç¢‰∏∫ÂèØÂ∫èÂàóÂåñÁöÑÊ†ºÂºè„ÄÇ</li>
<li><code>to_internal_value</code>ÔºöÂ∞ÜËæìÂÖ•Êï∞ÊçÆËΩ¨Êç¢‰∏∫ Python Êï∞ÊçÆÁ±ªÂûã„ÄÇ</li>
</ul>
</li>
</ul>
</li>
<li><code>errors</code>ÔºöÂ¶ÇÊûúÂ∫èÂàóÂåñËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØÔºåÂ≠òÂÇ®ÈîôËØØ‰ø°ÊÅØ</li>
</ul>
<p><code>ser.data</code> ÊòØÂ∫èÂàóÂåñÂêéÁöÑÊï∞ÊçÆ</p>
<ul>
<li>ÂΩì‰Ω†ËÆøÈóÆ <code>ser.data</code> Êó∂ÔºåÂ∫èÂàóÂåñÂô®‰ºöÂ∞ÜÊ®°ÂûãÂÆû‰æãËΩ¨Êç¢‰∏∫‰∏Ä‰∏™ Python Â≠óÂÖ∏</li>
<li>Ëøô‰∏™Â≠óÂÖ∏ÂèØ‰ª•Ë¢´Ëøõ‰∏ÄÊ≠•Ê∏≤Êüì‰∏∫ JSON Ê†ºÂºèÔºå‰ª•‰æøËøîÂõûÁªôÂÆ¢Êà∑Á´Ø</li>
</ul>
<p>Â¶ÇÊûúÊòØÁ¨¨‰∏Ä‰∏™ÔºåÂç≥Â§ö‰∏™ÂØπË±°ÁöÑquerysetÁöÑÊÉÖÂÜµ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseSerializer</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># many=TrueÔºåÂ§ÑÁêÜÂ§öÂØπË±°ÔºåËøõÂÖ•ifÂÜÖÈÉ®ÔºåÊâßË°åmany_initÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;many&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">many_init</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">empty</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@classmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">many_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">child_serializer</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># ÂÆû‰æãÂåñÂΩìÂâçÁ±ªÔºàÂ¶Ç UserSerializerÔºâÁöÑÂçï‰∏™ÂØπË±°Â∫èÂàóÂåñÂô®</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂàõÂª∫‰∏Ä‰∏™Â≠óÂÖ∏ÔºåÂ∞Ü child_serializer ‰Ωú‰∏∫Â≠êÂ∫èÂàóÂåñÂô®‰º†ÈÄíÁªô ListSerializer</span>
</span></span><span class="line"><span class="cl">        <span class="n">list_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;child&#39;</span><span class="p">:</span> <span class="n">child_serializer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">meta</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;Meta&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">list_serializer_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s1">&#39;list_serializer_class&#39;</span><span class="p">,</span> <span class="n">ListSerializer</span><span class="p">)</span>  <span class="c1"># Meta‰∏≠ÂèØ‰ª•ÂÆö‰πâÔºåÈªòËÆ§‰∏∫ListSerializer</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">list_serializer_class</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">list_kwargs</span><span class="p">)</span>  <span class="c1"># ÂÆû‰æãÂåñListSerializer()ÔºåÂπ∂Â∞ÜÊØè‰∏Ä‰∏™UserSerializerÂØπË±°‰º†ÂÖ•</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ListSerializer</span><span class="p">(</span><span class="n">BaseSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â≠êÂ∫èÂàóÂåñÂô®ÂÆû‰æãÔºåÁî®‰∫éÂ∫èÂàóÂåñÊØè‰∏™ÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">child</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≠§Êó∂ËøîÂõûÁöÑÂ∞±ÊòØ‰∏çÊòØ<code>UserSerializer</code>ÂØπË±°‰∫ÜÔºåËÄåÊòØ<code>ListSerializer</code>ÂØπË±°ÔºåÂÖ∂ÂÆûÂ∞±ÊòØ‰∏Ä‰∏™ÂàóË°®ÔºåÂàóË°®ÂÜÖÂÖÉÁ¥†ÈÉΩÊòØ<code>UserSerializer</code>ÂØπË±°</p>
<h4 id="1125-Â∫èÂàóÂåñËøáÁ®ã">11.2.5 Â∫èÂàóÂåñËøáÁ®ã
</h4><p>‰∏ä‰∏ÄËäÇÊàë‰ª¨‰ªãÁªçÁöÑÂÆû‰æãÂåñÁ±ªÂØπÂ∫îÁöÑÊòØ<code>ser = UserSerializer(queryset, many=True)</code>Ëøô‰∏ÄË°å‰ª£Á†ÅÔºåÊ≠§Êó∂Âè™ÊòØÂ∞ÜÊï∞ÊçÆÂ∞ÅË£ÖÂà∞ÂØπË±°‰∏≠ÔºåÁúüÊ≠£Ëß¶ÂèëÂ∫èÂàóÂåñÂä®‰ΩúÁöÑÊòØÂΩì<code>ser.data</code></p>
<h5 id="11251-userserializerÁ±ª">11.2.5.1 UserSerializerÁ±ª
</h5><p>Êàë‰ª¨ÂÖàËØ¥ÂΩìÂâçÁ±ªÔºåÂç≥<code>UserSerializer</code>Á±ªËß¶ÂèëÂ∫èÂàóÂåñÁöÑÊÉÖÂÜµ</p>
<p>ser.data &ndash;&gt; Serializer‰∏≠ÁöÑdata &ndash;&gt;  BaseSerializer‰∏≠ÁöÑdata &ndash;&gt; self._data = self.to_representation(self.instance)</p>
<p>‰∫éÊòØÂÖ≥ÈîÆÂ∞±ÊòØSerializerÁöÑto_representationÊñπÊ≥ïÔºåÊàë‰ª¨‰∏ãÈù¢Êù•ÂàÜÊûêÔºö</p>
<p>Ëé∑ÂèñÊâÄÊúâÁöÑÂ≠óÊÆµfields = Serializer._readable_fields __</p>
<ul>
<li>__self._readable_fieldsËØªÂèñSerializer.fieldsÁöÑÂÄº</li>
</ul>
<p>Âæ™ÁéØÊâÄÊúâÁöÑÂ≠óÊÆµÂØπË±°for field in fields:</p>
<ul>
<li>
<p>ÂéªÊï∞ÊçÆÂ∫ìÂØπË±°‰∏≠‰æùÊçÆÂ≠óÊÆµÁöÑ‰ø°ÊÅØËé∑ÂèñÊï∞ÊçÆattribute = field.get_attribute(instance)</p>
<ul>
<li>
<p>bindÊñπÊ≥ïÂ§ÑÁêÜËøáÁöÑsourceÔºåÂ¶ÇÊûúÊòØÂ§ñÈîÆË∑®Ë°®ÁöÑÂΩ¢ÂºèÂ¶Çdepart.titleÔºåÂ∞±‰ºöË¢´ÂàÜÂâ≤Êàê‰∏Ä‰∏™ÂàóË°®Â≠òÂÖ•self.source_attrs</p>
<p>Field.get_attributeË∞ÉÁî® get_attribute(instance, self.source_attrs)</p>
</li>
<li>
<p>get_attributeÂæ™ÁéØsource_attrsÂèñÂá∫instanceÂØπÂ∫îËØ•sourceÁöÑÂÄº</p>
</li>
</ul>
</li>
<li>
<p>Â∞ÜËé∑ÂèñÂà∞ÁöÑÊï∞ÊçÆÈÄöËøáÂ∫èÂàóÂåñÂô®Á±ªÁöÑto_representationÊñπÊ≥ïËΩ¨Âèò‰∏Ä‰∏ãÊ†ºÂºèÂä†ÂÖ•ret‰∏≠ÔºåÂ¶ÇIntegerField‰ºöÂØπÊï∞ÊçÆËøõË°åint()ËΩ¨Êç¢Á≠âÁ≠âret[field.field_name] = field.to_representation(attribute)</p>
</li>
<li>
<p>Â∞ÜrefËøîÂõû</p>
</li>
</ul>
<p>Á≤æÁÆÄÁâàÁöÑÊ∫êÁ†ÅÔºåÁªìÂêà‰∏äËø∞ÊñáÂ≠óÊµÅÁ®ãÈ£üÁî®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.contrib.gis.gdal.raster</span> <span class="kn">import</span> <span class="n">source</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseSerializer</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_data&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_errors&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># ÁúüÊ≠£ÂÆûÁé∞Â∫èÂàóÂåñÁöÑÊ≠•È™§</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_validated_data&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_errors&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validated_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Serializer</span><span class="p">(</span><span class="n">BaseSerializer</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">SerializerMetaclass</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ReturnDict</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Ëé∑ÂèñÊâÄÊúâÁöÑÂ≠óÊÆµÔºöÂÖàÂâçÂä†ËΩΩÁöÑ InfoSerializer._declared_fields + Meta‰∏≠ÊåáÂÆöÁöÑfieldsÂ≠óÊÆµ‰∏Ä‰∏ÄÂàõÂª∫ÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readable_fields</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 2. Âæ™ÁéØÊâÄÊúâÁöÑÂ≠óÊÆµÂØπË±°(ÈÉΩÊòØÂ∫èÂàóÂåñÂô®Â≠óÊÆµÂØπË±°)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ÂéªÂ≠óÊÆµÂØπË±°‰∏≠‰æùÊçÆÂ≠óÊÆµÁöÑ‰ø°ÊÅØËé∑ÂèñÊï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">            <span class="n">attribute</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Â∞ÜËé∑ÂèñÂà∞ÁöÑÊï∞ÊçÆÈÄöËøáÂ∫èÂàóÂåñÂô®Á±ªÁöÑto_representationÊñπÊ≥ïËΩ¨Êç¢‰∏∫ÈÄÇÂêà JSON Â∫èÂàóÂåñÁöÑÊ†ºÂºèÂä†ÂÖ•ret‰∏≠ÔºåÂ¶ÇIntegerField‰ºöÂØπÊï∞ÊçÆËøõË°åint()ËΩ¨Êç¢Á≠âÁ≠â</span>
</span></span><span class="line"><span class="cl">            <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_readable_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">yield</span> <span class="n">field</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Field</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="n">source</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ê≠§Â§ÑÁöÑsource_attrsÊòØsourceÁªèËøábindÂ§ÑÁêÜÂêéÁöÑ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># get_attributeÂ∞±Âéªinstance‰∏≠ÂèñÂá∫ÂØπÂ∫îÁöÑÂÄºÔºåÂ¶ÇÂàóË°®[&#34;depart&#34;,&#34;title&#34;]Ôºå‰ºöÂæ™ÁéØÂéªÂèñÂÄºÔºåËøîÂõûinstance.depart.title</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">get_attribute</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ê†πÊçÆsourseÂíåinstanceÂèñÂæóÂØπÂ∫îÁöÑÂÄº</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">is_simple_callable</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># If we raised an Attribute or KeyError here it&#39;d get treated</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># as an omitted field in `Field.get_attribute()`. Instead we</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># raise a ValueError to ensure the exception is not masked.</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;Exception raised in callable attribute &#34;</span><span class="si">{}</span><span class="s1">&#34;; original exception was: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">instance</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">IntegerField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="mi">111</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">InfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>  <span class="c1"># {max_value:111, _creation_counter:0,source=&#34;id&#34;}sourceÊú™ÂÆö‰πâÈªòËÆ§‰∏∫Â≠óÊÆµÂêç</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>  <span class="c1"># {allow_blank:False, _creation_counter:1}</span>
</span></span><span class="line"><span class="cl">    <span class="n">order</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span>  <span class="c1"># {max_value:111, _creation_counter:2}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="s2">&#34;__all__&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="11252-listserializerÁ±ª">11.2.5.2 ListSerializerÁ±ª
</h5><p>Â¶ÇÊûúÂ∑≤Áªè‰∫ÜËß£‰∫ÜUserSerializerÁ±ªÁöÑÂ∫èÂàóÂåñËøáÁ®ãÔºåÈÇ£‰πàListSerializerÁ±ªÁöÑÂ∫èÂàóÂåñÂè™ÊòØÂú®‰ªñÁöÑÂü∫Á°Ä‰∏äÂ§ö‰∫Ü‰∏Ä‰∏™Âæ™ÁéØ</p>
<p>ser.data &ndash;&gt; ListSerializer‰∏≠ÁöÑdata &ndash;&gt;  BaseSerializer‰∏≠ÁöÑdata &ndash;&gt; self._data = self.to_representation(self.instance)</p>
<p>‰ΩÜÊòØÊ≠§Êó∂ÁöÑto_representation‰ºòÂÖàÊâæÁöÑÊòØListSerializerÁ±ª‰∏≠Ëá™Â∑±ÂÆö‰πâÁöÑÁöÑ</p>
<p>Êàë‰ª¨ÂÖàÁúã‰∏Ä‰∏ãListSerializerÁ±ªÊòØÂ¶Ç‰ΩïÂÆû‰æãÂåñÁöÑ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@classmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">many_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">child_serializer</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># ÂÆû‰æãÂåñUserSerializerÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="n">list_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;child&#39;</span><span class="p">:</span> <span class="n">child_serializer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">meta</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;Meta&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">list_serializer_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s1">&#39;list_serializer_class&#39;</span><span class="p">,</span> <span class="n">ListSerializer</span><span class="p">)</span>  <span class="c1"># Meta‰∏≠ÂèØ‰ª•ÂÆö‰πâÔºåÈªòËÆ§‰∏∫ListSerializer</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">list_serializer_class</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">list_kwargs</span><span class="p">)</span>  <span class="c1"># ÂÆû‰æãÂåñListSerializer()ÔºåÂπ∂Â∞ÜÊØè‰∏Ä‰∏™UserSerializerÂØπË±°‰º†ÂÖ•</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÁúãÂà∞ÔºåListSerializerÁ±ª‰∏≠ÊòØ‰∏Ä‰∏™‰∏™UserSerializerÂØπË±°</p>
<p>Âõ†Ê≠§ListSerializerÁ±ªÂú®to_representationÊñπÊ≥ïÊó∂Âæ™ÁéØÊØè‰∏Ä‰∏™UserSerializerÂØπË±°Âπ∂Ë∞ÉÁî®ÂÆÉÁöÑto_representationÊñπÊ≥ïÔºåÊòæÁÑ∂ÔºåÂ∞±ÊòØ‰∏ÄÈÅçÂèà‰∏ÄÈÅçÁöÑÈáçÂ§çÊàë‰ª¨‰∏ä‰∏ÄÂ∞èËäÇÂàÜÊûêÁöÑUserSerializerÁ±ªÂ∫èÂàóÂåñÁöÑËøáÁ®ãÔºåÊ≠§Â§Ñ‰æø‰∏çÂÜçÂèôËø∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">	    
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ListSerializer</span><span class="p">(</span><span class="n">BaseSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">iterable</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iterable</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="113-Êï∞ÊçÆÊ†°È™å">11.3 Êï∞ÊçÆÊ†°È™å
</h3><p>Ë∑ØÁî± -&gt; ËßÜÂõæ -&gt; request.data -&gt; Ê†°È™å(Â∫èÂàóÂåñÂô®ÁöÑÁ±ª) -&gt; Êìç‰ΩúÊï∞ÊçÆ</p>
<p>Êé•Âè£ËÆæËÆ°ÁöÑÂ∞èËßÑËåÉÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Ëé∑ÂèñÊï∞ÊçÆ</span><span class="err">Ôºö</span>
</span></span><span class="line"><span class="cl">	<span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">user</span><span class="o">/</span>		<span class="o">-&gt;</span><span class="n">GETËØ∑Ê±Ç</span>		<span class="o">-&gt;</span><span class="n">Ëé∑ÂèñÊï∞ÊçÆÂàóË°®</span>	<span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span>		<span class="o">-&gt;</span><span class="n">GETËØ∑Ê±Ç</span>		 <span class="o">-&gt;</span><span class="n">Ëé∑ÂèñÂçï‰∏™Êï∞ÊçÆ</span>	<span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">user</span>			<span class="o">-&gt;</span><span class="n">POSTËØ∑Ê±Ç</span> 	 <span class="o">-&gt;</span><span class="n">Êñ∞Â¢ûÊï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span>		 <span class="o">-&gt;</span><span class="n">PUTËØ∑Ê±Ç</span>	  <span class="o">-&gt;</span><span class="n">Êõ¥Êñ∞Êï∞ÊçÆ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏ãÈù¢Êàë‰ª¨Â∞±ÂÖàÁúãÁúãÂ∫èÂàóÂåñÂô®ÁöÑÊï∞ÊçÆÊ†°È™åÂäüËÉΩ</p>
<h4 id="1131-Âü∫Êú¨Ê†°È™å">11.3.1 Âü∫Êú¨Ê†°È™å
</h4><p>Â∫èÂàóÂåñÂô®‰∏≠ÂÆö‰πâÂ•ΩÂ≠óÊÆµÔºåÂΩìËØ∑Ê±ÇÂà∞ËææÊó∂ÔºåËßÜÂõæÂáΩÊï∞Ëé∑ÂèñÂà∞ËØ∑Ê±ÇÊï∞ÊçÆÔºåÂ∞ÜÊï∞ÊçÆ‰º†ÈÄíÂà∞Â∫èÂàóÂåñÂô®‰∏≠ËøõË°åÊ†°È™åÔºåÂà©Áî®ifËØ≠Âè•ÔºåÂ¶ÇÊûúÊ†°È™åÈÄöËøáÔºåËøîÂõûÊï∞ÊçÆÔºå‰∏çÈÄöËøáÔºåËøîÂõûÈîôËØØ‰ø°ÊÅØ</p>
<p>ËøòÊúâÁ¨¨‰∫åÁßçÂÜôÊ≥ïÔºåÂú®Ê†°È™åÊó∂‰º†ÂÖ•<code>raise_exception=True</code>ÂèÇÊï∞ÔºåÊ†°È™åÈÄöËøáÂàôÁ®ãÂ∫èËá™Âä®Âêë‰∏ãÊâßË°åÔºå‰∏çÈÄöËøáÂàôÊäõÂá∫ÂºÇÂ∏∏ÔºåÁî±APIViewÁ±ªÁöÑdispatchÊñπÊ≥ïÊé•Êî∂ÂºÇÂ∏∏Â§ÑÁêÜ</p>
<p>Âª∫ËÆÆÈááÁî®Á¨¨‰∏ÄÁßçÊñπÂºèÔºåÂõ†‰∏∫ÂèØ‰ª•Ëá™Â∑±ÊéßÂà∂ÂºÇÂ∏∏ÁöÑÂ§ÑÁêÜÔºåÂ¶ÇÊõ¥ÊîπÈîôËØØ‰ø°ÊÅØÁ≠âÔºåËÄåÊñπÂºè‰∫å‰ºöÁî±DRFÂ§ÑÁêÜÔºå‰∏çÂèØÊéß</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Ëé∑ÂèñÂéüÂßãÊï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(request.data)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Ê†°È™å(ÂÜôÊ≥ï‰∏Ä)</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">DepartSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">validated_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Ê†°È™å(ÂÜôÊ≥ï‰∫å)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ser = DepartSerializer(data=request.data)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ser.is_valid(raise_exception=True)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(ser.validated_data)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1132-ÂÜÖÁΩÆÂíåÊ≠£ÂàôÊ†°È™å">11.3.2 ÂÜÖÁΩÆÂíåÊ≠£ÂàôÊ†°È™å
</h4><p>‰∏ä‰∏ÄÂ∞èËäÇÊàë‰ª¨Â≠¶‰π†‰∫ÜÊï∞ÊçÆÊ†°È™åÁöÑÂü∫Êú¨Ê†ºÂºèÔºå‰ΩÜÂØπ‰º†ÈÄíÊù•ÁöÑÊï∞ÊçÆÁöÑÈôêÂà∂‰ªÖ‰ªÖÊòØÈùûÁ©∫ÔºåÂΩìÈúÄÊ±ÇÂ¢ûÂä†Êó∂ÔºåÊàë‰ª¨ÈúÄË¶ÅÂØπÂ≠óÊÆµÊúâÊõ¥‰∏•Ê†ºÁöÑÊéßÂà∂ÔºåÂ∞±ÈúÄË¶ÅÁî®Âà∞Êõ¥Â§öÂ∫èÂàóÂåñÂô®ÂÜÖÁΩÆÁöÑË¶ÅÊ±Ç‰ª•Âèä‰ΩøÁî®Ê≠£ÂàôËá™ÂÆö‰πâÊ†ºÂºèÊ†°È™å</p>
<p>Â¶Ç‰∏ãÔºåtitleÂ≠óÊÆµÂÆö‰πâ‰∫ÜÊúÄÂ§ßÈïøÂ∫¶ÂíåÊúÄÂ∞èÈïøÂ∫¶ÔºåorderÂÆö‰πâ‰∫ÜÊúÄÂ§ßÂÄºÂíåÊúÄÂ∞èÂÄºÔºålevelÂ≠óÊÆµÂàôÊòØÁªôÂá∫‰∫ÜchoicesÔºåÂè™ÂèØÈÄâÊã©1Êàñ2(ËæìÂÖ•Êï¥ÂΩ¢ËøòÊòØÂ≠óÁ¨¶‰∏≤Âπ∂‰∏çÂΩ±Âìç)„ÄÇËøôÂá†‰∏™Ê†°È™åÊòØÂ∫èÂàóÂåñÂô®ÂÜÖÁΩÆÁöÑ</p>
<p>Èô§Ê≠§‰πãÂ§ñÊàë‰ª¨ËøòÂèØ‰ª•Â≠êÂÆö‰πâÊ≠£ÂàôÊ†°È™åÔºå‰ª£Á†Å‰∏≠email1Âíåemail2‰ΩøÁî®ÁöÑÊ≠£ÂàôË°®ËææÂºèÁõ∏ÂêåÔºåÊòØDRFÁªôÊàë‰ª¨Â∞ÅË£ÖÂ•ΩÁöÑÔºåËÄåemail3Â∞±ÊòØÊàë‰ª¨ÈÄöËøáËá™Â∑±ÂÜôÊ≠£ÂàôË°®ËææÂºèÂàõÂª∫ÁöÑËßÑÂàôÔºåÂπ∂‰∏îÂèØ‰ª•ÂÆöÂà∂ÈîôËØØ‰ø°ÊÅØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.core.validators</span> <span class="kn">import</span> <span class="n">RegexValidator</span><span class="p">,</span> <span class="n">EmailValidator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">order</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">level</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">[(</span><span class="s2">&#34;1&#34;</span><span class="p">,</span> <span class="s2">&#34;È´òÁ∫ß&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;‰∏≠Á∫ß&#34;</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># email1 = serializers.EmailField()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># email2 = serializers.CharField(validators=[EmailValidator(message=&#34;ÈÇÆÁÆ±Ê†ºÂºèÈîôËØØ&#34;)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">email3</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">RegexValidator</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&#34;Ê†ºÂºèÈîôËØØ&#34;</span><span class="p">)])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1133-Èí©Â≠êÊ†°È™å">11.3.3 Èí©Â≠êÊ†°È™å
</h4><p>ÂíåDjango‰∏≠ÁöÑFormÂíåModelFormÁ±ª‰ººÔºåDRFÁöÑÂ∫èÂàóÂåñÂô®ÁöÑÊï∞ÊçÆÊ†°È™å‰πüÊèê‰æõ‰∫ÜÊØè‰∏™Â≠óÊÆµÁöÑÈí©Â≠êÊñπÊ≥ïÂíå‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑÈí©Â≠êÊñπÊ≥ï</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">exceptions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">email</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">RegexValidator</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&#34;Ê†ºÂºèÈîôËØØ&#34;</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validate_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&#34;Â≠óÊÆµÈí©Â≠êÊ†°È™åÂ§±Ë¥•&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;validate=&#34;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># api_settings.NON_FIELD_ERRORS_KEY</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># raise exceptions.ValidationError(&#34;ÂÖ®Â±ÄÈí©Â≠êÊ†°È™åÂ§±Ë¥•&#34;)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">attrs</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊØè‰∏™Â≠óÊÆµÁöÑÈí©Â≠êÊñπÊ≥ï‰ª•<code>validate_Â≠óÊÆµÂêç</code>ÂëΩ‰ª§ÔºåËÄåÂÖ®Â±ÄÁöÑÈí©Â≠êÊñπÊ≥ïÁõ¥Êé•ÊòØ<code>validate</code>ÊñπÊ≥ïÔºå‰ªñ‰ºöÂú®ÂêÑ‰∏™Â≠óÊÆµÁöÑÈí©Â≠êÊñπÊ≥ïÊ†°È™åÂÆåÊàêÂêéÂÜçÂØπÊï¥‰ΩìËøõË°åÊ†°È™åÔºåÂõ†Ê≠§‰º†ÂÖ•ÁöÑattrÊòØÊâÄÊúâÂ≠óÊÆµÂíåÂÄºÁªÑÊàêÁöÑÊúâÂ∫èÂ≠óÂÖ∏ÔºåËÄåÂçï‰∏™Â≠óÊÆµÈí©Â≠êÊñπÊ≥ïÁöÑvalueÊòØÂçï‰∏™Â≠óÊÆµÁöÑÂÄº</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241224232824750.png"
	
	
	
	loading="lazy"
	
		alt="image-20241224232824750"
	
	
></p>
<p>ÊÄªÁöÑÈí©Â≠êÊñπÊ≥ïÁöÑÈîôËØØ‰ø°ÊÅØ‰πü‰∏éÂ≠óÊÆµÁöÑÈí©Â≠ê‰∏çÂêå</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241224233043880.png"
	
	
	
	loading="lazy"
	
		alt="image-20241224233043880"
	
	
></p>
<p>ÂÆÉÁöÑÈîôËØØ‰ø°ÊÅØÁöÑÈîÆÈªòËÆ§ÊòØ<code>non_field_errors</code>ÔºåÂèØ‰ª•ÈÄöËøá<code>api_settings.NON_FIELD_ERRORS_KEY</code>ËøõË°åÈÖçÁΩÆÔºåÂ¶ÇÔºö</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241224233734229.png"
	
	
	
	loading="lazy"
	
		alt="image-20241224233734229"
	
	
></p>
<p>Âç≥ÂèØÂÆûÁé∞Ëá™ÂÆö‰πâÈîôËØØ‰ø°ÊÅØÁöÑÈîÆ</p>
<h4 id="1134-modelÊ†°È™å">11.3.4 ModelÊ†°È™å
</h4><p>‰∏äÈù¢Êàë‰ª¨ÂÆûÁé∞Êï∞ÊçÆÊ†°È™å‰∏ÄÁõ¥ÊòØ‰ΩøÁî®SerializerÁ±ªÔºåÊâÄÊúâÁöÑÂ≠óÊÆµÈÉΩÈúÄË¶ÅÊàë‰ª¨Ëá™Â∑±ÁºñÂÜôÔºåÂ¶ÇÊûúÁî®Âà∞ÁöÑÂ≠óÊÆµÂ§ßÂ§öÈÉΩÊòØÂ∞ÜÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂ≠óÊÆµÔºåÈÇ£‰πàÂ∞±ÂèØ‰ª•ÈááÁî®ModelSerializerÊù•Ëá™Âä®ÁîüÊàêÂ≠óÊÆµ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">email3</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">RegexValidator</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&#34;Ê†ºÂºèÈîôËØØ&#34;</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;email3&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;max_length&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;min_length&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;min_value&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;validators&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">RegexValidator</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&#34;Ê†ºÂºèÈîôËØØ&#34;</span><span class="p">)]}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âè™ÈúÄË¶ÅÂú®<code>class Meta</code>ÁöÑ<code>fiedls</code>Â°´ÂÖ•ÈúÄË¶ÅÁîüÊàêÁöÑÂ≠óÊÆµÂç≥ÂèØÔºåËã•ËøòÈúÄË¶ÅËá™ÂÆö‰πâÂ≠óÊÆµÂ∞±ÂÉèSerializerÁ±ª‰∏ÄÊ†∑Ëá™ÂÆö‰πâÔºåÁÑ∂ÂêéÂä†ÂÖ•Âà∞fieldsÂàóË°®‰∏≠Âç≥ÂèØ</p>
<p>ÈááÁî®ËøôÁßçÊñπÂºè‰∏çÈúÄË¶ÅÊàë‰ª¨Ëá™Â∑±ÁºñÂÜôÂ≠óÊÆµÔºåÈÇ£‰πàÊ†°È™åËßÑÂàôÊÄé‰πàÊ∑ªÂä†Âë¢Ôºü</p>
<p>Âè™ÈúÄË¶ÅÂú®<code>class Meta</code>‰∏≠<code>extra_kwargs</code>Â≠óÂÖ∏‰∏≠ÁºñÂÜôÂç≥ÂèØÔºåÁ§∫‰æãÂ¶Ç‰∏ä</p>
<h4 id="1135-‰øùÂ≠òÊï∞ÊçÆ‰πãÊôÆÈÄöÂ≠óÊÆµ">11.3.5 ‰øùÂ≠òÊï∞ÊçÆ‰πãÊôÆÈÄöÂ≠óÊÆµ
</h4><p>Â¶ÇÊûúÈááÁî®ÁöÑÊòØSerializerÁ±ªÁöÑÂ∫èÂàóÂåñÂô®ÔºåÈÇ£‰πàÂú®‰øùÂ≠òÊï∞ÊçÆÊó∂ÈúÄË¶ÅÊâãÂä®ÁöÑËøõË°åORMÊìç‰Ωú‰øùÂ≠òÊï∞ÊçÆÔºå‰ΩÜÂ¶ÇÊûú‰ΩøÁî®‰∫Ü</p>
<p>ModelSerializerÁ±ªÁöÑÂ∫èÂàóÂåñÂô®ÔºåÂ∞±ÂèØ‰ª•‰ΩøÁî®<code>.save</code>ÂÆûÁé∞‰æøÊç∑Êìç‰ΩúÔºå‰ªñ‰ºö‰∏ÄÈîÆ‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÂØπÂ∫îÁöÑË°®‰∏≠</p>
<p>‰ΩÜÊòØÈóÆÈ¢òÊù•‰∫Ü?Â¶ÇÊûúÁî®Êà∑‰º†ÂÖ•ÁöÑÂ≠óÊÆµÊï∞Â§ß‰∫éÊàñÂ∞è‰∫éÊï∞ÊçÆË°®ÂØπÂ∫îÁöÑÂ≠óÊÆµÊï∞ÔºåÊàë‰ª¨ËÉΩ‰∏çËÉΩÊâãÂä®Ë∞ÉÊï¥ÔºüÁ≠îÊ°àÊòØËÇØÂÆöÁöÑ</p>
<p><strong>Â≠óÊÆµËøáÂ§ö</strong>ÔºåÂ¶Ç‰∏ãËø∞‰æãÂ≠êÔºåemail3ÊòØÂ§ö‰ΩôÂ≠óÊÆµÔºå‰∏çÈúÄË¶ÅÂ≠òÂÖ•Êï∞ÊçÆÂ∫ìÔºåÊàë‰ª¨ÂèØ‰ª•Âú®ËøõË°å<code>.save</code>‰πãÂâçÂ∞ÜÂÖ∂<code>pop</code>ÊéâÔºåÁî®‰∏Ä‰∏™ÂèòÈáèÊé•Êî∂ÔºåÂèØÁî®‰∫éÂêéÁª≠Âà§Êñ≠„ÄÇËØ•Êìç‰ΩúÂèØÁî®‰∫éÊ≥®ÂÜåÊó∂ÁöÑÈáçÂ§çËæìÂÖ•ÂØÜÁ†ÅÊ≠•È™§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">email3</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">RegexValidator</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&#34;Ê†ºÂºèÈîôËØØ&#34;</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;email3&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;max_length&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;min_length&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;min_value&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;validators&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">RegexValidator</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;\d+&#34;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&#34;Ê†ºÂºèÈîôËØØ&#34;</span><span class="p">)]}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">DepartModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ËßÜÂõæ&#34;</span><span class="p">,</span> <span class="n">ser</span><span class="o">.</span><span class="n">validated_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">email3</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">validated_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;email3&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Â≠óÊÆµËøáÂ∞ë</strong>ÔºåÊØîÂ¶ÇÂàõÂª∫Áî®Êà∑Êó∂Êï∞ÊçÆÂ∫ì‰∏≠Ë¶ÅÊ∑ªÂä†Êìç‰Ωú‰∫∫idÔºåËøôÊòæÁÑ∂‰∏çÊòØÁî®Êà∑ËæìÂÖ•ÁöÑÔºåÊâÄ‰ª•Êàë‰ª¨Â∞±ÈúÄË¶ÅÊâãÂä®Ê∑ªÂä†Êï∞ÊçÆ</p>
<p>‰∏ãÂàó‰ª£Á†Å‰∏≠Êï∞ÊçÆÂ∫ìÊúâcountÂ≠óÊÆµÔºå‰ΩÜÂâçÁ´ØÁî®Êà∑Âπ∂Êú™ËæìÂÖ•ÔºåÂõ†Ê≠§‰æøÂèØ‰ª•Âú®<code>.save</code>Êó∂Â∞ÜcountÂ≠óÊÆµ‰Ωú‰∏∫ÂèÇÊï∞‰º†ÂÖ•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;max_length&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;min_length&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;min_value&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DepartView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">DepartModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ËßÜÂõæ&#34;</span><span class="p">,</span> <span class="n">ser</span><span class="o">.</span><span class="n">validated_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1136-‰øùÂ≠òÊï∞ÊçÆ‰πãfkÂíåm2mÂ≠óÊÆµ">11.3.6 ‰øùÂ≠òÊï∞ÊçÆ‰πãFKÂíåM2MÂ≠óÊÆµ
</h4><p>‰∏ä‰∏ÄÂ∞èËäÇÊàë‰ª¨‰ªãÁªç‰∫ÜÊôÆÈÄöÂ≠óÊÆµÁöÑ‰øùÂ≠òÔºå‰ΩÜÊòØËøòÊúâ‰∏§ÁßçÊØîËæÉÁâπÊÆäÁöÑÂ≠óÊÆµÔºåÂ¶ÇÊûúÊòØForeignKeyÂ≠óÊÆµÂíåManytoManyÂ≠óÊÆµÔºåËØ•ÊÄé‰πàËøõË°å‰øùÂ≠ò</p>
<p>Êàë‰ª¨ÂÖàÁúãFK</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241225104844380.png"
	
	
	
	loading="lazy"
	
		alt="image-20241225104844380"
	
	
></p>
<p>Â¶ÇÂõæÔºådepartÊòØ‰∏Ä‰∏™FKÔºåÂÖ≥ËÅîÂà∞ËÅå‰ΩçË°®ÔºåÁî®Êà∑Âú®ËæìÂÖ•Êó∂ÂÆûÈôÖ‰∏äËæìÂÖ•ÁöÑÊòØËÅå‰ΩçÁöÑidÔºåÂ¶ÇÊûúid‰∏çÂ≠òÂú®Â∞±‰ºöÊä•Èîô„ÄÇÂ¶ÇÊûúÈúÄÊ±ÇÂçáÁ∫ßÔºåÂ∞±ÁÆóËØ•ËÅå‰ΩçÂ≠òÂú®ÔºåËøòË¶ÅÂÅöËøõ‰∏ÄÊ≠•Ê†°È™åÔºåÂ∞±ÈúÄË¶ÅÊàë‰ª¨ÁöÑÈí©Â≠êÊñπÊ≥ïÔºåÂú®Èí©Â≠ê‰∏≠ÔºåvalueÂÄºÂÖ∂ÂÆûÂ∑≤ÁªèÊòØÁî®Êà∑‰º†ÂÖ•ÁöÑidÂØπÂ∫îÁöÑdepartÂØπË±°‰∫ÜÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÂØπÂØπË±°ËøõË°åÊìç‰Ωú„ÄÅÊ†°È™å</p>
<p>ÁÑ∂ÂêéÊàë‰ª¨Êù•ÁúãM2MÁöÑÊÉÖÂÜµ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241225110343348.png"
	
	
	
	loading="lazy"
	
		alt="image-20241225110343348"
	
	
></p>
<p>tagsÊòØ‰∏Ä‰∏™M2MÔºåÂÖ≥ËÅîuserinfoÂíåtagsË°®ÔºåÁî®Êà∑‰º†ÂÖ•‰∏Ä‰∏™ÂàóË°®Ôºå1Âíå2ÂØπÂ∫îtagsË°®ÁöÑidÔºåË°®Á§∫ÂΩìÂâçÂàõÂª∫Áî®Êà∑‰∏éid=1Âíåid=2ÁöÑÊ†áÁ≠æÈÉΩÊúâÂÖ≥ËÅîÔºå‰∫éÊòØÂú®userinfo_tagsË°®‰∏≠ÁîüÊàê‰∏§Êù°ËÆ∞ÂΩï</p>
<p>Ê≠§Êó∂ÔºåÈí©Â≠êÊñπÊ≥ï‰∏≠ÁöÑvalueÊòØ‰∏Ä‰∏™ÂàóË°®ÔºåÊØè‰∏Ä‰∏™ÂÖÉÁ¥†ÈÉΩÊòØ‰º†ÂÖ•ÁöÑidÂØπÂ∫îÁöÑtagsÂØπË±°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UsModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;depart&#39;</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">USView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">UsModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ËßÜÂõæ&#34;</span><span class="p">,</span> <span class="n">ser</span><span class="o">.</span><span class="n">validated_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®FKÁöÑÈÇ£‰∏™Á§∫‰æã‰∏≠ÔºåÂ≠óÊÆµÂêç‰∏∫departÔºå‰ΩÜÊàë‰ª¨‰º†ÂÖ•ÁöÑÂÆûÈôÖ‰∏äÊòØdepart_idÔºåÈÇ£‰πàÂ¶ÇÊûúÁõ¥Êé•Âú®fields‰∏≠ÂÜôdepart_idËÄå‰∏çÊòØdepart‰ºöÂèëÁîü‰ªÄ‰πàÂë¢?</p>
<p>ModelSerializerÂú®Â§ÑÁêÜÊï∞ÊçÆÂ∫ìÂ≠óÊÆµÊó∂ÂÖ∂ÂÆûÂπ∂Ê≤°Êúâdepart_idËøô‰∏™Â≠óÊÆµÔºå‰ªñÂè™Êúâ‰∏Ä‰∏™FKÂ≠óÊÆµÂè´departÔºåÊâÄ‰ª•‰ªñ‰ºöÊä•ÈîôÔºå‰ΩÜÊòØÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáËá™ÂÆö‰πâÁöÑÊñπÂºèÂ∞±ÂèØ‰ª•ÂÆûÁé∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UsModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">depart_id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;depart_id&#39;</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®M2MÂ≠óÊÆµ‰∏≠ÔºåÁî®Êà∑ËæìÂÖ•ÁöÑÊòØÂ≠òÊîætagsÂØπË±°ÁöÑidÂàóË°®ÔºåËÄåÂà∞ËææÈí©Â≠êÊñπÊ≥ïÊòØÂ≠òÊîætagsÂØπË±°ÁöÑÂàóË°®ÔºåÈÇ£‰πàÊàë‰ª¨ËÉΩ‰∏çËÉΩËá™ÂÆö‰πâÔºåËÆ©‰ªñ‰º†ÂÖ•Èí©Â≠êÊó∂Â∞±ÊòØÁî®Êà∑ËæìÂÖ•ÁöÑÂ≠òÊîætagsÂØπË±°ÁöÑidÂàóË°®ÔºåÁÑ∂ÂêéÂèØ‰ª•Ëøõ‰∏ÄÊ≠•ÂÅöÊìç‰ΩúÔºåÊúÄÂêéËøîÂõûÁöÑËøòÊòØÂ≠òÊîætagsÂØπË±°ÁöÑÂàóË°®Ôºå‰Ωø‰øùÂ≠òÊï∞ÊçÆÁöÑÂäüËÉΩ‰∏çÂèóÂΩ±Âìç</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UsModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">tags</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ListField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;depart&#39;</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validated_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">queryset</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">USView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">UsModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ËßÜÂõæ&#34;</span><span class="p">,</span> <span class="n">ser</span><span class="o">.</span><span class="n">validated_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&#34;...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1137-Êï∞ÊçÆÊ†°È™åÊÄªÁªì">11.3.7 Êï∞ÊçÆÊ†°È™åÊÄªÁªì
</h4><ol>
<li>Ëá™ÂÆö‰πâ Serializer + Â≠óÊÆµ</li>
<li>Ëá™ÂÆö‰πâ Serializer + Â≠óÊÆµÔºàÂÜÖÁΩÆÂä†Ê≠£ÂàôÔºâ</li>
<li>Ëá™ÂÆö‰πâ Serializer + Â≠óÊÆµÔºàÂÜÖÁΩÆÂä†Ê≠£ÂàôÔºâ+ Â≠óÊÆµÈí©Â≠ê + ÂÖ®Â±ÄÈí©Â≠ê</li>
<li>Ëá™ÂÆö‰πâ ModelSerializer + Ëá™ÂÆö‰πâÂ≠óÊÆµ + extra_kwargs + save‰øùÂ≠òÊï∞ÊçÆÔºàÂ≠óÊÆµÂ§öÔºöpopÔºõÂ≠óÊÆµÂ∞ëÔºöÂèÇÊï∞‰º†ÂÖ•Ôºâ</li>
<li>Ëá™ÂÆö‰πâ ModelSerializer + FK      -&gt;     Ëá™Âä®Ëé∑ÂèñÂÖ≥ËÅîÊï∞ÊçÆ depart    -&gt;     Ëá™ÂÆö‰πâdepart_idÂ≠óÊÆµ</li>
<li>Ëá™ÂÆö‰πâ ModelSerializer + M2M   -&gt;     Ëé∑ÂèñÂÖ≥ËÅîÊï∞ÊçÆ                      -&gt;      ListFieldÊàñDictField  +  Èí©Â≠ê</li>
</ol>
<h4 id="1138-Ê†°È™åÂíåÂ∫èÂàóÂåñ‰∫åÂêà‰∏Ä">11.3.8 Ê†°È™åÂíåÂ∫èÂàóÂåñ‰∫åÂêà‰∏Ä
</h4><p>Â∫èÂàóÂåñ‰∏éÊï∞ÊçÆÊ†°È™åÁªìÂêà</p>
<p>ÂàõÂª∫Áî®Êà∑ : {&ldquo;user&rdquo;:&ldquo;xxx&rdquo;,&ldquo;password&rdquo;:&ldquo;xxx&rdquo;}</p>
<ul>
<li>Êï∞ÊçÆÊ†°È™å</li>
<li>ËøûÊé•Êï∞ÊçÆÂ∫ìÔºå‰øùÂ≠òÊï∞ÊçÆÔºåÂπ∂ËøîÂõûÊï∞ÊçÆÂ∫ìÂØπË±°
<ul>
<li>‰∏∫‰ªÄ‰πà‰∏çÁõ¥Êé•ËøîÂõûÂàõÂª∫Áî®Êà∑Êó∂‰º†ÈÄíÁöÑ {&ldquo;user&rdquo;:&ldquo;xxx&rdquo;,&ldquo;password&rdquo;:&ldquo;xxx&rdquo;}</li>
<li>Âõ†‰∏∫Êï∞ÊçÆÂ∫ìÊúâ‰∫õÂ≠óÊÆµÊó∂Ëá™Âä®ÁîüÊàêÁöÑÔºåÂè™ÊúâËøîÂõûÊï∞ÊçÆÂ∫ìÂØπË±°ÊâçËÉΩ‰øùËØÅÊï∞ÊçÆÁöÑÂÆåÊï¥</li>
</ul>
</li>
<li>Â∞ÜÊï∞ÊçÆÂ∫ìÂØπË±°Â∫èÂàóÂåñÂÜçËøîÂõû</li>
</ul>
<h5 id="11381-‰∏§‰∏™Â∫èÂàóÂåñÂô®ÂàÜÂà´ÂÆûÁé∞">11.3.8.1 ‰∏§‰∏™Â∫èÂàóÂåñÂô®ÂàÜÂà´ÂÆûÁé∞
</h5><p>Êàë‰ª¨Âú®Êï∞ÊçÆÊ†°È™åÂºÄÂ§¥ÈÉ®ÂàÜÂ∞±ÊèêÂá∫ËøáËøôÁßçÈúÄÊ±ÇÔºåÂΩìÊï∞ÊçÆÊ†°È™åÈÄöËøáÂ≠òÂÖ•Êï∞ÊçÆÂ∫ìÔºåËøòÈúÄÂ∞ÜÂàõÂª∫ÁöÑÊï∞ÊçÆÂ∫ìÂØπË±°ÁªèËøáÂ∫èÂàóÂåñËøîÂõûÂõûÂéªÔºåÁé∞Âú®Êàë‰ª¨Â∞±Êù•ÁúãÁúãËøô‰∏™ÂÆûÁé∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DpModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="s2">&#34;__all__&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Dp2ModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;title&#34;</span><span class="p">,</span> <span class="s2">&#34;count&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DpView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">DpModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">instance</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">xx</span> <span class="o">=</span> <span class="n">Dp2ModelSerializer</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äËø∞‰ª£Á†ÅÂú®Êï∞ÊçÆÊ†°È™åÊó∂‰ΩøÁî®DpModelSerializerÔºåÊ†°È™åÈÄöËøá‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÔºå<code>ser.save()</code>‰ºöËøîÂõûÂ≠òÂÖ•Êï∞ÊçÆÂ∫ìÁöÑÂØπË±°ÔºåÁî®instanceÊé•Êî∂ÔºåÂÜç</p>
<p>‰º†ÈÄíÁªôÂÆåÊàêÂ∫èÂàóÂåñÂäüËÉΩÁöÑDp2ModelSerializerÔºåÂÆûÁé∞ÈúÄÊ±Ç</p>
<h5 id="11382-‰∏Ä‰∏™Â∫èÂàóÂåñÂô®ÂÆûÁé∞">11.3.8.2 ‰∏Ä‰∏™Â∫èÂàóÂåñÂô®ÂÆûÁé∞
</h5><p>ËøôÊ†∑ÂàÜÂºÄÂÜô‰∏§‰∏™Â∫èÂàóÂåñÂô®ÊÑüËßâÊúâÁÇπÁπÅÊùÇÔºåÂèØ‰ª•‰ΩøÁî®‰∏Ä‰∏™ÂêóÔºüÁ≠îÊ°àÊòØÂèØ‰ª•ÁöÑÔºå‰ΩÜÊòØËøîÂõûÂ∫èÂàóÂåñÊó∂ËøîÂõûÁªôÁî®Êà∑ÁöÑ‰πüÊòØÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÊâÄÊúâÂ≠óÊÆµÔºåÂõ†‰∏∫<code>fields = &quot;__all__&quot;</code></p>
<p>ÂèØ‰ª•Âè™‰ΩøÁî®‰∏Ä‰∏™Â∫èÂàóÂåñÂô®ÔºåÂÆûÁé∞Êï∞ÊçÆÊ†°È™å‰øùÂ≠òÊï∞ÊçÆÊó∂Ê†°È™å‰øùÂ≠òÊâÄÊúâÂ≠óÊÆµÔºå‰ΩÜÊòØÂ∫èÂàóÂåñËøîÂõûÊó∂Âè™ËøîÂõû‰∏â‰∏™Â≠óÊÆµÂêóÔºüËøôÊó∂ÂÄôÂ∞±Ë¶ÅÁî®Âà∞Â≠óÊÆµÁöÑ‰∏§‰∏™ÁâπÊÆäÂèÇÊï∞<code>read_only</code>Âíå<code>write_only</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DpModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;title&#34;</span><span class="p">,</span> <span class="s2">&#34;order&#34;</span><span class="p">,</span> <span class="s2">&#34;count&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;count&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;write_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äËø∞‰ª£Á†ÅÂÆûÁé∞Âú®ËæìÂÖ•Êó∂Âè™ÈúÄË¶ÅËæìÂÖ•title„ÄÅorder„ÄÅcount‰∏â‰∏™Â≠óÊÆµÔºåÂú®ËøîÂõûÁªôÁî®Êà∑Êó∂Âè™ËøîÂõûid„ÄÅtitle„ÄÅorder‰∏â‰∏™Â≠óÊÆµ„ÄÇÂÆåÊàêÂÖ±Áî®‰∏Ä‰∏™Â∫èÂàóÂåñÂô®ÂÆûÁé∞Êï∞ÊçÆÊ†°È™å‰øùÂ≠òÂíåÊï∞ÊçÆÂ∫èÂàóÂåñÂ≠óÊÆµÁöÑÁÅµÊ¥ªËá™ÂÆö‰πâ„ÄÇÂèØ‰ª•Â∫îÁî®Âú®Áî®Êà∑Ê≥®ÂÜåÊó∂ÔºåÂú®Ê≥®ÂÜåÊó∂ÈúÄË¶ÅÁî®Êà∑ËæìÂÖ•ÂØÜÁ†ÅÔºå‰ΩÜÊòØËøîÂõûÊï∞ÊçÆÂ±ïÁ§∫Êó∂‰∏ç‰ºöÂ∞ÜÂØÜÁ†ÅËøîÂõû</p>
<p>‰∏äÈù¢Êàë‰ª¨Â∑≤ÁªèÂÆûÁé∞‰∫ÜÊéßÂà∂Âì™‰∫õÂ≠óÊÆµËøîÂõûÔºå‰ΩÜÊòØËøîÂõûÁöÑÊ†ºÂºèËøòÈúÄË¶ÅËøõ‰∏ÄÊ≠•Êìç‰Ωú„ÄÇ‰æãÂ¶ÇÂØπ‰∫é‰∏Ä‰∏™choicesÁöÑgenderÂ≠óÊÆµÔºåËøîÂõûÊó∂ÊòØËøîÂõûÊï∞ÊçÆ‰∏≠ÁúüÂÆûÂ≠òÂÇ®ÁöÑ1Êàñ2ÂêóÔºåÊòæÁÑ∂‰∏çÊòØÔºåËÄåÂ∫îËØ•ÊòØÂØπÂ∫îÁöÑÁî∑ÂíåÂ•≥„ÄÇÂêåÊ†∑ÁöÑËøòÊúâFKÂ≠óÊÆµdepartÔºåÊàë‰ª¨Â∫îËØ•ÂçïÂçïËøîÂõû‰∏Ä‰∏™depart_idÂêóÔºüÊòæÁÑ∂‰πü‰∏çÊòØÔºåËÄåÊòØÂ∫îËØ•Â∞ÜÂÖ∂depart_titleÊàñÂÖ∂‰ªñ‰ø°ÊÅØËøîÂõûÔºåËøôÂ∫îËØ•ÊÄé‰πàÂÆûÁé∞Âë¢Ôºü</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241225204254510.png"
	
	
	
	loading="lazy"
	
		alt="image-20241225204254510"
	
	
></p>
<ul>
<li>choicesÂ≠óÊÆµ</li>
</ul>
<p>ÊñπÂºè‰∏ÄÔºöËá™ÂÆö‰πâ‰∏Ä‰∏™gender_infoÂ≠óÊÆµËé∑ÂèñÁî∑ÊàñÂ•≥ÁöÑÊñáÂ≠ó‰ø°ÊÅØÔºåÁÑ∂ÂêéÂ∞Ügender_infoÂíågenderÂ≠óÊÆµÂàÜÂà´ËÆæÁΩÆread_onlyÂíåwrite_only</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UusModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">gender_info</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;get_gender_display&#34;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="s2">&#34;gender&#34;</span><span class="p">,</span> <span class="s2">&#34;depart&#34;</span><span class="p">,</span> <span class="s2">&#34;gender_info&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;gender&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;write_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊñπÂºè‰∫åÔºöËá™ÂÆö‰πâ‰∏Ä‰∏™ÊñπÊ≥ïÂ≠óÊÆµÔºàËá™Â∏¶read_onlyÔºâÔºåËøîÂõû‰∏Ä‰∏™Â≠óÂÖ∏ÔºåÂåÖÂê´Â§ö‰∏™‰ø°ÊÅØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UusModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">SerializerMethodField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="s2">&#34;gender&#34;</span><span class="p">,</span> <span class="s2">&#34;depart&#34;</span><span class="p">,</span> <span class="s2">&#34;v1&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;gender&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;write_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span> <span class="s2">&#34;text&#34;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_gender_display</span><span class="p">()}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/post%5cpython%5cDRF%5cimage-20241225205712042.png"
	
	
	
	loading="lazy"
	
		alt="image-20241225205712042"
	
	
></p>
<ul>
<li>FKÂ≠óÊÆµ</li>
</ul>
<p>ÊñπÂºè‰∏ÄÔºöËá™ÂÆö‰πâÂ≠óÊÆµÂä†read_onlyÔºåÊåáÂÆösourceÂÖ≥ËÅîÂ§ñÈîÆÊï∞ÊçÆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UusModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;depart.title&#34;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="s2">&#34;gender&#34;</span><span class="p">,</span> <span class="s2">&#34;depart&#34;</span><span class="p">,</span> <span class="s2">&#34;v1&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;depart&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;write_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊñπÂºè‰∫åÔºöÂà©Áî®Â∫èÂàóÂåñÂô®ÁöÑÂµåÂ•ó</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">P1ModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Depart</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="s2">&#34;__all__&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UusModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="n">P1ModelSerializer</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&#34;depart&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="s2">&#34;gender&#34;</span><span class="p">,</span> <span class="s2">&#34;depart&#34;</span><span class="p">,</span> <span class="s2">&#34;v1&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;depart&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;write_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/post%5cpython%5cDRF%5cimage-20241225210517195.png"
	
	
	
	loading="lazy"
	
		alt="image-20241225210517195"
	
	
></p>
<p>Â¶ÇÊûúÊòØ‰∫åÂêà‰∏ÄÁöÑÂΩ¢ÂºèÔºåËßÜÂõæÂáΩÊï∞‰∏≠ÂèØ‰ª•Ëøõ‰∏ÄÊ≠•Áº©ÂÜô</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UusView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">UusModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏çÈúÄË¶ÅÈáçÂ§çÊåáÂÆöÊï∞ÊçÆÊ†°È™åÂíåÂ∫èÂàóÂåñÊï∞ÊçÆÁöÑÂ∫èÂàóÂåñÂô®ÔºåÂè™ÈúÄÂ¶Ç‰∏äÁºñÂÜôÂç≥ÂèØÂÆûÁé∞ÂêåÊ†∑ÁöÑÂäüËÉΩ</p>
<h4 id="1139-ÊãìÂ±ï">11.3.9 ÊãìÂ±ï
</h4><p>Áé∞Âú®Êúâ‰∏Ä‰∏™ÈúÄÊ±ÇÔºåË¶ÅÊ±ÇÁºñÂÜô‰∏Ä‰∏™Â∫èÂàóÂåñÁ±ªÔºåÂÆûÁé∞ÂàõÂª∫Áî®Êà∑</p>
<p>Êèê‰æõÔºö{&ldquo;name&rdquo;:&ldquo;xsss&rdquo;,&ldquo;age&rdquo;:&ldquo;11&rdquo;,&ldquo;gender&rdquo;:1}</p>
<p>ËøîÂõûÔºö{&ldquo;id&rdquo;=1,&ldquo;name&rdquo;:&ldquo;xsss&rdquo;,&ldquo;gender&rdquo;:&ldquo;Áî∑&rdquo;}</p>
<p>modelÁ±ªÂ¶Ç‰∏ã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbUserInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂßìÂêç&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Âπ¥ÈæÑ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">gender</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÊÄßÂà´&#34;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;Áî∑&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;Â•≥&#34;</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨‰∏äÈù¢Â≠¶‰π†ÁöÑÂØπchoicesÁöÑÂ§ÑÁêÜÔºåÈÉΩÊòØË¶ÅÊñ∞ÂÆö‰πâ‰∏Ä‰∏™Â≠óÊÆµÊù•Â±ïÁ§∫Áî∑/Â•≥Ôºå‰ΩÜÈúÄÊ±Ç‰∏≠‰∏çÁÆ°ÊòØÊèê‰æõÁöÑÂ≠óÊÆµËøòÊòØËøîÂõûÁöÑÂ≠óÊÆµÈÉΩÂè´genderÔºåÊòæÁÑ∂‰∏çÊòØÊàë‰ª¨ÂéüÂÖàÂ≠¶‰π†ÁöÑÊñπÊ≥ïÂèØ‰ª•ÂÆûÁé∞ÁöÑ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20241226161015680.png"
	
	
	
	loading="lazy"
	
		alt="image-20241226161015680"
	
	
></p>
<p>ÈáçÁÇπÂ∞±ÊòØË¶ÅÂ∞ÜËøîÂõûÁöÑgenderËÆæÁΩÆ‰∏∫Áî∑/Â•≥</p>
<p>Â¶ÇÊûúÊàë‰ª¨Ëá™ÂÆö‰πâ‰∏Ä‰∏™Âêç‰∏∫genderÁöÑSerializerMethodFieldÂ≠óÊÆµÔºåÁÑ∂ÂêéÂú®ÈáåÈù¢ÂéªË∞ÉÁî®get_gender_displayÔºåËæìÂá∫ÊòØÁ¨¶ÂêàË¶ÅÊ±Ç‰∫ÜÔºå‰ΩÜÊòØSerializerMethodFieldÂ≠óÊÆµÈªòËÆ§ÊòØread_onlyÔºå‰ºöÂØºËá¥‰º†ËøáÊù•ÁöÑgenderÂ§±ÊïàÔºåÂç≥Áî®Êà∑Êó†Ê≥ïËæìÂÖ•‰∫Ü</p>
<p>Â¶ÇÊûúÂÆö‰πâÊàêÂÖ∂‰ªñÁ±ªÂûãÁöÑÂ≠óÊÆµÔºåÊ≤°Êúâread_onlyÔºåÁî®Êà∑ÂèØ‰ª•ËæìÂÖ•‰∫ÜÔºå‰ΩÜÊòØget_genderÁöÑÈí©Â≠êÂèà‰∏çÊâßË°å‰∫ÜÔºåÂØºËá¥ËæìÂá∫ËøòÊòØ1/2</p>
<p>ÂèØ‰ª•ÂèëÁé∞Ôºå‰∏äÈù¢‰∏§ÁßçÂÆûÁé∞ÈÉΩÂè™ÂÆûÁé∞‰∫Ü‰∏ÄÂçäÂäüËÉΩÔºåÈÇ£Ê≤°ÊúâÂèØËÉΩÂ∞Ü‰ªñ‰ª¨ÁªÑÂêàËµ∑Êù•Âë¢Ôºü</p>
<p>ËøôÂ∞±ÈúÄË¶ÅÊàë‰ª¨‰∫ÜËß£SerializerMethodFieldÂ≠óÊÆµÂà∞Â∫ïÊòØÂ¶Ç‰ΩïÂÆûÁé∞Èí©Â≠êÁöÑÔºü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span> <span class="o">=</span> <span class="n">NbModelSerializer</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">ÂØπË±°</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span><span class="o">.</span><span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êï∞ÊçÆÊ†°È™å+Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl"><span class="n">ser</span> <span class="o">=</span> <span class="n">NbModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">ser</span><span class="o">.</span><span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÖ≥ÈîÆÂ∞±ÊòØser.data</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁúüÊ≠£ÁöÑÂ∫èÂàóÂåñÂä®‰ΩúÂèëÁîüÂú®ser.dataËß¶ÂèëÊó∂</p>
<p>SerializerMethodFieldÂ≠óÊÆµ‰∏éÂÖ∂‰ªñÂ≠óÊÆµÁöÑ‰∏çÂêåÂú®‰∫éÔºö</p>
<ul>
<li>Á±ªÂèòÈáèÁª¥Êä§‰∫Ü‰∏Ä‰∏™method_nameÈªòËÆ§Á≠â‰∫éNone</li>
<li>Âú®ÂÆû‰æãÂåñÂâçÊâßË°åbindÊñπÊ≥ïmethod_nameËµãÂÄº‰∏∫&rsquo;get_{field_name}'</li>
<li>ÊúÄÂêéË∞ÉÁî®to_representationÊñπÊ≥ïÂ§ÑÁêÜÂÄºÊó∂‰ºöÊâæÂà∞Áà∂Á±ªÁöÑget_{field_name}ÔºåËøîÂõûÈí©Â≠êÊñπÊ≥ïÁöÑËøîÂõûÂÄº</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseSerializer</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Serializer</span><span class="p">(</span><span class="n">BaseSerializer</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">SerializerMetaclass</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ReturnDict</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_readable_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">write_only</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">yield</span> <span class="n">field</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># [CharFieldÂ≠óÊÆµÂØπË±°ÔºåSerializerMethodFieldÂ≠óÊÆµÂØπË±°(ÊØîÂÖ∂‰ªñÊôÆÈÄöÂ≠óÊÆµÂ§öÁª¥Êä§‰∫Ü‰∏Ä‰∏™method_name)...]  ÊúâbindÊñπÊ≥ï‰ºöÂÖàÊâßË°åËøá</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readable_fields</span>  <span class="c1"># ÊâæÂà∞ÊâÄÊúâÂ≠óÊÆµÔºåÁ≠õÈÄâÂá∫ÂèØËØªÁöÑÔºàÂèØÂ∫èÂàóÂåñÁöÑÔºâ ==&gt; Ê≤°ÊúâÂÜôwrite_only</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">attribute</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># CharField.get_attribute(instance) ==&gt; instance.Â≠óÊÆµ.Â≠óÊÆµ (ÈÄöËøáÂæ™ÁéØsourceÂàóË°®)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># SerializerMethodField.get_attribute(instance) ==&gt; instance.xx ==&gt; None (SerializerMethodFieldÁöÑsourceÈªòËÆ§‰∏∫*)</span>
</span></span><span class="line"><span class="cl">            <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># CharField.to_representation Â∞±ÊòØÁî®str()ÂåÖË£π‰∏Ä‰∏ã</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># SerializerMethodField.to_representation Ê†πÊçÆmethod_nameÂéªÁà∂Á±ªÊãøÈí©Â≠êÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SerializerMethodField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="n">method_name</span>
</span></span><span class="line"><span class="cl">        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;read_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># The method name defaults to `get_{field_name}`.</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="s1">&#39;get_</span><span class="si">{field_name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">field_name</span><span class="o">=</span><span class="n">field_name</span><span class="p">)</span>  <span class="c1"># method_nameÈªòËÆ§‰∏∫NoneÔºåÂà∞Ê≠§Â§ÑÂ§ÑÁêÜ‰∏∫&#34;get_gender&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">gender</span> <span class="o">=</span> <span class="n">seriallizer</span><span class="o">.</span><span class="n">SerializerMethodField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">NbUserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="s2">&#34;gender&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_gender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_gender_display</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊòéÁôΩ‰∫ÜÂÆÉÊòØÂ¶Ç‰ΩïÂÆûÁé∞Èí©Â≠êÊñπÊ≥ï‰πãÂêéÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•Â∞ÜÂéüÂÖàÁöÑ‰∏§ÁßçÊñπÂºèËøõË°åÁªìÂêàÔºåÂÖ≥ÈîÆÂ∞±Âú®‰∫éÂØπ‰∏ãÈù¢‰∏§Êù°ËØ≠Âè•ÁöÑÊãìÂ±ïÔºåÂõ†‰∏∫‰ªñ‰ª¨ÂÜ≥ÂÆö‰∫ÜÂ≠óÊÆµÁöÑÂÆûÈôÖÂÄº</p>
<ul>
<li><code>attribute = field.get_attribute(instance)</code></li>
<li><code>ret[field.field_name] = field.to_representation(attribute)</code></li>
</ul>
<h5 id="11391-ÊñπÊ≥ï‰∏Ä">11.3.9.1 ÊñπÊ≥ï‰∏Ä
</h5><p>Êàë‰ª¨ÈÄöËøáËá™ÂÆö‰πâ‰∏Ä‰∏™NbCharFieldÂ≠óÊÆµÔºåÊ®°‰ªøSerializerMethodFieldÁª¥Êä§‰∏Ä‰∏™method_nameÔºåÂπ∂‰∏îÊâæÊó∂Êú∫ËÆ©‰ªñÊ†πÊçÆÂèçÂ∞ÑÊâæÂà∞Èí©Â≠êÂπ∂ÊâßË°åÂç≥ÂèØ</p>
<p>‰∏ãÂàóÂÆûÁé∞Âú®<code>__init__</code>Âíå<code>__bind__</code>‰∏≠Áª¥Êä§‰∏Ä‰∏™Èí©Â≠êÊñπÊ≥ïÔºåÂêç‰∏∫<code>xget_Â≠óÊÆµÂêç</code>ÔºåÁÑ∂ÂêéÂú®ÊâßË°åget_attributeÊó∂ËÆ©‰ªñÊâßË°åÈí©Â≠êÔºåÂ∞Ü1/2Âèò‰∏∫Áî∑/Â•≥ÔºåÂõ†‰∏∫Êàë‰ª¨ÁªßÊâøÁöÑÊòØIntegerFieldÔºåÂÆÉÁöÑto_representationÊñπÊ≥ïÂ∫îËØ•ÊòØÁî®int()ÂåÖË£πattributeÔºåËÄåÊàë‰ª¨ÁöÑattribute‰∏çÊòØÊï∞Â≠óÂ≠óÁ¨¶‰∏≤ÔºåÂõ†Ê≠§to_representation‰πüÈúÄË¶ÅÈáçÂÜôÔºåÂê¶ÂàôÂº∫Âä†int()‰ºöÊä•ÈîôÔºåËá≥Ê≠§Â∞±ÂÆåÊàê‰∫ÜÂäüËÉΩÂÆûÁé∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbCharField</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="n">method_name</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="s1">&#39;xget_</span><span class="si">{field_name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="n">field_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">gender</span> <span class="o">=</span> <span class="n">NbCharField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">NbUserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="s2">&#34;gender&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">xget_gender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_gender_display</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">NbModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÁúãÂà∞ÔºåÈÄöËøáËá™ÂÆö‰πâ‰∏Ä‰∏™Â≠óÊÆµÁöÑÊñπÂºèËøòÊòØÊØîËæÉÁπÅÁêêÁöÑ</p>
<h5 id="11392-ÊñπÊ≥ï‰∫å">11.3.9.2 ÊñπÊ≥ï‰∫å
</h5><p>ÊñπÊ≥ï‰∏ÄÁöÑÊú¨Ë¥®ÊòØÊîπÂèòÂ≠óÊÆµÁöÑ<code>get_attribute</code>Âíå<code>to_representation</code>ÊñπÊ≥ïÊù•ÊîπÂèòËé∑ÂèñÂ≠óÊÆµÁöÑÂÄºÔºåËÄåËøô‰∏§‰∏™ÊñπÊ≥ïÈÉΩÂÆö‰πâSerializerÁ±ªÁöÑ<code>to_representation</code>ÊñπÊ≥ï‰∏≠ÔºåÈÇ£‰πàÊàë‰ª¨‰Ωï‰∏çÁõ¥Êé•ÈáçÂÜô‰∏Ä‰∏™<code>to_representation</code>ÊñπÊ≥ïÔºå‰ΩøÂæóÂΩìÂ≠óÊÆµÂ≠òÂú®Âêç‰∏∫nb_Â≠óÊÆµÂêçÁöÑÈí©Â≠êÊñπÊ≥ïÊó∂ÔºåËµ∞Êàë‰ª¨Ëá™Â∑±ÁöÑËé∑ÂèñÊï∞ÊçÆÊµÅÁ®ãÔºåËÄåÊ≤°ÊúâÂêç‰∏∫<code>nb_Â≠óÊÆµÂêç</code>ÁöÑÈí©Â≠êÊñπÊ≥ïÊó∂ÔºåÂ∞±ÊåâÂéüÊú¨ÁöÑÈÄªËæëËµ∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">NbUserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="s2">&#34;gender&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readable_fields</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nb_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&#34;nb_</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">)(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">attribute</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">except</span> <span class="n">SkipField</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">check_for_none</span> <span class="o">=</span> <span class="n">attribute</span><span class="o">.</span><span class="n">pk</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">PKOnlyObject</span><span class="p">)</span> <span class="k">else</span> <span class="n">attribute</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">check_for_none</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">nb_gender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_gender_display</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">NbModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶ÇÊûúÊàë‰ª¨ËøòÊúâÂÖ∂‰ªñÈúÄË¶ÅÂ∫èÂàóÂåñÂô®ÈúÄË¶ÅÂÆûÁé∞Ëøô‰∏™ÂäüËÉΩÔºåÊòØÂê¶ÈúÄË¶ÅÂú®ÊØè‰∏Ä‰∏™Â∫èÂàóÂåñÂô®‰∏≠Ëá™ÂÆö‰πâ‰∏ÄÈÅç<code>to_representation</code>Ôºü</p>
<p>Êàë‰ª¨ÂèØ‰ª•Â∞ÜËá™ÂÆö‰πâÁöÑÊñπÊ≥ïÊâìÂåÖÂà∞‰∏Ä‰∏™Á±ª‰∏≠ÔºåÂú®ÈúÄË¶ÅÂÆûÁé∞ËØ•ÂäüËÉΩÁöÑÂ∫èÂàóÂåñÂô®Á±ª‰∏≠ÁªßÊâøÂç≥ÂèØ</p>
<p><code>ext/hook.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.fields</span> <span class="kn">import</span> <span class="n">SkipField</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.relations</span> <span class="kn">import</span> <span class="n">PKOnlyObject</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbHookSerializer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readable_fields</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nb_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&#34;nb_</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">)(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">attribute</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">except</span> <span class="n">SkipField</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">check_for_none</span> <span class="o">=</span> <span class="n">attribute</span><span class="o">.</span><span class="n">pk</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">PKOnlyObject</span><span class="p">)</span> <span class="k">else</span> <span class="n">attribute</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">check_for_none</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>views.py</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.hook</span> <span class="kn">import</span> <span class="n">NbHookSerializer</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbModelSerializer</span><span class="p">(</span><span class="n">NbHookSerializer</span><span class="p">,</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">NbUserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="s2">&#34;gender&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">nb_gender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_gender_display</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">NbModelSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="114-ÂçöÂÆ¢Á≥ªÁªüÊ°à‰æã">11.4 ÂçöÂÆ¢Á≥ªÁªüÊ°à‰æã
</h3><p>ÂºÄÂèë‰∏Ä‰∏™ÂçöÂÆ¢Á≥ªÁªüÔºåÂåÖÂê´ÔºöÂçöÂÆ¢ÂàóË°®„ÄÅËØ¶ÁªÜ„ÄÅÁôªÂΩï„ÄÅÊ≥®ÂÜå„ÄÅËØÑËÆ∫„ÄÅÁÇπËµû„ÄÅÂèëÂ∏ÉÂçöÂÆ¢</p>
<h4 id="1141-Ë°®ÁªìÊûÑ">11.4.1 Ë°®ÁªìÊûÑ
</h4><p>È°πÁõÆÁöÑÂàõÂª∫Âú®Ê≠§‰∏çËµòËø∞ÔºåÁøªÁúãÂÖàÂâçÊñáÁ´†Âç≥ÂèØ</p>
<p>ÂÖàÂàõÂª∫Ë°®ÁªìÊûÑÔºåmodels.pyÂÜÖÂÆπÂ¶Ç‰∏ã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Áî®Êà∑Âêç&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂØÜÁ†Å&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">token</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;TOKEN&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">category_choices</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;‰∫ëËÆ°ÁÆó&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;PythonÂÖ®Ê†à&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;GoÂºÄÂèë&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂàÜÁ±ª&#34;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">category_choices</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Â∞ÅÈù¢&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Ê†áÈ¢ò&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">summary</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÁÆÄ‰ªã&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂçöÊñá&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ctime</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂàõÂª∫Êó∂Èó¥&#34;</span><span class="p">,</span> <span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">creator</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂàõÂª∫ËÄÖ&#34;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&#34;UserInfo&#34;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">comment_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ËØÑËÆ∫Êï∞&#34;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">favor_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ËµûÊï∞&#34;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Favor</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34; Ëµû &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">blog</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂçöÂÆ¢&#34;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&#34;Blog&#34;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Áî®Êà∑&#34;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&#34;UserInfo&#34;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">create_datetime</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂàõÂª∫Êó∂Èó¥&#34;</span><span class="p">,</span> <span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="n">models</span><span class="o">.</span><span class="n">UniqueConstraint</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;uni_favor_blog_user&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34; ËØÑËÆ∫Ë°® &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">blog</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂçöÂÆ¢&#34;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&#34;Blog&#34;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;Áî®Êà∑&#34;</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&#34;UserInfo&#34;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂÜÖÂÆπ&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">create_datetime</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&#34;ÂàõÂª∫Êó∂Èó¥&#34;</span><span class="p">,</span> <span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÅö‰∏Ä‰∏™Êï∞ÊçÆÂ∫ìËøÅÁßª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">makemigrations
</span></span><span class="line"><span class="cl">migrate
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê∑ªÂä†ÊµãËØïÊï∞ÊçÆ(ÂèØ‰ª•ÈááÁî®Á¶ªÁ∫øËÑöÊú¨ÁöÑÂΩ¢ÂºèÔºåÊàñËÄÖÂàõÂª∫‰∏Ä‰∏™ÂÜÖÂÆπÂ¶Ç‰∏ãÁöÑÊé•Âè£ÔºåÈÄöËøáËÆøÈóÆÊù•ÂàõÂª∫)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">HttpResponse</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create your views here.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">db</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">v1</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;qwj&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">v2</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;xzq&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">category</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">image</span><span class="o">=</span><span class="s2">&#34;xxx/xxxx.pbg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ÈÉëÁªèÁêÜ&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">summary</span><span class="o">=</span><span class="s1">&#39;...&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;ËØ¥Â§ßËØùÁîµËØùÂç°ÊñáÂåñÁöÑÂìá&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">creator</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">category</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">image</span><span class="o">=</span><span class="s2">&#34;xxx/xxxx.pbg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ËØÅÊçÆ&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">summary</span><span class="o">=</span><span class="s1">&#39;...&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Â§ßÂÆ∂ÂïäÊàëÂà∞ÂÆ∂Âïä‰∫îËßíÂ§ßÊ•º&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">creator</span><span class="o">=</span><span class="n">v2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&#34;ÊàêÂäü&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êï∞ÊçÆÂ¶Ç‰∏ã</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20250109120757629.png"
	
	
	
	loading="lazy"
	
		alt="image-20250109120757629"
	
	
></p>
<h4 id="1142-ÂäüËÉΩÂÆûÁé∞">11.4.2 ÂäüËÉΩÂÆûÁé∞
</h4><h5 id="11421-ÂçöÂÆ¢ÂàóË°®">11.4.2.1 ÂçöÂÆ¢ÂàóË°®
</h5><p>Ë∑ØÁî±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/blog/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BlogView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËßÜÂõæÁ±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ëé∑ÂèñÂçöÂÆ¢ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.ËØªÂèñÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂçöÂÆ¢‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogSerializer</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ËøîÂõû</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∫èÂàóÂåñÂô®</p>
<ul>
<li>ÂÜôÊ≥ï‰∏ÄÔºöËá™ÂÆö‰πâÂ≠óÊÆµ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">category</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;get_category_display&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ctime</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&#34;%Y-%m-</span><span class="si">%d</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">creator_name</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;creator.username&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;category&#34;</span><span class="p">,</span> <span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="s2">&#34;title&#34;</span><span class="p">,</span> <span class="s2">&#34;summary&#34;</span><span class="p">,</span> <span class="s2">&#34;ctime&#34;</span><span class="p">,</span> <span class="s2">&#34;comment_count&#34;</span><span class="p">,</span> <span class="s2">&#34;favor_count&#34;</span><span class="p">,</span> <span class="s2">&#34;creator&#34;</span><span class="p">,</span> <span class="s2">&#34;creator_name&#34;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÜôÊ≥ï‰∫åÔºöËá™ÂÆö‰πâÊñπÊ≥ï</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">category</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;get_category_display&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ctime</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&#34;%Y-%m-</span><span class="si">%d</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">creator</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">SerializerMethodField</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;category&#34;</span><span class="p">,</span> <span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="s2">&#34;title&#34;</span><span class="p">,</span> <span class="s2">&#34;summary&#34;</span><span class="p">,</span> <span class="s2">&#34;ctime&#34;</span><span class="p">,</span> <span class="s2">&#34;comment_count&#34;</span><span class="p">,</span> <span class="s2">&#34;favor_count&#34;</span><span class="p">,</span> <span class="s2">&#34;creator&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_creator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">creator_id</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">username</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÜôÊ≥ï‰∏âÔºöÂµåÂ•ó</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogUserSerializers</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;username&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">category</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;get_category_display&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ctime</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&#34;%Y-%m-</span><span class="si">%d</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">creator</span> <span class="o">=</span> <span class="n">BlogUserSerializers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;category&#34;</span><span class="p">,</span> <span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="s2">&#34;title&#34;</span><span class="p">,</span> <span class="s2">&#34;summary&#34;</span><span class="p">,</span> <span class="s2">&#34;ctime&#34;</span><span class="p">,</span> <span class="s2">&#34;comment_count&#34;</span><span class="p">,</span> <span class="s2">&#34;favor_count&#34;</span><span class="p">,</span> <span class="s2">&#34;creator&#34;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="11422-ÂçöÂÆ¢ËØ¶ÁªÜ‰∏éËØÑËÆ∫">11.4.2.2 ÂçöÂÆ¢ËØ¶ÁªÜ‰∏éËØÑËÆ∫
</h5><p>Ë∑ØÁî±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/blog/&lt;int:pk&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BlogDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl"><span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/comment/&lt;int:blog_id&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">CommentView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl"><span class="c1"># path(&#39;api/comment/&#39;, views.CommentView.as_view()),</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Ëé∑ÂèñÂçöÂÆ¢ËØÑËÆ∫ÁöÑÊé•Âè£ÂèØ‰ª•ÂÜôÊàê<code>api/comment?blog_id=1</code>Ôºå‰ΩÜÊòØ‰∏çÂ§™ÁæéËßÇÔºåÂª∫ËÆÆ‰ΩøÁî®<code>api/comment/1</code>ÁÑ∂ÂêéÂú®ËßÜÂõæ‰∏≠Êé•Êî∂</p></blockquote>
<p>ÂçöÂÆ¢ËØ¶ÁªÜ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogDetailSerializers</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">category</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;get_category_display&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ctime</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&#34;%Y-%m-</span><span class="si">%d</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">creator</span> <span class="o">=</span> <span class="n">BlogUserSerializers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="s2">&#34;__all__&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogDetailView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ëé∑ÂèñÂçöÂÆ¢ËØ¶ÁªÜ&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Ëé∑ÂèñID</span>
</span></span><span class="line"><span class="cl">        <span class="n">pk</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Ê†πÊçÆIDËé∑ÂèñÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="n">instance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s2">&#34;‰∏çÂ≠òÂú®&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogDetailSerializers</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 4.ËøîÂõû</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËØÑËÆ∫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CommentSerializers</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&#34;user.username&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Comment</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;content&#34;</span><span class="p">,</span> <span class="s2">&#34;user&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CommentView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">blog_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;ËØÑËÆ∫ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Ê†πÊçÆIDËé∑ÂèñËØÑËÆ∫ÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Comment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">CommentSerializers</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ËøîÂõû</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊµãËØïÊï∞ÊçÆËøòÊòØÈÄöËøáËÆøÈóÆ/db/Êù•Ê∑ªÂä†:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Âú®def db(request)‰∏≠Ê∑ªÂä†Â¶Ç‰∏ãÊìç‰Ωú</span>
</span></span><span class="line"><span class="cl"><span class="n">models</span><span class="o">.</span><span class="n">Comment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&#34;yi&#34;</span><span class="p">,</span> <span class="n">blog_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">models</span><span class="o">.</span><span class="n">Comment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&#34;er&#34;</span><span class="p">,</span> <span class="n">blog_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁªìÊûúÂ¶Ç‰∏ã</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20250109164431239.png"
	
	
	
	loading="lazy"
	
		alt="image-20250109164431239"
	
	
></p>
<p>Âü∫Êú¨ÂäüËÉΩÂ∑≤ÁªèÂÆûÁé∞‰∫ÜÔºå‰ΩÜÊòØÁé∞Âú®Âè™ÊòØËØÑËÆ∫ÁöÑÂ±ïÁ§∫ÔºåÂêéÁª≠Â¶ÇÊûúÁî®Êà∑Ë¶ÅÊ∑ªÂä†ËØÑËÆ∫Êó∂ÔºåuserÂ≠óÊÆµÊòØÈúÄË¶ÅÁî®Êà∑‰º†ÂÖ•idÂÄºÁöÑÔºåËÄåÂ±ïÁ§∫ÂàôÊòØÂ±ïÁ§∫Áî®Êà∑ÂêçÔºåÊâÄ‰ª•Ê≠§Â§ÑÈúÄË¶ÅÊàë‰ª¨ËøõË°å‰∏Ä‰∏™ÊãìÂ±ïÔºåËÆ©ËØ•Â≠óÊÆµÂú®Ê†°È™åÊó∂‰º†ÂÖ•ÁöÑÊòØidÔºåÂú®Â∫èÂàóÂåñÊó∂ÊòØËøîÂõûÁî®Êà∑Âêç</p>
<p>Áî®Âà∞ÂÖàÂâçÊèêÂà∞ÁöÑËá™ÂÆö‰πâ<code>NbHookSerializer</code>Á±ªÂÆûÁé∞</p>
<p>Âú®<code>etc/hook.py</code>‰∏≠ÂÆö‰πâ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.fields</span> <span class="kn">import</span> <span class="n">SkipField</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.relations</span> <span class="kn">import</span> <span class="n">PKOnlyObject</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NbHookSerializer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">to_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readable_fields</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nb_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&#34;nb_</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">)(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">attribute</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">except</span> <span class="n">SkipField</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">check_for_none</span> <span class="o">=</span> <span class="n">attribute</span><span class="o">.</span><span class="n">pk</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">PKOnlyObject</span><span class="p">)</span> <span class="k">else</span> <span class="n">attribute</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">check_for_none</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ret</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂØπ<code>CommentSerializers</code>Á±ªÂÅöÂ¶Ç‰∏ã‰øÆÊîπÂç≥ÂèØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ext.hook</span> <span class="kn">import</span> <span class="n">NbHookSerializer</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CommentSerializers</span><span class="p">(</span><span class="n">NbHookSerializer</span><span class="p">,</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Comment</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;content&#34;</span><span class="p">,</span> <span class="s2">&#34;user&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">nb_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="11423-Ê≥®ÂÜå">11.4.2.3 Ê≥®ÂÜå
</h5><p>Ë∑ØÁî±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/register/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">RegisterView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËßÜÂõæ+Â∫èÂàóÂåñ</p>
<blockquote>
<p>Â≠óÊÆµÁöÑÈí©Â≠êÊñπÊ≥ïÊâßË°åÈ°∫Â∫èÊåâfields‰∏≠ÂÆö‰πâÁöÑÈ°∫Â∫èÊù•</p>
<p>ÈÄöËøáÂÆö‰πâread_onlyÂíåwrite_onlyÂå∫Âà´Êï∞ÊçÆÊ†°È™åÂíåÂ∫èÂàóÂåñÂ≠óÊÆµÁöÑÂºÇÂêå</p>
<p>self.initial_dataÂèØ‰ª•ÊãøÂà∞‰º†ÂÖ•ÁöÑÊâÄÊúâÊï∞ÊçÆ</p>
<p>Êï∞ÊçÆ‰øùÂ≠òÊó∂Â≠óÊÆµËøáÂ§öÁöÑÂ§ÑÁêÜÊñπÊ≥ïÔºöpop</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RegisterSerializers</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">confirm_password</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">write_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;username&#34;</span><span class="p">,</span> <span class="s2">&#34;password&#34;</span><span class="p">,</span> <span class="s2">&#34;confirm_password&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;write_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validate_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÂØÜÁ†ÅÔºö&#34;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validate_confirm_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÈáçÂ§çÂØÜÁ†ÅÔºö&#34;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">password</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&#34;ÂØÜÁ†Å‰∏ç‰∏ÄËá¥&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RegisterView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ê≥®ÂÜå&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Êèê‰∫§Êï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># {&#34;username&#34;:&#34;qiuwj&#34;,&#34;password&#34;:&#34;123&#34;,&#34;confirm_password&#34;:&#34;123&#34;}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Êï∞ÊçÆÊ†°È™å+‰øùÂ≠ò</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">RegisterSerializers</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">confirm_password</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">validated_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;confirm_password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1001</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s2">&#34;Ê≥®ÂÜåÂ§±Ë¥•&#34;</span><span class="p">,</span> <span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="11424-ÁôªÂΩï">11.4.2.4 ÁôªÂΩï
</h5><p>Ë∑ØÁî±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/login/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËßÜÂõæÂä†Â∫èÂàóÂåñ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginSerializers</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">,</span> <span class="s2">&#34;password&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;ÁôªÂΩï&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Êèê‰∫§Êï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># {&#34;username&#34;:&#34;qiuwj&#34;,&#34;password&#34;:&#34;123&#34;}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Êï∞ÊçÆÊ†°È™å+‰øùÂ≠ò</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">LoginSerializers</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1001</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s2">&#34;Ê†°È™åÂ§±Ë¥•&#34;</span><span class="p">,</span> <span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">instance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">ser</span><span class="o">.</span><span class="n">validated_data</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1002</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s2">&#34;Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">instance</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">        <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="11425-ÂèëÂ∏ÉËØÑËÆ∫">11.4.2.5 ÂèëÂ∏ÉËØÑËÆ∫
</h5><p>ÂèëË°®ËØÑËÆ∫ÂèØ‰ª•ÈááÁî®ÂçïÁã¨ÂÜô‰∏Ä‰∏™ËßÜÂõæÁ±ªÁöÑÂ∫èÂàóÂåñÁ±ªÊù•ÂÆûÁé∞Ôºå‰ΩÜÊõ¥ËßÑËåÉÁöÑÂÜôÊ≥ïÊòØÊï¥ÂêàÂà∞‰∏äÈù¢ÁöÑÂçöÂÆ¢ËØÑËÆ∫‰∏≠ÔºåÂΩìGETËØ∑Ê±ÇÊó∂ÔºåÊòØÂ±ïÁ§∫ËØÑËÆ∫ÔºåÂΩìPOSTËØ∑Ê±ÇÊó∂ÔºåÊòØÂèëÂ∏ÉËØÑËÆ∫</p>
<p>Âõ†‰∏∫ÂèëÂ∏ÉËØÑËÆ∫ÂøÖÈ°ªÂÖàÁôªÂΩïÔºåÂõ†Ê≠§Ë¶ÅÁî®Âà∞ËÆ§ËØÅÁ±ªÔºå‰ΩÜÊòØÂ±ïÁ§∫ËØÑËÆ∫‰∏çÈúÄË¶ÅÁôªÂΩïÔºåËÄåËøô‰∏§‰∏™ÂäüËÉΩÊòØÂÜôÂú®‰∏Ä‰∏™ËßÜÂõæÁ±ª‰∏≠ÁöÑÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•ÈááÁî®ÂåøÂêçÁî®Êà∑ÔºåÂΩìÊú™ÁôªÂΩïÊó∂‰∏çËÆ©‰ªñÊäõÂá∫ÈîôËØØËÄåÊòØËøîÂõûNoneÔºåÊúÄÂêéÂ¶ÇÊûúrequest.user‰∏ç‰∏∫NoneÂàôËØ¥ÊòéÁôªÈôÜ‰∫ÜÔºåÂ¶ÇÊûúÊòØNoneËØ¥ÊòéÊòØÊú™ÁôªÂΩïÔºå‰∏çËÆ©ÂèëË°®„ÄÇ</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20250112160054842.png"
	
	
	
	loading="lazy"
	
		alt="image-20250112160054842"
	
	
></p>
<p>Âú®ËØ∑Ê±ÇÂèÇÊï∞‰∏≠Êê∫Â∏¶token‰ΩúË∫´‰ªΩÊ†áËØÜÔºåÂú®ËØ∑Ê±Ç‰Ωì‰∏≠‰º†ÈÄíËØÑËÆ∫ÂÜÖÂÆπ</p>
<p>ËÆ§ËØÅÁ±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.authentication</span> <span class="kn">import</span> <span class="n">BaseAuthentication</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">instance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="p">,</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;API&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËßÜÂõæÁ±ª+Â∫èÂàóÂåñÁ±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CommentSerializers</span><span class="p">(</span><span class="n">NbHookSerializer</span><span class="p">,</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Comment</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;content&#34;</span><span class="p">,</span> <span class="s2">&#34;user&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">nb_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CommentView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">BlogAuthentication</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">blog_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;ËØÑËÆ∫ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Ê†πÊçÆIDËé∑ÂèñËØÑËÆ∫ÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Comment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog_id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">CommentSerializers</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ËøîÂõû</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">blog_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;ÂèëÂ∏ÉËØÑËÆ∫&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s2">&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">blog_object</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">blog_object</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s2">&#34;ÂçöÂÆ¢‰∏çÂ≠òÂú®&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">CommentSerializers</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1002</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s2">&#34;ÂÜÖÂÆπÂÆ°Ê†∏‰∏çÈÄöËøá&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="n">blog_object</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="11426-ÁÇπËµû">11.4.2.6 ÁÇπËµû
</h5><p>Ë∑ØÁî±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/favor/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">FavorView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âõ†‰∏∫ÁÇπËµûÂäüËÉΩÂøÖÈ°ªÁôªÂΩïÔºåÂõ†Ê≠§Êñ∞Â¢û<code>NoAuthentication</code>ËÆ§ËØÅÁ±ªÔºåÂΩì<code>BlogAuthentication</code>Á±ª‰∏∫Ê†°È™åÈÄöËøáÊó∂ÔºåÂ∞±ÊäõÂá∫ÈîôËØØ</p>
<p>ËÆ§ËØÅÁ±ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework.authentication</span> <span class="kn">import</span> <span class="n">BaseAuthentication</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">exceptions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">instance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="p">,</span> <span class="n">token</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;API&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NoAuthentication</span><span class="p">(</span><span class="n">BaseAuthentication</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">AuthenticationFailed</span><span class="p">({</span><span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;API&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∫èÂàóÂåñ+ËßÜÂõæÂáΩÊï∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FavorSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Favor</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;blog&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FavorView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">BlogAuthentication</span><span class="p">,</span> <span class="n">NoAuthentication</span><span class="p">,</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">FavorSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1002</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s2">&#34;Ê†°È™åÂ§±Ë¥•&#34;</span><span class="p">,</span> <span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.Â∑≤Â≠òÂú® ‰∏çËµû</span>
</span></span><span class="line"><span class="cl">        <span class="n">exists</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Favor</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="o">**</span><span class="n">ser</span><span class="o">.</span><span class="n">validated_data</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1005</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s2">&#34;Â∑≤ËµûËøáÔºå‰∏çÂÖÅËÆ∏ÈáçÂ§çÁÇπËµû&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.‰∏çÂ≠òÂú®</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="12427-Êñ∞Âª∫ÂçöÂÆ¢">12.4.2.7 Êñ∞Âª∫ÂçöÂÆ¢
</h5><p>ÂíåÊü•ÁúãËØÑËÆ∫‰∏éÂèëÂ∏ÉËØÑËÆ∫Áõ∏ÂêåÔºåÂçöÂÆ¢ÂàóË°®‰∏éÊñ∞Âª∫ÂçöÂÆ¢‰πüÊîæÂà∞‰∏Ä‰∏™ËßÜÂõæÁ±ª‰∏≠</p>
<p>Âõ†‰∏∫Êñ∞Âª∫ÂçöÂÆ¢ÂøÖÈ°ªÁôªÂΩïÔºåÂèØ‰ª•ÈááÂèñÂåøÂêçÁî®Êà∑+ÂØπ<code>request.user</code>Âà§Êñ≠ÁöÑÂΩ¢ÂºèÊù•ÂÅöÊùÉÈôêÊ†°È™å</p>
<p>ËßÜÂõæÁ±ª</p>
<blockquote>
<p>ÂÖ≥ÈîÆÂú®‰∫éÂØπgetÂíåpostËØ∑Ê±ÇÊó∂‰∏çÂêåÂ≠óÊÆµÁöÑÈöêËóèÂíåÊòæÁ§∫Â§ÑÁêÜ</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogSerializer</span><span class="p">(</span><span class="n">NbHookSerializer</span><span class="p">,</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ctime</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&#34;%Y-%m-</span><span class="si">%d</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">creator</span> <span class="o">=</span> <span class="n">BlogUserSerializers</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span>
</span></span><span class="line"><span class="cl">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="s2">&#34;category&#34;</span><span class="p">,</span> <span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="s2">&#34;title&#34;</span><span class="p">,</span> <span class="s2">&#34;summary&#34;</span><span class="p">,</span> <span class="s2">&#34;text&#34;</span><span class="p">,</span> <span class="s2">&#34;ctime&#34;</span><span class="p">,</span> <span class="s2">&#34;comment_count&#34;</span><span class="p">,</span> <span class="s2">&#34;favor_count&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="s2">&#34;creator&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;comment_count&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;favor_count&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;read_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;write_only&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">nb_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_category_display</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">BlogAuthentication</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ëé∑ÂèñÂçöÂÆ¢ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.ËØªÂèñÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂçöÂÆ¢‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogSerializer</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ËøîÂõû</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s2">&#34;ËÆ§ËØÅÂ§±Ë¥•&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1002</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s2">&#34;Ê†°È™åÂ§±Ë¥•&#34;</span><span class="p">,</span> <span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">errors</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">creator</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÆûÁé∞ÊïàÊûú</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20250120233733760.png"
	
	
	
	loading="lazy"
	
		alt="image-20250120233733760"
	
	
></p>
<h4 id="1243-ÊÄªÁªì">12.4.3 ÊÄªÁªì
</h4><p>‰∏ªË¶ÅÊãìÂ±ï‰∫ÜÊùÉÈôêÁ±ªÁöÑÊàñÂÖ≥Á≥ª‰ª•ÂèäÂÖ≥‰∫éÂ∫èÂàóÂåñÂô®‰º†ÂÖ•‰∏éËæìÂá∫ÁöÑÂ≠óÊÆµÂêçÁõ∏Âêå‰ΩÜÂÜÖÂÆπ‰∏çÂêåÁöÑÊãìÂ±ï</p>
<p>‰ΩÜÂ≠òÂú®Âá†‰∏™ÈóÆÈ¢ò</p>
<ul>
<li>ÁÇπËµûËØÑËÆ∫ÂêéÂçöÂÆ¢ÂØπÂ∫îÁÇπËµûÊï∞ÂíåËØÑËÆ∫Êï∞Êú™ÂèòÂåñ &ndash;&gt;  fÊìç‰ΩúËá™Âä†‰∏Ä</li>
<li>ÂçöÂÆ¢ÂàóË°®ÂíåËØÑËÆ∫ÂàóË°®ÁöÑÂàÜÈ°µÂäüËÉΩ</li>
</ul>
<p>Ê°à‰æãÂÆåÊï¥È°πÁõÆÂëΩÂêç‰∏∫blog1.zip</p>
<h2 id="12-ÂàÜÈ°µ">12. ÂàÜÈ°µ
</h2><p>Âú®django‰∏≠ÂéüÁîüÁöÑÂàÜÈ°µÁªÑ‰ª∂‰∏çÂ§üÂ•ΩÁî®Ôºå‰∫éÊòØÊàë‰ª¨Ëá™ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ÁªÑ‰ª∂ÔºåËÄåÂú®drf‰∏≠Ôºå‰ªñ‰∏∫Êàë‰ª¨Êèê‰æõ‰∫Ü‰∏â‰∏™Ëøò‰∏çÈîôÁöÑÂàÜÈ°µÁªÑ‰ª∂Ôºå‰∏ãÈù¢Êàë‰ª¨Êù•‰ªãÁªç‰∏Ä‰∏ãÊØîËæÉÂ∏∏Áî®ÁöÑ‰∏§‰∏™</p>
<p><code>PageNumberPagination</code>ÔºåÈÄÇÁî®‰∫éÊòæÁ§∫È°µÈù¢„ÄÅ‰∏ä‰∏Ä‰∏ã„ÄÅ‰∏ã‰∏ÄÈ°µ</p>
<blockquote>
<p>/accounts/?page=4
/accounts/?page=6
/accounts/?page=7
/accounts/?page=7&amp;page_size=1000000000
/accounts/?page=7&amp;page_size=2
/accounts/?page=7&amp;page_size=4</p></blockquote>
<p>ÂêéÁ´ØÁªôÂâçÁ´ØËøîÂõûÁöÑÊï∞ÊçÆÂèÇËÄÉÔºåÁî±ÂâçÁ´ØËá™Â∑±ÂàíÂàÜ</p>
<pre><code>res = {
	&quot;data&quot;:[xxx,xxxx,xxxx,xxx,xxxx],
	&quot;total&quot;:1000,
	&quot;persize&quot;:20
}
</code></pre>
<hr>
<p><code>LimitOffsetPagination</code>ÔºåÊªöÂä®ÁøªÈ°µ</p>
<blockquote>
<p>‰ªéÁ¨¨‰∫åÊù°ÂºÄÂßã,ÂèñÂçÅÊù°</p>
<p>/accounts/?offset=2&amp;limit=10
/accounts/?offset=10&amp;limit=10</p>
<p>ËøòÂèØ‰ª•Ê∑ªÂä†Êù°‰ª∂,Â¶ÇidÂ§ß‰∫é10ÁöÑ‰∏≠‰ªéÁ¨¨0‰∏™ÂºÄÂßã,ÂèñÂçÅÊù°</p>
<p>/accounts/?lastid=10&amp;offset=0&amp;limit=10
/accounts/?lastid=20&amp;offset=0&amp;limit=10</p></blockquote>
<h3 id="121-pagenumberpagination">12.1 PageNumberPagination
</h3><h4 id="1211-ÂàùÊ≠•‰ΩøÁî®">12.1.1 ÂàùÊ≠•‰ΩøÁî®
</h4><p><img src="/post%5cpython%5cDRF%5cimage-20250121154003508.png"
	
	
	
	loading="lazy"
	
		alt="image-20250121154003508"
	
	
></p>
<p>Âú®url‰∏≠‰º†ÂÖ•‰∏çÂêåÁöÑpage,ÂèØ‰ª•ËøîÂõûÂØπÂ∫îÈ°µÁöÑÊï∞ÊçÆ</p>
<blockquote>
<p>‰∏ÄÂÖ±Êúâ‰∏âÁØáÂçöÂÆ¢,page_size=2,Âõ†Ê≠§Á¨¨‰∏ÄÈ°µ‰∏§Êù°Êï∞ÊçÆ,Á¨¨‰∫åÈ°µ‰∏ÄÊù°Êï∞ÊçÆ</p></blockquote>
<p><img src="/post%5cpython%5cDRF%5cimage-20250121154415485.png"
	
	
	
	loading="lazy"
	
		alt="image-20250121154415485"
	
	
></p>
<p>Â∞ÜËØ•ÂàÜÈ°µÁªÑ‰ª∂Â∫îÁî®Âà∞ÂâçÈù¢ÁöÑÊ°à‰æã‰∏≠,Êñ∞ÁöÑBlogViewÁ±ªÂÆûÁé∞Â¶Ç‰∏ã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">BlogAuthentication</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ëé∑ÂèñÂçöÂÆ¢ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.ËØªÂèñÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂçöÂÆ¢‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂàÜÈ°µ</span>
</span></span><span class="line"><span class="cl">        <span class="kn">from</span> <span class="nn">rest_framework.pagination</span> <span class="kn">import</span> <span class="n">PageNumberPagination</span>
</span></span><span class="line"><span class="cl">        <span class="n">pager</span> <span class="o">=</span> <span class="n">PageNumberPagination</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogSerializer</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ËøîÂõû</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÜô‰∫Ü‰∏âË°å‰ª£Á†Å,Êîπ‰∫Ü‰∏Ä‰∏™ÂÄºÂ∞±ÂÆûÁé∞‰∫ÜÂàÜÈ°µÂäüËÉΩ</p>
<h4 id="1212-Ëá™ÂÆö‰πâpagenumberpaginationÁ±ª">12.1.2 Ëá™ÂÆö‰πâPageNumberPaginationÁ±ª
</h4><p>ÈÄöËøáÁªßÊâøPageNumberPaginationÁ±ª,Ëá™ÂÆö‰πâ‰∏Ä‰∫õÂ≠óÊÆµÁöÑÂÄºÂÆûÁé∞ÂÆöÂà∂</p>
<p><img src="/post%5cpython%5cDRF%5cimage-20250121155536954.png"
	
	
	
	loading="lazy"
	
		alt="image-20250121155536954"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyPageNumberPagination</span><span class="p">(</span><span class="n">PageNumberPagination</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">page_size_query_param</span> <span class="o">=</span> <span class="s1">&#39;size&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">page_query_param</span> <span class="o">=</span> <span class="s1">&#39;p&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_page_size</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="n">page_size</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">BlogAuthentication</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ëé∑ÂèñÂçöÂÆ¢ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.ËØªÂèñÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂçöÂÆ¢‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂàÜÈ°µ</span>
</span></span><span class="line"><span class="cl">        <span class="n">pager</span> <span class="o">=</span> <span class="n">MyPageNumberPagination</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogSerializer</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.ËøîÂõû</span>
</span></span><span class="line"><span class="cl">        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1213-ÂàÜÈ°µÁöÑËøîÂõûÂÄºÂ§ÑÁêÜ">12.1.3 ÂàÜÈ°µÁöÑËøîÂõûÂÄºÂ§ÑÁêÜ
</h4><p>Â∞ÜÂ∫èÂàóÂåñÂêéÁöÑÊï∞ÊçÆ‰∏¢ÂÖ•<code>get_paginated_response</code>ÂáΩÊï∞,Â∞ÅË£ÖËøîÂõûÂÄº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">BlogAuthentication</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ëé∑ÂèñÂçöÂÆ¢ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.ËØªÂèñÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂçöÂÆ¢‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â§ÑÁêÜÂæóÂà∞ÂàÜÈ°µÂêéÁöÑqueryset</span>
</span></span><span class="line"><span class="cl">        <span class="kn">from</span> <span class="nn">rest_framework.pagination</span> <span class="kn">import</span> <span class="n">PageNumberPagination</span>
</span></span><span class="line"><span class="cl">        <span class="n">pager</span> <span class="o">=</span> <span class="n">PageNumberPagination</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogSerializer</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 4.Ëé∑ÂèñÂàÜÈ°µËøîÂõûÁªìÊûú</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">get_paginated_response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>get_paginated_response</code>ÂáΩÊï∞ÂÆûÁé∞ÈÄªËæë</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PageNumberPagination</span><span class="p">(</span><span class="n">BasePagination</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_paginated_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">paginator</span><span class="o">.</span><span class="n">count</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_link</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;previous&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_previous_link</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∞±ÊòØÂ∞ÅË£Ö‰∫Ü‰∏Ä‰∏™ÊúâÂ∫èÂ≠óÂÖ∏Âπ∂ÊîæÂà∞response‰∏≠,Â¶ÇÊûú‰∏çÊª°ÊÑèÂÆÉÁöÑÂÜÖÂÆπÂèØ‰ª•Ëá™ÂÆö‰πâ<code>PageNumberPagination</code>Á±ªÈáçÂÜô<code>get_paginated_response</code>ÊñπÊ≥ï,ÊâãÂä®Â∞ÅË£Ö</p>
<h4 id="1214-ÁªàÊûÅ‰ΩøÁî®">12.1.4 ÁªàÊûÅ‰ΩøÁî®
</h4><p>‰æãÂ≠ê</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">BlogAuthentication</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ëé∑ÂèñÂçöÂÆ¢ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.ËØªÂèñÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂçöÂÆ¢‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â§ÑÁêÜÂæóÂà∞ÂàÜÈ°µÂêéÁöÑqueryset</span>
</span></span><span class="line"><span class="cl">        <span class="kn">from</span> <span class="nn">rest_framework.pagination</span> <span class="kn">import</span> <span class="n">PageNumberPagination</span>
</span></span><span class="line"><span class="cl">        <span class="n">pager</span> <span class="o">=</span> <span class="n">PageNumberPagination</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogSerializer</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 4.Ëé∑ÂèñÂàÜÈ°µËøîÂõûÁªìÊûú</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">get_paginated_response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="122-limitoffsetpagination">12.2 LimitOffsetPagination
</h3><h4 id="1221-Âü∫Êú¨‰ΩøÁî®ÂèäÊãìÂ±ï">12.2.1 Âü∫Êú¨‰ΩøÁî®ÂèäÊãìÂ±ï
</h4><p><code>LimitOffsetPagination</code>‰∏é<code>PageNumberPagination</code>ÁöÑ‰ΩøÁî®Áõ∏ÂêåÔºåÂîØ‰∏ÄÁöÑÂå∫Âà´Â∞±ÊòØÂÆû‰æãÂåñÁöÑÁ±ª‰∏çÂêåÔºåËøòÊúâurl‰∏≠‰º†ÂÖ•ÁöÑÂèÇÊï∞‰∏çÂêå</p>
<p>‰πüÂèØ‰ª•ÈÄöËøáÁªßÊâøÔºåËá™ÂÆö‰πâ‰∏Ä‰∏™Á±ªÔºå‰øÆÊîπÂÖ∂‰∏≠ÁöÑÂèÇÊï∞Ôºå‰æãÂ¶Ç‰∏ãÂàó</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">default_limit = api_settings.PAGE_SIZE
</span></span><span class="line"><span class="cl">limit_query_param = &#39;limit&#39;
</span></span><span class="line"><span class="cl">offset_query_param = &#39;offset&#39;
</span></span><span class="line"><span class="cl">max_limit = None
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩøÁî®ÊñπÊ≥ïÂ¶Ç‰∏ã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">BlogAuthentication</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ëé∑ÂèñÂçöÂÆ¢ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.ËØªÂèñÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂçöÂÆ¢‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â§ÑÁêÜÂæóÂà∞ÂàÜÈ°µÂêéÁöÑqueryset</span>
</span></span><span class="line"><span class="cl">        <span class="kn">from</span> <span class="nn">rest_framework.pagination</span> <span class="kn">import</span> <span class="n">LimitOffsetPagination</span>
</span></span><span class="line"><span class="cl">        <span class="n">pager</span> <span class="o">=</span> <span class="n">LimitOffsetPagination</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogSerializer</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 4.Ëé∑ÂèñÂàÜÈ°µËøîÂõûÁªìÊûú</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">get_paginated_response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="1222-ÂÆûÈôÖ‰ΩøÁî®">12.2.2 ÂÆûÈôÖ‰ΩøÁî®
</h4><p>Âú®È°πÁõÆ‰∏≠ÔºåÂæàÂ∞ëÂ∞Ü<code>LimitOffsetPagination</code>Áî®‰∫éÊôÆÈÄöÁöÑÂàÜÈ°µÈúÄÊ±Ç‰∏≠ÔºåËÄåÊòØ‰∏ªË¶ÅÁî®Êù•ÂÆûÁé∞ÊªöÂä®ÁøªÈ°µÔºåÊØîÂ¶ÇÈ°µÈù¢ÈªòËÆ§ÊòæÁ§∫10Êù°ÔºåÂΩìÊªöÂà∞Â∫ïÈÉ®Êó∂ÊâçÂä†ËΩΩÂêé10Êù°Ôºå‰ª•Ê≠§Á±ªÊé®</p>
<p>‰∏∫‰ªÄ‰πà‰∏ç‰ΩøÁî®<code>PageNumberPagination</code>Âë¢ÔºüÊàë‰ª¨‰∏æ‰∏™‰æãÂ≠êÊù•ÁêÜËß£</p>
<p>ÊØîÂ¶Ç‰∏ÄÁªÑÂÄíÂ∫èÊéíÂàóÁöÑÊï∞10,9,8&hellip;1</p>
<p>Á¨¨‰∏ÄÊ¨°offset=0&amp;limit=2ÂèñÂà∞10Ôºå9</p>
<p>Á¨¨‰∫åÊ¨°offset=2&amp;limit=2ÂèñÂà∞8Ôºå7</p>
<p>Ê≠£Â∏∏Êù•ËÆ≤ÂâçÁ´ØËÆ∞ÂΩïÂèñÂá∫ÁöÑ‰∏™Êï∞ÁÑ∂Âêé‰Ωú‰∏∫offset‰∏ç‰ºöÂá∫ÈîôÔºå‰ΩÜÂ¶ÇÊûúÊèíÂÖ•‰∫ÜÊñ∞ÁöÑÊï∞ÊçÆÂà∞ÊúÄÂâçÁ´Ø</p>
<p>Á¨¨‰∏âÊ¨°offset=0&amp;limit=2ÂèñÂà∞7Ôºå6Â∞±‰ºöÂá∫Áé∞ÈáçÂ§ç</p>
<p>Ëß£ÂÜ≥ÂäûÊ≥ïÂ∞±ÊòØÂâçÁ´ØËÆ∞ÂΩïÂèñÂá∫ÁöÑÊúÄÂêé‰∏Ä‰∏™Êï∞ÊçÆÁöÑid‰Ωú‰∏∫max_idÔºåËøôÊ†∑Â∞±Âè™‰ºö‰ªéÊú™ÂèñÂá∫ÁöÑÊï∞ÊçÆ‰∏≠Êü•ÊâæÔºåoffset=0&amp;limit=2Êó†ÈúÄÊõ¥Êîπ</p>
<p>Ë¶ÅÊãøÊúÄÊñ∞Êï∞ÊçÆÂè™ÈúÄË¶ÅÈôêÂà∂Êù°‰ª∂‰∏∫idÂ§ß‰∫éÊúÄ‰∏äÈù¢ÁöÑ‰∏ÄÊù°Êï∞ÊçÆÁöÑidÂç≥ÂèØÔºåÂç≥ÂèØÂÆûÁé∞Âêë‰∏äÊªöÂä®ÁøªÈ°µÂíåÂêë‰∏ãÊªöÂä®ÁøªÈ°µ</p>
<blockquote>
<p>/accounts/?offset=0&amp;limit=2&amp;lastid=0
13	Ê≠¶Ê≤õÈΩê
12	Ê≠¶Ê≤õÈΩê     max_id=12</p>
<p>/accounts/?offset=0&amp;limit=2&amp;lastid=12
11	Ê≠¶Ê≤õÈΩê
10	Ê≠¶Ê≤õÈΩê      max_id=10</p>
<p>/accounts/?offset=0&amp;limit=2&amp;lastid=10
9	Ê≠¶Ê≤õÈΩê
8	Ê≠¶Ê≤õÈΩê</p></blockquote>
<p>Ê°à‰æã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlogView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">BlogAuthentication</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Ëé∑ÂèñÂçöÂÆ¢ÂàóË°®&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 1.ËØªÂèñÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂçöÂÆ¢‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">        <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ?max_id=1</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ?min_id=13</span>
</span></span><span class="line"><span class="cl">        <span class="n">max_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">max_id</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__lt</span><span class="o">=</span><span class="n">max_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2.Â§ÑÁêÜÂæóÂà∞ÂàÜÈ°µÂêéÁöÑqueryset</span>
</span></span><span class="line"><span class="cl">        <span class="kn">from</span> <span class="nn">rest_framework.pagination</span> <span class="kn">import</span> <span class="n">LimitOffsetPagination</span>
</span></span><span class="line"><span class="cl">        <span class="n">pager</span> <span class="o">=</span> <span class="n">LimitOffsetPagination</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3.Â∫èÂàóÂåñ</span>
</span></span><span class="line"><span class="cl">        <span class="n">ser</span> <span class="o">=</span> <span class="n">BlogSerializer</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 4.Ëé∑ÂèñÂàÜÈ°µËøîÂõûÁªìÊûú</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">pager</span><span class="o">.</span><span class="n">get_paginated_response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/drf/">DRF</a>
        
            <a href="/tags/python/">Python</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="yn0t1me/blog-commnet"
        issue-term="pathname"
        
        label="utterances"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 yn0t1me
    </section>
    
    <section class="powerby">
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
